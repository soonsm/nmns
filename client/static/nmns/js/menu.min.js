!function(){$("#mainRow").append($('<div id="menuModal" class="modal fade" tabIndex="-1" role="dialog" aria-hidden="true" data-index="0">        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">          <div class="modal-content">            <div class="modal-header">              <span>                <h5 class="modal-title" id="menuTitle">메뉴 추가</h5>              </span>              <button type="button" class="close" data-dismiss="modal" aria-label="닫기">                <span aria-hidden="true">&times;</span>              </button>            </div>            <div class="modal-body">              <div class="row mx-0 col-12 p-0">                <form id="menuForm" class="mb-1 col-12 px-0">                  <div class="form-group mb-0">                    <div>메뉴 이름</div>                    <input id="menuFormName" type="text" placeholder="메뉴 이름을 입력해주세요." class="form-control form-control-sm mt-3"/>                    <div style="margin-top:35px">카드 가격</div>                    <input id="menuFormPriceCard" type="text" placeholder="카드 가격을 입력해주세요." class="form-control form-control-sm mt-3 mb-2 montserrat inputmask-integer"/>                    <div style="margin-top:35px">현금 가격</div>                    <input id="menuFormPriceCash" type="text" placeholder="현금 가격을 입력해주세요." class="form-control form-control-sm mt-3 mb-2 montserrat inputmask-integer"/>                    <div style="margin-top:35px">멤버십 가격</div>                    <input id="menuFormPriceMembership" type="text" placeholder="멤버십 가격을 입력해주세요." class="form-control form-control-sm mt-3 mb-2 montserrat inputmask-integer"/>                  </div>                </form>                <div class="row mx-0 col-12 px-0 mt-5">                  <button type="button" class="btn btn-accent col" id="menuFormBtn">저장</button>                </div>              </div>            </div>          </div>        </div>      </div>').one("show.bs.modal",function(){$("#menuFormBtn").on("touch click",function(){if(""!==$("#menuFormName").val()){var e=$("#menuForm").data("origin");if(e){NMNS.history.push({id:e.id,name:e.name,priceCash:e.priceCash,priceCard:e.priceCard,priceMembership:e.priceMembership});var i={id:e.id,name:$("#menuFormName").val(),priceCash:""===$("#menuFormPriceCash").val().replace(/,/gi,"")?null:1*$("#menuFormPriceCash").val().replace(/,/gi,""),priceCard:""===$("#menuFormPriceCard").val().replace(/,/gi,"")?null:1*$("#menuFormPriceCard").val().replace(/,/gi,""),priceMembership:""===$("#menuFormPriceMembership").val().replace(/,/gi,"")?null:1*$("#menuFormPriceMembership").val().replace(/,/gi,"")};NMNS.socket.emit("update menu",i),(e=NMNS.menuList.find(function(e){return e.id===i.id})).name=i.name,e.priceCash=i.priceCash,e.priceCard=i.priceCard,e.priceMembership=i.priceMembership}else e={id:NMNS.email+generateRandom(),name:$("#menuFormName").val(),priceCash:""===$("#menuFormPriceCash").val().replace(/,/gi,"")?null:1*$("#menuFormPriceCash").val().replace(/,/gi,""),priceCard:""===$("#menuFormPriceCard").val().replace(/,/gi,"")?null:1*$("#menuFormPriceCard").val().replace(/,/gi,""),priceMembership:""===$("#menuFormPriceMembership").val().replace(/,/gi,"")?null:1*$("#menuFormPriceMembership").val().replace(/,/gi,"")},NMNS.socket.emit("add menu",e),NMNS.menuList.push(e);$("#menuModal").modal("hide"),o(!0)}else showSnackBar("메뉴 이름을 입력해주세요.")})}).on("shown.bs.modal",function(){$("#menuFormName").focus()})),Inputmask("integer",{autoGroup:!0,groupSeparator:",",groupSize:3,rightAlign:!1,allowMinus:!1,allowPlus:!1}).mask("#menuModal .inputmask-integer"),$("#updateMenuLink").on("touch click",function(){if($(".menuRow .updatingMenu-collapsed").toggleClass("d-none").toggleClass("d-block"),$(".updatingMenu-expanded").toggle(),$(".menuTitle .updatingMenu-collapsed").toggle(),$("#mainMenuTools .updatingMenu-collapsed").toggleClass("d-inline-flex"),$(".updatingMenu-collapsed").is(":visible"))$("#mainMenuList").data("sortable")&&$("#mainMenuList").data("sortable").option("disabled",!1),$(this).text("수정 완료");else{$("#mainMenuList").data("sortable")&&$("#mainMenuList").data("sortable").option("disabled",!0);var n=!1,t=[];$("#mainMenuList .menuRow").map(function(e,i){t.push(NMNS.menuList[1*i.getAttribute("data-index")]),"delete"===$(i).data("action")?(t[e].action="delete",n=!0):e!==1*i.getAttribute("data-index")&&(n=!0)}),n&&NMNS.socket.emit("update menu list",t),$(this).text("수정")}});var a=0;function r(e,i){for(var n,t="",a=e;a<i;a++)t+='<div class="menuRow col-12" data-index="'+a+'"><div class="col-3 px-0 font-weight-bold" style="font-size:14px">'+((n=NMNS.menuList[a]).name&&""!==n.name?n.name:"(이름없음)")+'</div><div class="col px-0 montserrat">'+(0!=n.priceCard&&n.priceCard?(n.priceCard+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col-3 px-0 montserrat">'+(0!=n.priceCash&&n.priceCash?(n.priceCash+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col-3 px-0 montserrat">'+(0!=n.priceMembership&&n.priceMembership?(n.priceMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col-1 updatingMenu-collapsed d-none"><button type="button" class="deleteMenuLink close p-0 m-0" aria-label="삭제"><span aria-hidden="true">&times;</span></button></div><a class="menuModalLink" href="#" data-toggle="modal" data-target="#menuModal" title="상세보기"></a></div>';return t}function o(e){var i,n=$("#mainMenuList"),t="";a||(a=0),NMNS.menuList&&e?(n.children(":not(.ps)").remove(),NMNS.menuList&&0<NMNS.menuList.length?t+=r(0,i=Math.min(0===a?a+Math.max(20,5+Math.ceil($("#mainMenuList").height()/48)-$("#mainMenuList .menuRow").length):a,NMNS.menuList.length)):t+="<p>아직 등록된 메뉴가 없습니다. 새로운 메뉴를 등록하여 고객의 매출내역을 기록, 관리해보세요!</p>"):NMNS.menuList&&(i=Math.min(a+Math.max(20,5+Math.ceil($("#mainMenuList").height()/48)-$("#mainMenuList .menuRow").length),NMNS.menuList.length),t+=r(a,i)),a=i,n.append($(t).on("touch click",".menuModalLink",function(e){e.preventDefault(),m(NMNS.menuList[1*$(this).parent().data("index")])}).on("touch click",".deleteMenuLink",function(e){if(e.stopPropagation(),$(this).parents(".menuRow").data("action","delete").hide(),confirm("정말 이 메뉴 항목을 삭제하시겠어요?")){var i=Number($(this).parentsUntil(void 0,".card").data("index"));if(Number.isInteger(i)){var n=NMNS.menuList[i];n&&(NMNS.history.push($.extend({index:i},n)),NMNS.socket.emit("delete menu",{id:n.id}),NMNS.menuList.remove(n.id,function(e,i){return e.id===i}),o(!0))}}})),n.data("sortable")||n.data("sortable",Sortable.create(n[0],{animation:150,disabled:!0,forceFallback:!0}))}function m(e){$("#menuForm").data("origin",e),e?($("#menuFormName").val(e.name),$("#menuFormPriceCard").val(e.priceCard),$("#menuFormPriceCash").val(e.priceCash),$("#menuFormPriceMembership").val(e.priceMembership),$("#menuTitle").text("메뉴 상세")):($("#menuFormName").val(""),$("#menuFormPriceCard").val(""),$("#menuFormPriceCash").val(""),$("#menuFormPriceMembership").val(""),$("#menuTitle").text("메뉴 추가"))}NMNS.drawMenuList=o,$("#createMenuLink").on("touch click",function(){m(null)}),NMNS.socket.on("update menu list",socketResponse("메뉴 리스트 수정",void 0,function(e){NMNS.menuList=e.data,o(!(a=0))})),NMNS.socket.on("add menu",socketResponse("메뉴 추가",function(e){NMNS.history.remove(e.data.id,findById),$("#scheduleTabContentList").html(NMNS.generateMenuList(NMNS.menuList))},function(i){var e=NMNS.menuList.findIndex(function(e){return e.id===i.data.id});Number.isInteger(e)&&-1<e&&(NMNS.menuList.splice(e,1),o(!0))})),NMNS.socket.on("update menu",socketResponse("메뉴 항목 수정",function(e){NMNS.history.remove(e.data.id,findById),$("#scheduleTabContentList").html(NMNS.generateMenuList(NMNS.menuList))},function(i){var e=NMNS.history.find(function(e){return e.id===i.data.id}),n=NMNS.menuList.findIndex(function(e){return e.id===i.data.id});Number.isInteger(n)&&-1<n&&(NMNS.menuList[n].priceCard=e.priceCard,NMNS.menuList[n].priceCash=e.priceCash,NMNS.menuList[n].name=e.name,NMNS.menuList[n].priceMembership=e.priceMembership,NMNS.history.remove(i.data.id,findById),o(!0))})),NMNS.socket.on("delete menu",socketResponse("메뉴 항목 삭제",function(e){NMNS.history.remove(e.data.id,findById),$("#scheduleTabContentList").html(NMNS.generateMenuList(NMNS.menuList))},function(i){var e=NMNS.history.find(function(e){return e.id===i.data.id});NMNS.menuList.splice(e.index,e),o(!0)})),o(!0)}();