!function(){function l(e,a){for(var t,s,l=NMNS.calendar.getCalendars(),n="",o=e;o<a;o++)s=NMNS.salesList[o],(t=l.find(function(e){return e.id===s.managerId}))||(t={color:"#334150",name:"(삭제된 담당자)"}),n+='<div class="row col-12 salesRow" data-index="'+o+'"><div class="d-flex position-relative col-12 px-0 align-items-center" style="margin-bottom:18px"><div class="salesName ellipsis">'+s.customerName+'</div><span class="divider" style="display:inline-table">&nbsp;</span><div class="montserrat nowrap mr-2">'+moment(s.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+t.color+'" title="'+t.name+'"></span></div><div class="d-flex col-6 px-0"><div class="col-4 px-0 salesSubHead">매출액</div><div class="col-8 pr-0 montserrat">'+(s.price+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div></div><div class="d-flex col-6 px-0"><div class="col-4 px-0 salesSubHead">결제수단</div><div class="col-8 pr-0">'+("CARD"===s.type?"카드":"CASH"===s.type?"현금":"멤버십")+'</div></div><div class="col-2 px-0 salesSubHead mt-1">예약내용</div><div class="col-10 pr-0 mt-1" style="word-break:break-all">'+s.item+"</div></div>";return n}function t(e){var a,t=$("#mainSalesList"),s="";NMNS.salesList&&e?(t.children(":not(.ps)").remove(),NMNS.salesList&&0<NMNS.salesList.length?s+=l(0,a=Math.min(0===n?n+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length):n,NMNS.salesList.length)):s+="<p class='m-auto'>저장된 매출 내역이 없습니다.</p>"):NMNS.salesList&&(a=Math.min(n+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length),NMNS.salesList.length),s+=l(n,a)),n=a,t.append(s)}NMNS.socket.on("get sales list",socketResponse("매출 내역 조회",function(e){NMNS.salesList=e.data.sales,NMNS.salesList=[{id:"123",customerName:"기기기",date:"20190101",item:"입장료",price:3e3,type:"CARD"}];for(var a=0;a<100;a++)NMNS.salesList.push({id:"123"+a,customerName:"미미미"+a*Math.random(),date:moment().add(a,"day").format("YYYYMMDD"),item:"입장료"+a*Math.random(),type:"CARD",price:Math.floor(3e4*Math.random())});$("#mainSalesLoading").hide(),t(!0),$("#salesSummaryTotalCount").text((e.data.totalSalesCount||NMNS.salesList.length+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCard").text((e.data.totalSalesCard||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCash").text((e.data.totalSalesCash||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalMembership").text((e.data.totalSalesMembership||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalAmount").text((e.data.totalSalesAmount||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#mainSalesTools").data("initialHeight")||$("#mainSalesTools").data("initialHeight",document.getElementById("mainSalesTools").offsetHeight),$("#salesSearchButton").removeClass("disabled"),$("#salesSearchPeriod").text(moment(document.getElementById("salesCalendar")._flatpickr.selectedDates[0]).format("YYYY. MM. DD - ")+moment(document.getElementById("salesCalendar")._flatpickr.selectedDates[1]).format("YYYY. MM. DD"))})),$(".salesSearchPeriodButton").on("touch click",function(e){var a,t;switch($(".salesSearchPeriodButton").removeClass("active"),e.preventDefault(),$(this).data("action")){case"week":$(this).blur(),t=moment(),a=moment().add(-7,"day");break;case"month":$(this).blur(),t=moment(),a=moment().add(-1,"month");break;case"halfYear":$(this).blur(),t=moment(),a=moment().add(-6,"month");break;case"currentMonth":$(this).addClass("active"),t=moment().endOf("month"),a=moment().startOf("month");break;case"previousMonth":$(this).addClass("active"),t=moment().add(-1,"month").endOf("month"),a=moment().add(-1,"month").startOf("month");break;case"previous2Month":$(this).addClass("active"),t=moment().add(-2,"month").endOf("month"),a=moment().add(-2,"month").startOf("month")}a&&t&&($("#salesSearchStartDate").val(a.format("YYYY. MM. DD")),$("#salesSearchEndDate").val(t.format("YYYY. MM. DD")))}),$("#salesSearchButton").on("touch click",function(){$(this).hasClass("disabled")||($(this).addClass("disabled"),history.pushState({link:"salesMenu",subLink:"search"},"","/sales/search"),NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesCalendar")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesCalendar")._flatpickr.selectedDates[1]).format("YYYYMMDD"),name:""===$("#salesSearchName").val()?void 0:$("#salesSearchName").val(),managerId:$("#salesSearchManager").data("calendar-id")||void 0,item:""===$("#salesSearchContents").val()?void 0:$("#salesSearchContents").val()}),$("#mainSalesSearch").hide(),$("#mainSalesList").html(""),$("#mainSalesLoading").show(),document.scrollingElement.scrollTop=0,$(".salesMenu .menuTitle").addClass("fixedScroll"),$(".salesSearchSwitch").show(),$("#salesToolsSticky").data("initialHeight",$("#salesToolsSticky").offset().top))});var n=0;$(".salesSortType").off("touch click").on("touch click",function(e){if($(this).hasClass("active"))NMNS.salesList.reverse();else{var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action")),NMNS.salesList.sort(function s(e){switch(e){case"sort-date":return function(e,a){return e.date?a.date?e.date<a.date?-1:e.date>a.date?1:s("sort-name")(e,a):-1:a.date?1:s("sort-name")(e,a)};case"sort-manager":var l=NMNS.calendar.getCalendars();return function(a,t){return a.managerId?t.managerId?(a.manager||(a.manager=l.find(function(e){return e.id===a.managerId}),a.manager||(a.manager={color:"#334150",name:"(삭제된 담당자)"})),t.manager||(t.manager=l.find(function(e){return e.id===t.managerId}),t.manager||(t.manager={color:"#334150",name:"(삭제된 담당자)"})),a.manager.name<t.manager.name?-1:a.manager.name>t.manager.name?1:s("sort-name")(a,t)):-1:t.managerId?1:s("sort-name")(a,t)};case"sort-item":return function(e,a){return e.item?a.item?e.item<a.item?-1:e.item>a.item?1:s("sort-name")(e,a):-1:a.item?1:s("sort-name")(e,a)};case"sort-sales":return function(e,a){return e.price?a.price?1*e.price<1*a.price?-1:1*e.price>1*a.price?1:s("sort-name")(e,a):-1:a.price?1:s("sort-name")(e,a)};case"sort-name":default:return function(e,a){return e.customerName?a.customerName?e.customerName<a.customerName?-1:e.customerName>a.customerName?1:0:-1:a.customerName?1:0}}}(a)),function(e){$(".salesSortType").removeClass("active"),$(".salesSortType[data-action='"+e+"']").addClass("active")}(a)}t(!(n=0))});var e=!1;$(document).on("scroll",debounce(function(){$("#mainSalesList").is(":visible")&&!e&&NMNS.salesList&&n<NMNS.salesList.length&&Math.max(document.body.scrollHeight-window.innerHeight-window.scrollY,0)<Math.max(100,.2*window.innerHeight)&&(e=!0,$("#mainSalesLoading").show(),t(),$("#mainSalesLoading").hide(),e=!1)},100)).on("scroll",function(){$("#mainSalesList").is(":visible")&&(document.scrollingElement.scrollTop>=document.getElementById("salesTools").offsetHeight+31?$("#mainSalesTools").addClass("fixedScroll"):$("#mainSalesTools").removeClass("fixedScroll"))}),$("#salesCalendarModal").on("show.bs.modal",function(){$("#salesCalendar")[0]._flatpickr.setDate([$("#salesSearchStartDate").val(),$("#salesSearchEndDate").val()],!1,"Y. m. d")}).on("hide.bs.modal",function(){$("#salesSearchStartDate").val(moment($("#salesCalendar")[0]._flatpickr.selectedDates[0]).format("YYYY. MM. DD")),$("#salesSearchEndDate").val(moment($("#salesCalendar")[0]._flatpickr.selectedDates[1]).format("YYYY. MM. DD"))})}();