!function(){function r(e,t){for(var s,a=$("#customerMembershipList").data("item"),i="",o=e;o<t;o++)i+='<div class="customerMembership col-12" data-id="'+(s=a[o]).id+'"><div class="col-3 montserrat">'+moment(s.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><div class="col-4" title="'+s.item+'">'+s.item+'</div><div class="col-5 px-0 d-flex"><div class="col-6 px-0 montserrat">'+("MEMBERSHIP_INCREMENT"===s.type||"MEMBERSHIP_ADD"===s.type?"+ ":"- ")+((s.membershipChange||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div><div class="col-6 px-0 montserrat">'+((s.balanceMembership||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</div></div></div>";return i}function s(e){var t,s=$("#customerMembershipList"),a=s.data("item"),i=s.data("index"),o="";if(a&&e){if($("#customerMembershipLoading").hide(),s.children().remove(),!(0<a.length))return $("#customerMembershipList").hide(),void $("#customerMembershipEmpty").show();o=r(0,t=Math.min(0===i?i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerMembership").length):i,a.length))}else{if(!a)return $("#customerMembershipList").hide(),void $("#customerMembershipEmpty").show();o=r(i,t=Math.min(i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerMembership").length),a.length))}s.data("index",t).append(o),$("#customerMembershipEmpty").hide(),$("#customerMembershipList").show()}function c(e,t){for(var s,a=$("#customerAlrimList").data("item"),i="",o=e;o<t;o++)s=a[o],i+='<div class="customerAlrim col-12 montserrat" title="눌러서 전송된 알림톡 내용 보기"><a href="#customerAlrimDetail'+o+'" class="customerAlrimDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="customerAlrimDetail'+o+'"></a>'+moment(s.date,"YYYYMMDDHHmm").format("YYYY. MM. DD HH:mm")+'</div><div class="row customerAlrimDetail collapse mx-0 col-12" id="customerAlrimDetail'+o+'">'+(s.contents?s.contents.replace(/\n/g,"<br>"):"")+"</div>";return i}function t(e){var t,s=$("#customerAlrimList"),a=s.data("item"),i=s.data("index"),o="";if(a&&e){if($("#customerAlrimLoading").hide(),s.children().remove(),!(0<a.length))return $("#customerAlrimNotEmpty").hide(),void $("#customerAlrimEmpty").show();o=c(0,t=Math.min(0===i?i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerAlrim").length):i,a.length))}else{if(!a)return $("#customerAlrimNotEmpty").hide(),void $("#customerAlrimEmpty").show();o=c(i,t=Math.min(i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerAlrim").length),a.length))}s.data("index",t).append(o).on("touch click",".customerAlrimDetailLink",function(){$(this).parent().toggleClass("active")}),$("#customerAlrimEmpty").hide(),$("#customerAlrimNotEmpty").show()}function n(e,t){for(var s,a,i,o,r=NMNS.calendar.getCalendars(),c=$("#customerScheduleList").data("item"),n="",l=e;l<t;l++){a=c[l],(s=r.find(function(e){return e.id===a.managerId}))||(s={color:"#334150",name:"(삭제된 담당자)"});try{i=JSON.parse(a.contents).map(function(e){return e.value}).join(", ")}catch(e){i=a.contents}n+='<div class="customerSchedule col-12" data-index="'+l+'"><div class="col col-4 px-0 montserrat" title="'+(o=moment(a.start,"YYYYMMDDHHmm").format("YYYY. MM. DD HH:mm")+(a.end?moment(a.end,"YYYYMMDDHHmm").format(moment(a.start,"YYYYMMDDHHmm").isSame(moment(a.end,"YYYYMMDDHHmm"),"day")?" - HH:mm":" - YYYY. MM. DD HH:mm"):""))+'">'+o+'</div><div class="col col-5 px-0 d-flex"><div class="col col-4 px-0"><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+s.color+'" title="'+s.name+'"></span>'+s.name+'</div><div class="col col-8">'+(i||"")+'</div></div><div class="col-3 px-0 d-flex"><div class="col col-6 px-0 montserrat">'+(a.sales?(a.sales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col col-6 px-0">'+("NOSHOW"==a.status?"노쇼":"CANCELED"===a.status||"CUSTOMERCANCELED"===a.status?"취소":"정상")+"</div></div></div></div>"}return n}function a(e){var t,s=$("#customerScheduleList"),a=s.data("item"),i=s.data("index"),o="";if(a&&e){if(s.children().remove(),!(0<a.length))return $("#customerScheduleNotEmpty").hide(),void $("#customerScheduleEmpty").show();o=n(0,t=Math.min(0===i?i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerSchedule").length):i,a.length))}else{if(!a)return $("#customerScheduleNotEmpty").hide(),void $("#customerScheduleEmpty").show();o=n(i,t=Math.min(i+Math.max(20,5+Math.ceil(s.height()/48)-s.find(".customerSchedule").length),a.length))}s.data("index",t).append(o),$("#customerScheduleEmpty").hide(),$("#customerScheduleNotEmpty").show()}$("#mainContents").append('<div id="customerDetailmenu" class="switchingMenu customerDetailmenu">    <div class="d-flex horizontalTab">      <div class="row col-12">        <ul id="customerTabList" class="nav nav-pills" role="tabList" style="display:inline-flex !important;height:47px;">          <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0 active" href="#customerInfo" data-toggle="tab" aria-selected="true" aria-label="고객 정보">고객 정보</a></li>          <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerSchedule" data-toggle="tab" aria-label="예약 내역">예약 내역</a></li>          <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerAlrim" data-toggle="tab" aria-label="알림톡 내역">알림톡 내역</a></li>          <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerMembership" data-toggle="tab" aria-label="멤버십 금액 내역">멤버십 금액 내역</a></li>        </ul>      </div>    </div>    <div class="menuContents px-3">      <div class="row mx-0 col-12 tab-content p-0">                      <div id="customerInfo" class="tab-pane col-12 px-0 fade show active" role="tabpanel">          <div class="row mx-0">            <div id="customerNoShow" class="col-12 px-0">총 <span id="customerNoShowCount" class="montserrat text-accent ml-1">0</span>건의 노쇼 이력이 있는 고객님이에요.</div>            <div>고객 이름</div>            <input type="text" class="form-control form-control-sm mt-3" id="customerName" placeholder="고객 이름을 입력해주세요." style="margin-bottom:35px">            <div>고객 연락처</div>            <input type="text" pattern="[0-9]*" class="form-control form-control-sm mt-3 montserrat" id="customerContact" placeholder="고객 연락처를 입력해주세요." style="margin-bottom:35px">            <div class="col-6 px-0">담당자</div><div class="col-6 pl-1">고객메모</div>          </div>          <div class="d-flex" style="margin-bottom:35px">            <div class="col px-0 mr-1">              <button id="customerManager" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-sm dropdown-toggle btn-flat form-control form-control-sm text-left mt-3" aria-label="담당자">                <span>선택</span>              </button>              <div class="dropdown-menu" aria-labelledby="customerManager" role="menu" id="customerManagerList" style="right:0"></div></div>            <div class="col px-0 ml-1"><input type="text" id="customerEtc" class="form-control form-control-sm mt-3" placeholder="고객 메모를 입력해주세요."></div>          </div>          <div class="d-flex updatingCustomer">            <div class="customerTitle">멤버십 잔액</div>            <div class="ml-auto"><span id="customerBalanceMembership" class="montserrat">0</span>원</div>          </div>          <div class="d-flex updatingCustomer">            <div class="customerTitle">총 매출액</div>            <div class="ml-auto"><span id="customerTotalSales" class="montserrat">0</span>원</div>          </div>          <div class="d-flex" style="margin-top:50px">            <button type="button" class="btn btn-white col mr-1" id="closeCustomerModal">취소</button>            <button id="customerBtn" type="button" class="btn btn-accent col ml-1">저장</button>          </div>        </div>                <div id="customerSchedule" class="tab-pane col-12 px-0 fade" role="tabpanel">          <div id="customerScheduleNotEmpty" class="row mx-0 flex-column">            <div class="row mx-0 col-12 px-1 pb-3 customerScheduleHead text-center" style="border-bottom:1px solid rgba(112, 112, 112, 0.35)">              <div class="col-4 px-0 customerScheduleSortType active" data-action="sort-date">날짜</div><div class="col-5 px-0 d-flex"><div class="col-4 px-0 customerScheduleSortType" data-action="sort-manager">담당</div>              <div class="col-8 px-0">예약내용</div></div><div class="col-3 px-0 d-flex"><div class="col-6 px-0 customerScheduleSortType" data-action="sort-sales">매출액</div><div class="col-6 px-0 customerScheduleSortType" data-action="sort-status">예약상태</div></div>            </div>            <div class="row mx-0" id="customerScheduleList"></div>          </div>          <div id="customerScheduleEmpty" style="display:none">예약 내역이 없어요.</div>        </div>                <div id="customerAlrim" class="tab-pane col-12 px-0 fade" role="tabpanel">          <div id="customerAlrimNotEmpty" class="row mx-0 flex-column">            <div id="customerAlrimList" class="row mx-0"></div>          </div>          <div id="customerAlrimLoading" class="flex-column">            <div class="bouncingLoader">              <div></div>              <div></div>              <div></div>            </div>             <span>알림톡 내역을 불러오는 중입니다...</span>          </div>          <div id="customerAlrimEmpty" style="display:none">알림톡 내역이 없어요.</div>        </div>                <div id="customerMembership" class="tab-pane col-12 px-0 fade" role="tabpanel">          <div class="d-flex"><div class="col px-0">멤버십 결제 금액</div><div class="col px-0" style="margin-left:-45px">멤버십 적립 금액<span class="subText">적립금액은 따로 입력할 수 있어요.</span></div></div>          <div class="d-flex my-3">            <div class="row mx-0 col-12 px-0"><input type="text" pattern="[0-9]*" id="customerMembershipSales" class="form-control form-control-sm montserrat col mr-1" aria-label="멤버십 결제 금액" placeholder="결제 금액을 숫자로 입력하세요.">            <input type="text" pattern="[0-9]*" id="customerMembershipChange" class="form-control form-control-sm montserrat col ml-1" aria-label="멤버십 적립 금액" placeholder="멤버십 적립 금액을 입력하세요.">            <button type="button" class="btn btn-sm btn-form ml-2" id="addCustomerMembershipSales">추가</button></div>          </div>          <div><input type="radio" name="customerMembershipSalesType" value="CARD" id="customerMembershipCard" checked="checked"><label for="customerMembershipCard"></label><label for="customerMembershipCard" style="margin-right:30px">카드</label><input type="radio" name="customerMembershipSalesType" value="CASH" id="customerMembershipCash"><label for="customerMembershipCash"></label><label for="customerMembershipCash">현금</label></div>          <div style="margin-top:30px">멤버십 금액 조절</div>          <div class="d-flex my-3">            <div class="row mx-0 col-12 px-0"><input type="text" id="customerMembershipAdjust" class="form-control form-control-sm montserrat col" aria-label="멤버십 금액 조절" placeholder="+/- 숫자를 입력하면 멤버십 금액을 임의로 조절할 수 있어요." >            <button type="button" class="btn btn-sm btn-form ml-2" id="addCustomerMembershipAdjust">추가</button></div>          </div>          <div class="row mx-0 col-12 py-3 px-1 text-center customerMembershipHead" style="border-bottom:1px solid rgba(112, 112, 112, 0.35)">            <div class="col-3">날짜</div><div class="col-4">내용</div><div class="col-5 px-0 d-flex"><div class="col-6 px-0">증/감</div><div class="col-6 px-0">잔액</div></div>          </div>          <div class="row mx-0" id="customerMembershipList"></div>          <div id="customerMembershipEmpty" style="text-align:center;padding:30px;display:none">멤버십 내역이 없어요.</div>          <div id="customerMembershipLoading" class="flex-column text-center">            <div class="bouncingLoader">              <div></div>              <div></div>              <div></div>            </div>             <span>멤버십 내역을 불러오는 중입니다...</span>          </div>        </div>              </div>    </div>  </div>');var i=0;function o(e,t){for(var s,a,i=NMNS.calendar.getCalendars(),o="",r=e;r<t;r++)a=NMNS.customerList[r],(s=i.find(function(e){return e.id===a.managerId}))||(s={color:"#334150",name:"(삭제된 담당자)"}),o+='<div class="customer col-12" data-index="'+r+'"><div class="col-12 px-0 position-relative d-flex align-items-center"><div class="font-weight-bold" style="font-size:14px">'+(a.name&&""!==a.name?a.name:"(이름없음)")+"</div>"+(a.contact&&""!==a.contact?'<span class="divider" style="display:inline-table">&nbsp;</span><div class="montserrat">'+dashContact(a.contact,".")+"</div>":"")+'<span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+s.color+'" title="'+s.name+'"></span></div><div class="col-6 px-0 d-flex"><div class="col-4 px-0 customerSubHead">방문</div><div class="col-8 pr-0"><span class="montserrat">'+(a.history?a.history.length:"0")+'</span>회</div></div><div class="col-6 px-0 d-flex"><div class="col-5 px-0 customerSubHead">마지막 방문</div><div class="col-7 pr-0 montserrat">'+(a.history&&0<a.history.length?moment(a.history[0].start,"YYYYMMDDHHmm").format("YYYY. MM. DD"):"-")+'</div></div><div class="col-6 px-0 d-flex"><div class="col-4 px-0 customerSubHead">매출액</div><div class="col-8 pr-0 montserrat">'+(a.cardSales+a.cashSales?(a.cardSales+a.cashSales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div></div><div class="col-6 px-0 d-flex"><div class="col-5 px-0 customerSubHead">멤버십 잔액</div><div class="col-7 pr-0 montserrat">'+(a.pointMembership?(a.pointMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+"</div></div>"+(a.etc&&""!==a.etc?'<hr/><div class="col-12 px-0 customerSubHead">'+a.etc+"</div>":"")+'<a class="customerModalLink" href="#" title="상세보기"></a></div>';return o}function l(e){var t,s=$("#mainCustomerList"),a="";NMNS.customerList&&e?(s.children(":not(.ps)").remove(),NMNS.customerList&&0<NMNS.customerList.length?a+=o(0,t=Math.min(0===i?i+Math.max(20,5+Math.ceil($("#mainCustomerList").height()/48)-$("#mainCustomerList .customer").length):i,NMNS.customerList.length)):a+="<p class='m-auto'>아직 등록된 고객이 없습니다.<br>새로운 고객을 등록하여 방문 및 매출내역을<br>기록, 관리해보세요!</p>"):NMNS.customerList&&(t=Math.min(i+Math.max(20,5+Math.ceil($("#mainCustomerList").height()/48)-$("#mainCustomerList .customer").length),NMNS.customerList.length),a+=o(i,t)),i=t,$("#customerCount").text(NMNS.customerList.length),s.append(a),s.find(".customerModalLink").off("touch click").on("touch click",function(e){e.preventDefault(),function(e){if(e){var t=NMNS.customerList[Number(e.parent().data("index"))];$("#customerName").val(t.name),$("#customerContact").val(t.contact),$("#customerEtc").val(t.etc),0===t.totalNoShow?$("#customerNoShow").hide():$("#customerNoShowCount").text(t.totalNoShow).parent().show(),$("#customerDetailMenu .updatingCustomer").addClass("d-flex"),$("#customerBalanceMembership").text((t.pointMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#customerTotalSales").text((t.cardSales+t.cashSales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"));var s=NMNS.calendar.getCalendars().find(function(e){return e.id===t.managerId});s||(s={color:"#334150",name:"(삭제된 담당자)"}),$("#customerManager").data("calendar-id",s.id).data("color",s.color).html(s.id?$("#customerManagerList button[data-calendar-id='"+s.id+"']").html():'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot mr-3" style="background-color: #334150"></span><span class="tui-full-calendar-content">(삭제된 담당자)</span>'),$(".addCustomerScheduleBtn").show(),$("#closeCustomerModal").hide(),$("#customerTabList a[href='#customerInfo']").text("고객 상세").tab("show"),$("#customerDetailMenu").removeClass("addCustomer").data("customer",t)}}($(this)),NMNS.switchMenu.call($(".customerDetailLink"),e)}),s.find(".deleteCustomerLink").off("touch click").on("touch click",function(e){if(e.preventDefault(),confirm("정말 이 고객을 삭제하시겠어요?")){var t=Number($(this).parentsUntil(void 0,".card").data("index"));if(Number.isInteger(t)){var s=NMNS.customerList[t];s&&(NMNS.history.push($.extend({index:t},s)),NMNS.socket.emit("delete customer",{id:s.id}),NMNS.customerList.remove(s.id,function(e,t){return e.id===t}),l(!0))}}})}function m(e){switch(e){case"sort-date":return function(e,t){return e.history&&0!==e.history.length?t.history&&0!==t.history.length?e.history[0].start<t.history[0].start?1:e.history[0].start>t.history[0].start?-1:m("sort-name")(e,t):-1:t.history&&0<t.history.length?1:m("sort-name")(e,t)};case"sort-manager":return function(e,t){return e.manager?t.manager?e.manager.name<t.manager.name?-1:e.manager.name>t.manager.name?1:m("sort-name")(e,t):-1:t.manager?1:m("sort-name")(e,t)};case"sort-sales":return function(e,t){return e.sales?t.sales?1*e.sales<1*t.sales?-1:1*e.sales>1*t.sales?1:m("sort-name")(e,t):-1:t.sales?1:m("sort-name")(e,t)};case"sort-membership":return function(e,t){return e.membership?t.membership?1*e.membership<1*t.membership?-1:1*e.membership>1*t.membership?1:m("sort-name")(e,t):-1:t.membership?1:m("sort-name")(e,t)};case"sort-visit":return function(e,t){return e.history&&0!==e.history.length?t.history&&0!==t.history.length?e.history.length<t.history.length?-1:e.history.length>t.history.length?1:m("sort-name")(e,t):-1:t.history&&0<t.history.length?1:m("sort-name")(e,t)};case"sort-name":default:return function(e,t){return e.name?t.name?e.name<t.name?-1:e.name>t.name?1:0:-1:t.name?1:0}}}NMNS.socket.on("get customer list",socketResponse("고객 조회",function(e){if(NMNS.customerList=e.data,e.data&&0<e.data.length){var s=NMNS.calendar.getCalendars();e.data.forEach(function(t){t.manager=s[s.findIndex(function(e){return e.id===t.managerId})]})}l(!(i=0))})),NMNS.socket.on("add customer",socketResponse("고객 추가",function(t){var e=NMNS.customerList.findIndex(function(e){return e.id===t.data.id});Number.isInteger(e)&&-1<e&&(NMNS.customerList[e].totalNoShow=t.data.totalNoShow||0,NMNS.customerList[e].myNoShow=0),$("#customerAddName").val(""),$("#customerAddContact").val(""),$("#customerAddEtc").val("")},function(t){var e=NMNS.customerList.findIndex(function(e){return e.id===t.data.id});Number.isInteger(e)&&-1<e&&(NMNS.customerList.splice(e,1),l(!0))})),NMNS.socket.on("update customer",socketResponse("고객정보 수정",function(t){var e=NMNS.customerList.findIndex(function(e){return e.id===t.data.id});if(Number.isInteger(e)&&-1<e){var s=NMNS.customerList[e];s.name=$("#customerName").val(),s.contact=$("#customerContact").val(),s.etc=$("#customerEtc").val(),s.managerId=$("#customerManager").data("calendar-id");var a=NMNS.calendar.getCalendars();s.manager=a[a.findIndex(function(e){return e.id===s.managerId})],showSnackBar("<span>고객의 정보를 수정하였습니다.</span>"),l(!0)}},function(t){if("DUPLICATED"===t.data.reason){if(confirm("이미 같은 이름과 연락처를 가진 고객이 존재합니다.\n그 고객쪽으로 모든 정보 및 예약, 알림톡 내역을 합칠까요?"))return void NMNS.socket.emit("merge customer",{id:t.data.id,name:$("#customerName").val(),contact:$("#customerContact").val(),etc:$("#customerEtc").val(),managerId:$("#customerManager").data("calendar-id")})}else alert("고객정보 수정에 실패하였습니다."+(t.message?"("+t.message+")":""));var e=NMNS.customerList.findIndex(function(e){return e.id===t.data.id});Number.isInteger(e)&&-1<e&&($("#customerName").val(NMNS.customerList[e].name),$("#customerContact").val(NMNS.customerList[e].contact),$("#customerEtc").val(NMNS.customerList[e].etc))},!0)),NMNS.socket.on("get customer alrim",socketResponse("알림톡 내역 조회",function(e){$("#customerAlrimList").data("index",0).data("item",e.data),t(!0)})),NMNS.socket.on("delete customer",socketResponse("고객 삭제",function(e){NMNS.history.remove(e.data.id,function(e,t){return e.id===t})},function(t){var e=NMNS.history.find(function(e){return e.id===t.data.id});NMNS.history.remove(t.data.id,function(e,t){return e.id===t}),NMNS.customerList.splice(e.index,0,e),l(!0)})),NMNS.socket.on("merge customer",socketResponse("고객정보 합치기",function(){NMNS.socket.emit("get customer list",{type:"all",target:""===$("#customerSearchTarget").val()?void 0:$("#customerSearchTarget").val(),sort:$($(".customerSortType.active")[0]).data("action")}),showSnackBar("<span>두 고객의 정보와 예약, 알림톡 내역을 합쳤습니다.</span>"),history.back()},function(){NMNS.socket.emit("get customer list",{type:"all",target:""===$("#customerSearchTarget").val()?void 0:$("#customerSearchTarget").val(),sort:$($(".customerSortType.active")[0]).data("action")}),history.back()})),NMNS.socket.on("get membership history",socketResponse("멤버십 내역 조회",function(e){$("#customerMembershipList").data("index",0).data("item",e.data),s(!0)})).on("add membership",socketResponse("멤버십 내역 변경",function(e){$("#customerMembershipList .customerMembership[data-id='"+e.data.id+"'] .balanceMembership").text(((e.data.balanceMembership||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))},function(t){var e=$("#customerMembershipList").data("item");e.splice(e.findIndex(function(e){return e.id===t.data.id}),1),s(!0)})),$("#customerBtn").on("touch click",function(e){if(e.preventDefault(),""!==$("#customerName").val()||""!==$("#customerContact").val())if(0<$("#customerInfo input:invalid").length)alert("입력하신 고객 정보를 확인해주세요.");else{var t=$("#customerDetailMenu").data("customer");t&&NMNS.socket.emit("update customer",{id:t.id,name:$("#customerName").val(),contact:$("#customerContact").val(),etc:$("#customerEtc").val(),managerId:$("#customerManager").data("calendar-id")}),history.back()}else alert("고객 이름과 전화번호 중 하나는 반드시 입력해주세요.")}),$("#customerTabList a[href='#customerAlrim']").on("show.bs.tab",function(){$(this).data("id")!==$("#customerDetailMenu").data("customer").id&&($(this).data("id",$("#customerDetailMenu").data("customer").id),$("#customerAlrimNotEmpty").hide(),$("#customerAlrimEmpty").hide(),$("#customerAlrimLoading").show(),NMNS.socket.emit("get customer alrim",{id:$("#customerDetailMenu").data("customer").id}))}).one("show.bs.tab",function(){var e=!1;$("#customerAlrimList").on("scroll",debounce(function(){!e&&$(this).data("item")&&$(this).data("index")<$(this).data("item").length&&this.scrollHeight-this.scrollTop-this.offsetHeight<Math.max(100,.2*this.getBoundingClientRect().height)&&(e=!0,t(),e=!1)},200))}),$("#customerTabList a[href='#customerSchedule']").on("show.bs.tab",function(){if($(this).data("id")!==$("#customerDetailMenu").data("customer").id){var e=$("#customerDetailMenu").data("customer");$(this).data("id",e.id),e.history&&0!==e.history.length?($("#customerScheduleNotEmpty").show(),$("#customerScheduleEmpty").hide(),$("#customerScheduleList").data("index",0).data("item",e.history).html(a(!0))):($("#customerScheduleNotEmpty").hide(),$("#customerScheduleEmpty").show())}}).one("show.bs.tab",function(){$(".customerScheduleSortType").off("touch click").on("touch click",function(e){if($(this).hasClass("active"))$("#customerScheduleList").data("item").reverse();else{var t=e.target.getAttribute("data-action");t||(t=e.target.parentElement.getAttribute("data-action")),$("#customerScheduleList").data("item").sort(m(t)),$(".customerScheduleSortType").removeClass("active"),$(".customerScheduleSortType[data-action='"+t+"']").addClass("active")}$("#customerScheduleList").data("index",0),a(!0)});var e=!1;$("#customerScheduleList").on("scroll",debounce(function(){!e&&$(this).data("item")&&$(this).data("index")<$(this).data("item").length&&this.scrollHeight-this.scrollTop-this.offsetHeight<Math.max(100,.2*this.getBoundingClientRect().height)&&(e=!0,a(),e=!1)},200))}),$("#customerTabList a[href='#customerMembership']").on("show.bs.tab",function(){if($(this).data("id")!==$("#customerDetailMenu").data("customer").id){var e=$("#customerDetailMenu").data("customer").id;$(this).data("id",e),$("#customerMembershipList").hide(),$("#customerMembershipEmpty").hide(),$("#customerMembershipLoading").show(),NMNS.socket.emit("get membership history",{customerId:e})}}).one("show.bs.tab",function(){$("#customerMembershipSales").on("keyup",function(e){13===e.which?$(this).next().next().trigger("click"):$(this).next().removeClass("manual").val($(this).val())}),$("#customerMembershipChange").on("keyup",function(e){13===e.which?$(this).next().trigger("click"):$(this).addClass("manual")}),$("#customerMembershipAdjust").on("keyup",function(e){13===e.which&&$(this).next().trigger("click")}),$("#addCustomerMembershipAdjust").on("touch click",function(){var e=$("#customerMembershipAdjust").val().match(/^\s*(\+|\-)?\s*([\d]*)\s*$/);if(e){var t={id:NMNS.email+generateRandom(),type:"-"===e[1]?"MEMBERSHIP_DECREMENT":"MEMBERSHIP_INCREMENT",item:"멤버십 금액 조절",customerId:$("#customerDetailMenu").data("customer").id,membershipChange:1*e[2],date:moment().format("YYYYMMDD")};0!==t.membershipChange?(NMNS.socket.emit("add membership",t),$("#customerMembershipList").data("item").splice(0,0,t),s(!0)):showSnackBar("조절할 금액을 0보다 크게 입력해주세요.")}else showSnackBar("조절할 금액을 정확히 입력해주세요.")}),$("#addCustomerMembershipSales").on("touch click",function(){if(""!==$("#customerMembershipChange").val()&&1*$("#customerMembershipChange").val()){var e={id:NMNS.email+generateRandom(),type:"MEMBERSHIP_ADD",item:"멤버십 적립",customerId:$("#customerDetailMenu").data("customer").id,payment:$("#customerMembershipCard").prop("checked")?"CARD":$("#customerMembershipCash").prop("checked")?"CASH":null,membershipChange:1*$("#customerMembershipChange").val(),price:1*$("#customerMembershipSales").val(),date:moment().format("YYYYMMDD")};e.payment?(NMNS.socket.emit("add membership",e),$("#customerMembershipList").data("item").splice(0,0,e),s(!0),$("#customerMembershipSales").val(""),$("#customerMembershipChange").val("")):showSnackBar("적립 결제수단을 선택해주세요.")}else showSnackBar("적립할 금액을 입력해주세요.")})}),$("#customerDetailMenu input[pattern]").each(function(e,t){setNumericInput(t)}),$("#customerSortTypeMenu").next().children("a").on("touch click",function(e){e.preventDefault();var t=$(e.target);t.hasClass("dropdown-item")||(t=t.parents(".dropdown-item")),$("#customerSortTypeMenu").data("action")===t.data("action")?NMNS.customerList.reverse():($("#customerSortTypeMenu").html(t.html()).data("action",t.data("action")),NMNS.customerList.sort(m(t.data("action")))),l(!(i=0))}),$("#searchCustomer").on("keyup",function(e){13===e.which&&NMNS.socket.emit("get customer list",{type:"all",target:this.value,sort:$("#customerSortTypeMenu").data("action")})});var e=!1;$(document).on("scroll",debounce(function(){$("#mainCustomerList").is(":visible")&&!e&&NMNS.customerList&&i<NMNS.customerList.length&&Math.max(document.body.scrollHeight-window.innerHeight-window.scrollY,0)<Math.max(100,.2*window.innerHeight)&&(e=!0,$("#mainCustomerLoading").show(),l(),$("#mainCustomerLoading").hide(),e=!1)},100))}();