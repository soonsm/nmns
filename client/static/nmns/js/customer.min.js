!function(){function r(t,e){for(var a,s=$("#customerMembershipList").data("item"),o="",i=t;i<e;i++)o+='<div class="customerMembership col-12" data-id="'+(a=s[i]).id+'"><div class="col-3 montserrat">'+moment(a.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><div class="col-4" title="'+a.item+'">'+a.item+'</div><div class="col-5 px-0 d-flex"><div class="col-6 px-0 montserrat">'+("MEMBERSHIP_INCREMENT"===a.type||"MEMBERSHIP_ADD"===a.type?"+ ":"- ")+((a.membershipChange||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div><div class="col-6 px-0 montserrat">'+((a.balanceMembership||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</div></div></div>";return o}function a(t){var e,a=$("#customerMembershipList"),s=a.data("item"),o=a.data("index"),i="";if(s&&t){if($("#customerMembershipLoading").hide(),a.children().remove(),!(0<s.length))return $("#customerMembershipList").hide(),void $("#customerMembershipEmpty").show();i=r(0,e=Math.min(0===o?o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerMembership").length):o,s.length))}else{if(!s)return $("#customerMembershipList").hide(),void $("#customerMembershipEmpty").show();i=r(o,e=Math.min(o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerMembership").length),s.length))}a.data("index",e).append(i),$("#customerMembershipEmpty").hide(),$("#customerMembershipList").show()}function c(t,e){for(var a,s=$("#customerAlrimList").data("item"),o="",i=t;i<e;i++)a=s[i],o+='<div class="customerAlrim col-12 montserrat" title="눌러서 전송된 알림톡 내용 보기"><a href="#customerAlrimDetail'+i+'" class="customerAlrimDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="customerAlrimDetail'+i+'"></a>'+moment(a.date,"YYYYMMDDHHmm").format("YYYY. MM. DD HH:mm")+'</div><div class="row customerAlrimDetail collapse mx-0 col-12" id="customerAlrimDetail'+i+'">'+(a.contents?a.contents.replace(/\n/g,"<br>"):"")+"</div>";return o}function e(t){var e,a=$("#customerAlrimList"),s=a.data("item"),o=a.data("index"),i="";if(s&&t){if($("#customerAlrimLoading").hide(),a.children().remove(),!(0<s.length))return $("#customerAlrimNotEmpty").hide(),void $("#customerAlrimEmpty").show();i=c(0,e=Math.min(0===o?o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerAlrim").length):o,s.length))}else{if(!s)return $("#customerAlrimNotEmpty").hide(),void $("#customerAlrimEmpty").show();i=c(o,e=Math.min(o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerAlrim").length),s.length))}a.data("index",e).append(i).on("touch click",".customerAlrimDetailLink",function(){$(this).parent().toggleClass("active")}),$("#customerAlrimEmpty").hide(),$("#customerAlrimNotEmpty").show()}function n(t,e){for(var a,s,o,i,r=NMNS.calendar.getCalendars(),c=$("#customerScheduleList").data("item"),n="",m=t;m<e;m++){s=c[m],(a=r.find(function(t){return t.id===s.managerId}))||(a={color:"#334150",name:"(삭제된 담당자)"});try{o=JSON.parse(s.contents).map(function(t){return t.value}).join(", ")}catch(t){o=s.contents}n+='<div class="customerSchedule col-12" data-index="'+m+'"><div class="col col-4 px-0 montserrat" title="'+(i=moment(s.start,"YYYYMMDDHHmm").format("YYYY. MM. DD HH:mm")+(s.end?moment(s.end,"YYYYMMDDHHmm").format(moment(s.start,"YYYYMMDDHHmm").isSame(moment(s.end,"YYYYMMDDHHmm"),"day")?" - HH:mm":" - YYYY. MM. DD HH:mm"):""))+'">'+i+'</div><div class="col col-5 px-0 d-flex"><div class="col col-4 px-0"><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+a.color+'" title="'+a.name+'"></span>'+a.name+'</div><div class="col col-8">'+(o||"")+'</div></div><div class="col-3 px-0 d-flex"><div class="col col-6 px-0 montserrat">'+(s.sales?(s.sales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col col-6 px-0">'+("NOSHOW"==s.status?"노쇼":"CANCELED"===s.status||"CUSTOMERCANCELED"===s.status?"취소":"정상")+"</div></div></div></div>"}return n}function s(t){var e,a=$("#customerScheduleList"),s=a.data("item"),o=a.data("index"),i="";if(s&&t){if(a.children().remove(),!(0<s.length))return $("#customerScheduleNotEmpty").hide(),void $("#customerScheduleEmpty").show();i=n(0,e=Math.min(0===o?o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerSchedule").length):o,s.length))}else{if(!s)return $("#customerScheduleNotEmpty").hide(),void $("#customerScheduleEmpty").show();i=n(o,e=Math.min(o+Math.max(20,5+Math.ceil(a.height()/48)-a.find(".customerSchedule").length),s.length))}a.data("index",e).append(i),$("#customerScheduleEmpty").hide(),$("#customerScheduleNotEmpty").show()}function o(t){if(t){var e=NMNS.customerList[Number(t.parent().data("index"))];$("#customerName").val(e.name),$("#customerContact").val(e.contact),$("#customerEtc").val(e.etc),0===e.totalNoShow?$("#customerNoShow").hide():$("#customerNoShowCount").text(e.totalNoShow).parent().show(),$("#customerModal .updatingCustomer").addClass("d-flex"),$("#customerBalanceMembership").text((e.pointMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#customerTotalSales").text((e.cardSales+e.cashSales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"));var a=NMNS.calendar.getCalendars().find(function(t){return t.id===e.managerId});a||(a={color:"#334150",name:"(삭제된 담당자)"}),$("#customerManager").data("calendar-id",a.id).data("color",a.color).html(a.id?$("#customerManagerList button[data-calendar-id='"+a.id+"']").html():'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot mr-3" style="background-color: #334150"></span><span class="tui-full-calendar-content">(삭제된 담당자)</span>'),$(".addCustomerScheduleBtn").show(),$("#closeCustomerModal").hide(),$("#customerTabList a[href='#customerInfo']").text("고객 상세").tab("show"),$("#customerModal").removeClass("addCustomer").data("customer",e)}else $("#customerName").val(""),$("#customerContact").val(""),$("#customerEtc").val(""),$("#customerNoShow").hide(),$(".addCustomerScheduleBtn").hide(),$("#closeCustomerModal").show(),$("#customerModal .updatingCustomer").removeClass("d-flex").hide(),$("#customerTabList a[href='#customerInfo']").text("고객 추가").tab("show"),$("#customerModal").addClass("addCustomer").data("customer",null)}$("#mainRow").append('<div id="customerModal" class="modal fade" tabIndex="-1" role="dialog" aria-label="고객 정보" aria-hidden="true">      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">        <div class="modal-content">          <div class="modal-header p-0 mx-0">            <div class="row mx-0 col-12" style="padding:25px 30px 0 30px;border-bottom:1px solid rgba(58, 54, 54, 0.35)">              <ul id="customerTabList" class="nav nav-pills" role="tabList" style="display:inline-flex !important;height:47px;">                <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0 active" href="#customerInfo" data-toggle="tab" aria-selected="true" aria-label="고객 정보">고객 정보</a></li>                <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerSchedule" data-toggle="tab" aria-label="예약 내역">예약 내역</a></li>                <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerAlrim" data-toggle="tab" aria-label="알림톡 내역">알림톡 내역</a></li>                <li class="nav-item" style="display:inline-flex !important"><a class="nav-link pt-0 rounded-0" href="#customerMembership" data-toggle="tab" aria-label="멤버십 금액 내역">멤버십 금액 내역</a></li>              </ul>              <button type="button" class="close p-0 ml-auto mr-0 my-0" data-dismiss="modal" aria-label="닫기">                <span aria-hidden="true" style="vertical-align:text-top;line-height:0px">&times;</span>              </button>            </div>          </div>          <div class="modal-body">            <div class="row mx-0 col-12 tab-content p-0">                                  <div id="customerInfo" class="tab-pane col-12 px-0 fade show active" role="tabpanel">                <div class="row mx-0">                  <div id="customerNoShow" class="col-12 px-0">총 <span id="customerNoShowCount" class="montserrat text-accent ml-1">0</span>건의 노쇼 이력이 있는 고객님이에요.</div>                  <div>고객 이름</div>                  <input type="text" class="form-control form-control-sm mt-3" id="customerName" placeholder="고객 이름을 입력해주세요." style="margin-bottom:35px">                  <div>고객 연락처</div>                  <input type="text" class="form-control form-control-sm mt-3 montserrat" id="customerContact" placeholder="고객 연락처를 입력해주세요." style="margin-bottom:35px">                  <div class="col-6 px-0">담당자</div><div class="col-6 pl-1">고객메모</div>                </div>                <div class="d-flex" style="margin-bottom:35px">                  <div class="col px-0 mr-1">                    <button id="customerManager" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="btn btn-sm dropdown-toggle btn-flat form-control form-control-sm text-left mt-3" aria-label="담당자">                      <span>선택</span>                    </button>                    <div class="dropdown-menu" aria-labelledby="customerManager" role="menu" id="customerManagerList" style="right:0"></div></div>                  <div class="col px-0 ml-1"><input type="text" id="customerEtc" class="form-control form-control-sm mt-3" placeholder="고객 메모를 입력해주세요."></div>                </div>                <div class="d-flex updatingCustomer">                  <div class="customerTitle">멤버십 잔액</div>                  <div class="ml-auto"><span id="customerBalanceMembership" class="montserrat">0</span>원</div>                </div>                <div class="d-flex updatingCustomer">                  <div class="customerTitle">총 매출액</div>                  <div class="ml-auto"><span id="customerTotalSales" class="montserrat">0</span>원</div>                </div>                <div class="d-flex" style="margin-top:50px">                  <button type="button" class="btn btn-white col mr-1 addCustomerScheduleBtn">예약 추가</button>                  <button type="button" class="btn btn-white col mr-1" id="closeCustomerModal" data-dismiss="modal">삭제</button>                  <button id="customerBtn" type="button" class="btn btn-accent col ml-1">저장</button>                </div>              </div>                            <div id="customerSchedule" class="tab-pane col-12 px-0 fade" role="tabpanel">                <div id="customerScheduleNotEmpty" class="row mx-0 flex-column">                  <div class="row mx-0 col-12 px-1 pb-3 customerScheduleHead text-center" style="border-bottom:1px solid rgba(112, 112, 112, 0.35)">                    <div class="col-4 px-0 customerScheduleSortType active" data-action="sort-date">날짜</div><div class="col-5 px-0 d-flex"><div class="col-4 px-0 customerScheduleSortType" data-action="sort-manager">담당</div>                    <div class="col-8 px-0">예약내용</div></div><div class="col-3 px-0 d-flex"><div class="col-6 px-0 customerScheduleSortType" data-action="sort-sales">매출액</div><div class="col-6 px-0 customerScheduleSortType" data-action="sort-status">예약상태</div></div>                  </div>                  <div class="row mx-0" id="customerScheduleList"></div>                </div>                <div id="customerScheduleEmpty" style="display:none">예약 내역이 없어요.</div>                <div class="d-flex col-12 px-0" style="margin-top:50px">                  <button type="button" class="btn btn-white col mr-1 addCustomerScheduleBtn">예약 추가</button>                  <button type="button" data-dismiss="modal" class="btn btn-accent col ml-1">닫기</button>                </div>              </div>                            <div id="customerAlrim" class="tab-pane col-12 px-0 fade" role="tabpanel">                <div id="customerAlrimNotEmpty" class="row mx-0 flex-column">                  <div id="customerAlrimList" class="row mx-0"></div>                </div>                <div id="customerAlrimLoading" class="flex-column">                  <div class="bouncingLoader">                    <div></div>                    <div></div>                    <div></div>                  </div>                   <span>알림톡 내역을 불러오는 중입니다...</span>                </div>                <div id="customerAlrimEmpty" style="display:none">알림톡 내역이 없어요.</div>                <div class="d-flex col-12 px-0" style="margin-top:50px">                  <button type="button" class="btn btn-white col mr-1 addCustomerScheduleBtn">예약 추가</button>                  <button type="button" data-dismiss="modal" class="btn btn-accent col ml-1">닫기</button>                </div>              </div>                            <div id="customerMembership" class="tab-pane col-12 px-0 fade" role="tabpanel">                <div class="d-flex"><div class="col px-0">멤버십 결제 금액</div><div class="col px-0" style="margin-left:-45px">멤버십 적립 금액<span class="subText">적립금액은 따로 입력할 수 있어요.</span></div></div>                <div class="d-flex my-3">                  <div class="row mx-0 col-12 px-0"><input type="text" id="customerMembershipSales" class="form-control form-control-sm montserrat col mr-1 inputmask-integer" aria-label="멤버십 결제 금액" placeholder="결제 금액을 숫자로 입력하세요.">                  <input type="text" id="customerMembershipChange" class="form-control form-control-sm montserrat col ml-1 inputmask-integer" aria-label="멤버십 적립 금액" placeholder="멤버십 적립 금액을 입력하세요.">                  <button type="button" class="btn btn-sm btn-form ml-2" id="addCustomerMembershipSales">추가</button></div>                </div>                <div><input type="radio" name="customerMembershipSalesType" value="CARD" id="customerMembershipCard" checked="checked"><label for="customerMembershipCard"></label><label for="customerMembershipCard" style="margin-right:30px">카드</label><input type="radio" name="customerMembershipSalesType" value="CASH" id="customerMembershipCash"><label for="customerMembershipCash"></label><label for="customerMembershipCash">현금</label></div>                <div style="margin-top:30px">멤버십 금액 조절</div>                <div class="d-flex my-3">                  <div class="row mx-0 col-12 px-0"><input type="text" id="customerMembershipAdjust" class="form-control form-control-sm montserrat col inputmask-integer-sign" aria-label="멤버십 금액 조절" placeholder="+/- 숫자를 입력하면 멤버십 금액을 임의로 조절할 수 있어요." >                  <button type="button" class="btn btn-sm btn-form ml-2" id="addCustomerMembershipAdjust">추가</button></div>                </div>                <div class="row mx-0 col-12 py-3 px-1 text-center customerMembershipHead" style="border-bottom:1px solid rgba(112, 112, 112, 0.35)">                  <div class="col-3">날짜</div><div class="col-4">내용</div><div class="col-5 px-0 d-flex"><div class="col-6 px-0">증/감</div><div class="col-6 px-0">잔액</div></div>                </div>                <div class="row mx-0" id="customerMembershipList"></div>                <div id="customerMembershipEmpty" style="text-align:center;padding:30px;display:none">멤버십 내역이 없어요.</div>                <div id="customerMembershipLoading" class="flex-column text-center">                  <div class="bouncingLoader">                    <div></div>                    <div></div>                    <div></div>                  </div>                   <span>멤버십 내역을 불러오는 중입니다...</span>                </div>                <div class="d-flex col-12 px-0" style="margin-top:50px">                  <button type="button" class="btn btn-white col mr-1 addCustomerScheduleBtn">예약 추가</button>                  <button type="button" data-dismiss="modal" class="btn btn-accent col ml-1">닫기</button>                </div>              </div>                          </div>          </div>        </div>      </div>    </div>'),Inputmask("999-999[9]-9999",{showMaskOnFocus:!1,showMaskOnHover:!1,autoUnmask:!0,placeholder:""}).mask("#customerContact"),Inputmask("integer",{autoGroup:!0,groupSeparator:",",groupSize:3,rightAlign:!1,allowMinus:!1,allowPlus:!1}).mask("#customerModal .inputmask-integer"),Inputmask("integer",{autoGroup:!0,groupSeparator:",",groupSize:3,rightAlign:!1}).mask("#customerModal .inputmask-integer-sign");var i=0;function m(t,e){for(var a,s,o=NMNS.calendar.getCalendars(),i="",r=t;r<e;r++)s=NMNS.customerList[r],(a=o.find(function(t){return t.id===s.managerId}))||(a={color:"#334150",name:"(삭제된 담당자)"}),i+='<div class="customer col-12" data-index="'+r+'"><div><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+a.color+'" title="'+a.name+'"></span></div><div class="col col-1 px-0 font-weight-bold" style="font-size:14px">'+(s.name&&""!==s.name?s.name:"(이름없음)")+'</div><div class="col col-2 montserrat">'+(s.contact&&""!==s.contact?dashContact(s.contact):"")+'</div><div class="col col-1" style="font-size:10px">'+(s.history?s.history.length+"회":"0회")+'</div><div class="col-4"><div class="col col-4 px-0 montserrat">'+(s.history&&0<s.history.length?moment(s.history[0].start,"YYYYMMDDHHmm").format("YYYY. MM. DD"):"-")+'</div><div class="col col-4 px-0 montserrat">'+(s.cardSales+s.cashSales?(s.cardSales+s.cashSales+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div><div class="col col-4 px-0 montserrat">'+(s.pointMembership?(s.pointMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):"-")+'</div></div><div class="col" style="font-size:10px">'+(s.etc||"-")+'</div><a class="customerModalLink" href="#" data-toggle="modal" data-target="#customerModal" title="상세보기"></a></div>';return i}function l(t){var e,a=$("#mainCustomerList"),s="";NMNS.customerList&&t?(a.children(":not(.ps)").remove(),NMNS.customerList&&0<NMNS.customerList.length?s+=m(0,e=Math.min(0===i?i+Math.max(20,5+Math.ceil($("#mainCustomerList").height()/48)-$("#mainCustomerList .customer").length):i,NMNS.customerList.length)):s+="<p>아직 등록된 고객이 없습니다. 새로운 고객을 등록하여 방문 및 매출내역을 기록, 관리해보세요!</p>"):NMNS.customerList&&(e=Math.min(i+Math.max(20,5+Math.ceil($("#mainCustomerList").height()/48)-$("#mainCustomerList .customer").length),NMNS.customerList.length),s+=m(i,e)),i=e,$("#customerCount").text(NMNS.customerList.length),a.append(s),a.find(".customerModalLink").off("touch click").on("touch click",function(t){t.preventDefault(),o($(this))}),a.find(".deleteCustomerLink").off("touch click").on("touch click",function(t){if(t.preventDefault(),confirm("정말 이 고객을 삭제하시겠어요?")){var e=Number($(this).parentsUntil(void 0,".card").data("index"));if(Number.isInteger(e)){var a=NMNS.customerList[e];a&&(NMNS.history.push($.extend({index:e},a)),NMNS.socket.emit("delete customer",{id:a.id}),NMNS.customerList.remove(a.id,function(t,e){return t.id===e}),l(!0))}}})}function d(t){switch(t){case"sort-start":return function(t,e){return t.start?e.start?t.start<e.start?-1:t.start>e.start?1:d("sort-name")(t,e):-1:e.start?1:d("sort-name")(t,e)};case"sort-date":return function(t,e){return t.history&&0!==t.history.length?e.history&&0!==e.history.length?t.history[0].start<e.history[0].start?1:t.history[0].start>e.history[0].start?-1:d("sort-name")(t,e):-1:e.history&&0<e.history.length?1:d("sort-name")(t,e)};case"sort-manager":return function(t,e){return t.manager?e.manager?t.manager.name<e.manager.name?-1:t.manager.name>e.manager.name?1:d("sort-name")(t,e):-1:e.manager?1:d("sort-name")(t,e)};case"sort-sales":return function(t,e){return t.sales?e.sales?1*t.sales<1*e.sales?-1:1*t.sales>1*e.sales?1:d("sort-name")(t,e):-1:e.sales?1:d("sort-name")(t,e)};case"sort-membership":return function(t,e){return t.membership?e.membership?1*t.membership<1*e.membership?-1:1*t.membership>1*e.membership?1:d("sort-name")(t,e):-1:e.membership?1:d("sort-name")(t,e)};case"sort-visit":return function(t,e){return t.history&&0!==t.history.length?e.history&&0!==e.history.length?t.history.length<e.history.length?-1:t.history.length>e.history.length?1:d("sort-name")(t,e):-1:e.history&&0<e.history.length?1:d("sort-name")(t,e)};case"sort-status":return function(t,e){return t.status?e.status?t.status<e.status?-1:t.status>e.status?1:d("sort-name")(t,e):-1:e.status?1:d("sort-name")(t,e)};case"sort-name":default:return function(t,e){return t.name?e.name?t.name<e.name?-1:t.name>e.name?1:0:-1:e.name?1:0}}}NMNS.socket.on("get customer list",socketResponse("고객 조회",function(t){if(NMNS.customerList=t.data,t.data&&0<t.data.length){var a=NMNS.calendar.getCalendars();t.data.forEach(function(e){e.manager=a[a.findIndex(function(t){return t.id===e.managerId})]})}l(!(i=0))})),NMNS.socket.on("add customer",socketResponse("고객 추가",function(e){var t=NMNS.customerList.findIndex(function(t){return t.id===e.data.id});Number.isInteger(t)&&-1<t&&(NMNS.customerList[t].totalNoShow=e.data.totalNoShow||0,NMNS.customerList[t].myNoShow=0),$("#customerAddName").val(""),$("#customerAddContact").val(""),$("#customerAddEtc").val("")},function(e){var t=NMNS.customerList.findIndex(function(t){return t.id===e.data.id});Number.isInteger(t)&&-1<t&&(NMNS.customerList.splice(t,1),l(!0))})),NMNS.socket.on("update customer",socketResponse("고객정보 수정",function(e){var t=NMNS.customerList.findIndex(function(t){return t.id===e.data.id});if(Number.isInteger(t)&&-1<t){var a=NMNS.customerList[t];a.name=$("#customerName").val(),a.contact=$("#customerContact").val().replace(/-/gi,""),a.etc=$("#customerEtc").val(),a.managerId=$("#customerManager").data("calendar-id");var s=NMNS.calendar.getCalendars();a.manager=s[s.findIndex(function(t){return t.id===a.managerId})],showSnackBar("<span>고객의 정보를 수정하였습니다.</span>"),l(!0)}},function(e){if("DUPLICATED"===e.data.reason){if(confirm("이미 같은 이름과 연락처를 가진 고객이 존재합니다.\n그 고객쪽으로 모든 정보 및 예약, 알림톡 내역을 합칠까요?"))return void NMNS.socket.emit("merge customer",{id:e.data.id,name:$("#customerName").val(),contact:$("#customerContact").val().replace(/-/gi,""),etc:$("#customerEtc").val(),managerId:$("#customerManager").data("calendar-id")})}else alert("고객정보 수정에 실패하였습니다."+(e.message?"("+e.message+")":""));var t=NMNS.customerList.findIndex(function(t){return t.id===e.data.id});Number.isInteger(t)&&-1<t&&($("#customerName").val(NMNS.customerList[t].name),$("#customerContact").val(NMNS.customerList[t].contact),$("#customerEtc").val(NMNS.customerList[t].etc))},!0)),NMNS.socket.on("get customer alrim",socketResponse("알림톡 내역 조회",function(t){$("#customerAlrimList").data("index",0).data("item",t.data),e(!0)})),NMNS.socket.on("delete customer",socketResponse("고객 삭제",function(t){NMNS.history.remove(t.data.id,function(t,e){return t.id===e})},function(e){var t=NMNS.history.find(function(t){return t.id===e.data.id});NMNS.history.remove(e.data.id,function(t,e){return t.id===e}),NMNS.customerList.splice(t.index,0,t),l(!0)})),NMNS.socket.on("merge customer",socketResponse("고객정보 합치기",function(){NMNS.socket.emit("get customer list",{type:"all",target:""===$("#customerSearchTarget").val()?void 0:$("#customerSearchTarget").val(),sort:$($(".customerSortType.active")[0]).data("action")}),showSnackBar("<span>두 고객의 정보와 예약, 알림톡 내역을 합쳤습니다.</span>"),$("#customerModal").modal("hide")},function(){NMNS.socket.emit("get customer list",{type:"all",target:""===$("#customerSearchTarget").val()?void 0:$("#customerSearchTarget").val(),sort:$($(".customerSortType.active")[0]).data("action")}),$("#customerModal").modal("hide")})),NMNS.socket.on("get membership history",socketResponse("멤버십 내역 조회",function(t){$("#customerMembershipList").data("index",0).data("item",t.data),a(!0)})).on("add membership",socketResponse("멤버십 내역 변경",function(t){$("#customerMembershipList .customerMembership[data-id='"+t.data.id+"'] .balanceMembership").text(((t.data.balanceMembership||"")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))},function(e){var t=$("#customerMembershipList").data("item");t.splice(t.findIndex(function(t){return t.id===e.data.id}),1),a(!0)})),$("#customerModal").on("hidden.bs.modal",function(){if($(this).data("trigger")){$(this).removeData("trigger");var t=$(this).data("customer"),e=moment(new Date);e.hour()>=Number(NMNS.info.bizEndTime.substring(0,2))||e.hour()+1==Number(NMNS.info.bizEndTime.substring(0,2))&&e.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?e=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):e.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||e.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&e.minute()<Number(NMNS.info.bizBeginTime.substring(2))?e=moment(NMNS.info.bizBeginTime,"HHmm"):e.minute(10*Math.ceil(e.minute()/10)),NMNS.calendar.fire("beforeCreateSchedule",{start:e.toDate(),end:e.add(30,"m").toDate(),customer:{name:t.name,contact:t.contact,etc:t.etc,managerId:t.managerId}})}$(this).data("customer",null)}).on("shown.bs.modal",function(){$("#customerName").focus(),$(".modal-backdrop").one("touch click",function(t){$(".modal.show").modal("hide")})}).one("show.bs.modal",function(){$("#customerBtn").on("touch click",function(t){if(t.preventDefault(),""!==$("#customerName").val()||""!==$("#customerContact").val().replace(/-/gi,""))if(0<$("#customerInfo input:invalid").length)alert("입력하신 고객 정보를 확인해주세요.");else{var e=$("#customerModal").data("customer");if(e)NMNS.socket.emit("update customer",{id:e.id,name:$("#customerName").val(),contact:$("#customerContact").val().replace(/-/gi,""),etc:$("#customerEtc").val(),managerId:$("#customerManager").data("calendar-id")});else{if(""===$("#customerName").val()&&""===$("#customerContact").val().replace(/-/gi,""))return void alert("고객 이름과 전화번호 중 하나는 반드시 입력해주세요.");if(0<$("#customerInfo input:invalid").length)return void alert("입력하신 고객 정보를 확인해주세요.");e={id:NMNS.email+generateRandom(),name:$("#customerName").val(),contact:$("#customerContact").val().replace(/-/gi,""),etc:$("#customerEtc").val(),managerId:$("#customerManager").data("calendar-id")},NMNS.socket.emit("add customer",e),NMNS.customerList.splice(0,0,e),l(!0)}$("#customerModal").modal("hide")}else alert("고객 이름과 전화번호 중 하나는 반드시 입력해주세요.")}),$("#customerTabList a[href='#customerAlrim']").on("show.bs.tab",function(){$(this).data("id")!==$("#customerModal").data("customer").id&&($(this).data("id",$("#customerModal").data("customer").id),$("#customerAlrimNotEmpty").hide(),$("#customerAlrimEmpty").hide(),$("#customerAlrimLoading").show(),NMNS.socket.emit("get customer alrim",{id:$("#customerModal").data("customer").id}))}).one("show.bs.tab",function(){var t=!1;$("#customerAlrimList").on("scroll",debounce(function(){!t&&$(this).data("item")&&$(this).data("index")<$(this).data("item").length&&this.scrollHeight-this.scrollTop-this.offsetHeight<Math.max(100,.2*this.getBoundingClientRect().height)&&(t=!0,e(),t=!1)},200))}),$("#customerTabList a[href='#customerSchedule']").on("show.bs.tab",function(){if($(this).data("id")!==$("#customerModal").data("customer").id){var t=$("#customerModal").data("customer");$(this).data("id",t.id),t.history&&0!==t.history.length?($("#customerScheduleNotEmpty").show(),$("#customerScheduleEmpty").hide(),$("#customerScheduleList").data("index",0).data("item",t.history).html(s(!0))):($("#customerScheduleNotEmpty").hide(),$("#customerScheduleEmpty").show())}}).one("show.bs.tab",function(){$(".customerScheduleSortType").off("touch click").on("touch click",function(t){if($(this).hasClass("active"))$("#customerScheduleList").data("item").reverse();else{var e=t.target.getAttribute("data-action");e||(e=t.target.parentElement.getAttribute("data-action")),$("#customerScheduleList").data("item").sort(d(e)),$(".customerScheduleSortType").removeClass("active"),$(".customerScheduleSortType[data-action='"+e+"']").addClass("active")}$("#customerScheduleList").data("index",0),s(!0)});var t=!1;$("#customerScheduleList").on("scroll",debounce(function(){!t&&$(this).data("item")&&$(this).data("index")<$(this).data("item").length&&this.scrollHeight-this.scrollTop-this.offsetHeight<Math.max(100,.2*this.getBoundingClientRect().height)&&(t=!0,s(),t=!1)},200))}),$("#customerTabList a[href='#customerMembership']").on("show.bs.tab",function(){if($(this).data("id")!==$("#customerModal").data("customer").id){var t=$("#customerModal").data("customer").id;$(this).data("id",t),$("#customerMembershipList").hide(),$("#customerMembershipEmpty").hide(),$("#customerMembershipLoading").show(),NMNS.socket.emit("get membership history",{customerId:t})}}).one("show.bs.tab",function(){$("#customerMembershipSales").on("keyup",function(t){13===t.which?$(this).next().next().trigger("click"):$(this).next().removeClass("manual").val($(this).val().replace(/,/gi,""))}),$("#customerMembershipChange").on("keyup",function(t){13===t.which?$(this).next().trigger("click"):$(this).addClass("manual")}),$("#customerMembershipAdjust").on("keyup",function(t){13===t.which&&$(this).next().trigger("click")}),$("#addCustomerMembershipAdjust").on("touch click",function(){var t=$("#customerMembershipAdjust").val().replace(/,/gi,"").match(/^\s*(\+|\-)?\s*([\d]*)\s*$/);if(t){var e={id:NMNS.email+generateRandom(),type:"-"===t[1]?"MEMBERSHIP_DECREMENT":"MEMBERSHIP_INCREMENT",item:"멤버십 금액 조절",customerId:$("#customerModal").data("customer").id,membershipChange:1*t[2],date:moment().format("YYYYMMDD")};0!==e.membershipChange?(NMNS.socket.emit("add membership",e),$("#customerMembershipList").data("item").splice(0,0,e),a(!0)):showSnackBar("조절할 금액을 0보다 크게 입력해주세요.")}else showSnackBar("조절할 금액을 정확히 입력해주세요.")}),$("#addCustomerMembershipSales").on("touch click",function(){if(""!==$("#customerMembershipChange").val().replace(/,/gi,"")&&1*$("#customerMembershipChange").val().replace(/,/gi,"")){var t={id:NMNS.email+generateRandom(),type:"MEMBERSHIP_ADD",item:"멤버십 적립",customerId:$("#customerModal").data("customer").id,payment:$("#customerMembershipCard").prop("checked")?"CARD":$("#customerMembershipCash").prop("checked")?"CASH":null,membershipChange:1*$("#customerMembershipChange").val().replace(/,/gi,""),price:1*$("#customerMembershipSales").val().replace(/,/gi,""),date:moment().format("YYYYMMDD")};t.payment?(NMNS.socket.emit("add membership",t),$("#customerMembershipList").data("item").splice(0,0,t),a(!0),$("#customerMembershipSales").val(""),$("#customerMembershipChange").val("")):showSnackBar("적립 결제수단을 선택해주세요.")}else showSnackBar("적립할 금액을 입력해주세요.")})}),$(".addCustomerScheduleBtn").on("touch click",function(){$("#customerModal").data("trigger",!0).modal("hide"),$($("#sidebarContainer .calendarMenuLink")[0]).trigger("click")})}),$(".customerSortType").off("touch click").on("touch click",function(t){if($(this).hasClass("active"))NMNS.customerList.reverse();else{var e=t.target.getAttribute("data-action");e||(e=t.target.parentElement.getAttribute("data-action")),NMNS.customerList.sort(d(e)),a=e,$(".customerSortType").removeClass("active"),$(".customerSortType[data-action='"+a+"']").addClass("active")}var a;l(!(i=0))}),$("#searchCustomer").on("keyup",function(t){13===t.which&&NMNS.socket.emit("get customer list",{type:"all",target:this.value,sort:$($(".customerSortType.active")[0]).data("action")})}),$("#addCustomerBtn").on("touch click",function(t){t.preventDefault(),o()});var t=!1;$(document).on("scroll",debounce(function(){$("#mainCustomerList").is(":visible")&&!t&&NMNS.customerList&&i<NMNS.customerList.length&&Math.max(document.body.scrollHeight-window.innerHeight-window.scrollY,0)<Math.max(100,.2*window.innerHeight)&&(t=!0,$("#mainCustomerLoading").show(),l(),$("#mainCustomerLoading").hide(),t=!1)},100))}();