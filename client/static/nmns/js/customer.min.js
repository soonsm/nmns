!function(){function a(t){var a=NMNS.customerList[Number(t.parent().data("index"))];$("#customerName").val(a.name),$("#customerContact").val(a.contact),$("#customerEtc").val(a.etc);var e="";e=0===a.totalNoShow?"이 고객은 노쇼하신 적이 없으시네요! :)":0===a.myNoShow?"이 고객은 다른 매장에서 "+a.totalNoShow+"번 노쇼하셨어요.":a.myNoShow===a.totalNoShow?"이 고객은 우리 매장에서만 "+a.totalNoShow+"번 노쇼하셨어요.":"이 고객은 우리 매장에서 "+a.myNoShow+"번, 전체 매장에서 "+a.totalNoShow+"번 노쇼하셨어요.",$("#customerNoShow").text(e),function(t){var e=$("#customerHistory");if(e.children(".card").remove(),e.hasClass("ps")||e.data("scroll",new PerfectScrollbar(e[0])),t.history&&0!==t.history.length){var o="";t.history.forEach(function(t,a){switch(o+='<div class="card col-12 col-lg-10" data-index="'+a+'"><div class="card-body"><h6>'+(t.contents&&""!==t.contents?t.contents:"(예약내용 없음)")+" ",t.status){case"CANCELED":o+="<small class='badge badge-light'>취소</small>";break;case"NOSHOW":o+="<small class='badge badge-danger'>노쇼</small>";break;case"CUSTOMERCANCELED":o+="<small class='badge badge-light'>고객취소</small>";break;case"RESERVED":o+="<small class='badge badge-success'>정상</small>"}o+="</h6>"+(moment(t.date,"YYYYMMDDHHmm").isValid()?'<p class="card-subtitle text-muted">'+moment(t.date,"YYYYMMDDHHmm").format("YYYY-MM-DD HH:mm")+"</p>":"")+'<div class="col-12 px-0"><small class="text-muted">담당자 </small>'+(t.managerName&&""!==t.managerName?'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot" style="background-color:'+t.managerColor+'"></span><span> '+t.managerName+"</span>":"(담당자 없음)")+'</div></div><div class="cardLeftBorder" style="background-color:'+(t.managerColor||"#b2dfdb")+'"></div></div></div>',0<a&&a%50==0&&(e.append(o),o="")}),e.append(o)}else e.append("<span class='text-center'>아직 "+(t.name&&""!==t.name?t.name:"이 ")+"고객에 등록된 예약내역이 없습니다.</span>");e.data("scroll").update()}(a),$("#customerModal").data("customer",a)}function e(){var e=$("#mainCustomerList");e.children(".card").remove(),e.hasClass("ps")||e.data("scroll",new PerfectScrollbar(e[0],{suppressScrollX:!0}));var o="";NMNS.customerList&&0<NMNS.customerList.length&&(NMNS.customerList.forEach(function(t,a){o+='<div class="card row col-12 col-sm-10" data-index="'+a+'"><div class="card-body"><h5 class="card-title">'+(t.name&&""!==t.name?t.name:"(이름없음)")+(t.contact&&""!==t.contact?'&nbsp;<a href="tel:'+t.contact+'" class="d-none d-sm-inline-block customerContactLink"><small class="card-subtitle text-muted">'+dashContact(t.contact)+"</small></a>":"")+"</h5>"+(t.contact&&""!==t.contact?'&nbsp;<a href="tel:'+t.contact+'" class="d-inline-block d-sm-none customerContactLink"><span class="card-subtitle text-muted">'+dashContact(t.contact)+"</span></a>":"")+'<div class="col-12 row px-0"><div class="col-4 border-right"><small class="text-muted">담당자</small><br/>'+(t.history&&0<t.history.length?'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot" style="background-color:'+t.history[0].managerColor+'"></span><span> '+t.history[0].managerName+"</span>":"")+'</div><div class="col-8"><small class="text-muted">메모</small><br/><span>'+(t.etc||"")+'</span></div></div></div><div class="cardLeftBorder" style="background-color:'+(t.history&&0<t.history.length?t.history[0].managerColor:"#b2dfdb")+'"></div><small class="customerSubInfo text-muted">'+(t.history&&0<t.history.length?"총 "+t.history.length+"회 방문":"")+(t.history&&0<t.history.length?" | 마지막 방문 "+moment(t.history[0].date,"YYYYMMDDHHmm").format("YYYY-MM-DD"):"")+'</small><a class="w-100 h-100 position-absolute customerModalLink" href="#" data-toggle="modal" data-target="#customerModal"></a></div></div>',0<a&&a%50==0&&(e.append(o),o="")}),e.append(o),e.data("scroll").update(),e.find(".customerModalLink").off("touch click").on("touch click",function(t){t.preventDefault(),a($(this))}),$("#customerCount").text(NMNS.customerList.length))}function o(t){$(".customerSortType").removeClass("active"),$(".customerSortType[data-action='"+t+"']").addClass("active"),$("#customerSort span").text($("#customerSort").next().children("[data-action='"+t+"']").attr("aria-label"))}function s(t){NMNS.socket.emit("get customer list",{type:"all",target:t})}$(".addHistory").on("touch click",function(t){$($("#sidebarContainer .calendarMenuLink")[0]).trigger("click"),$("#customerModal").data("trigger",!0).modal("hide")}),NMNS.socket.on("get customer list",socketResponse("고객 조회",function(t){NMNS.customerList=t.data,e(),o("sort-name")})),NMNS.socket.on("add customer",socketResponse("고객 추가",function(a){var t=NMNS.customerList.findIndex(function(t){return t.id===a.data.id});-1<t&&(NMNS.customerList[t].totalNoShow=a.data.totalNoShow||0,NMNS.customerList[t].myNoShow=0),$("#customerAddName").val(""),$("#customerAddContact").val(""),$("#customerAddEtc").val("")},function(a){var t=NMNS.customerList.findIndex(function(t){return t.id===a.data.id});-1<t&&(NMNS.customerList.splice(t,1),e())})),NMNS.socket.on("update customer",socketResponse("고객정보 수정",function(a){var t=NMNS.customerList.findIndex(function(t){return t.id===a.data.id});-1<t&&(NMNS.customerList[t].name=$("#customerName").val(),NMNS.customerList[t].contact=$("#customerContact").val(),NMNS.customerList[t].etc=$("#customerEtc").val(),alert("고객의 정보를 수정하였습니다."),e())},function(a){var t=NMNS.customerList.findIndex(function(t){return t.id===a.data.id});-1<t&&($("#customerName").val(NMNS.customerList[t].name),$("#customerContact").val(NMNS.customerList[t].contact),$("#customerEtc").val(NMNS.customerList[t].etc))})),$("#customerModal").on("hidden.bs.modal",function(){if($(this).data("trigger")){$(this).removeData("trigger");var t=$(this).data("customer");NMNS.calendar.openCreationPopup({title:t.name,raw:{contact:t.contact,etc:t.etc},calendarId:t.history&&0<t.history.length?t.history[0].managerId:void 0})}}).on("shown.bs.modal",function(){$("#customerName").focus()}),$("#customerContact, #customerAddContact").off("blur").on("blur",function(){filterNonNumericCharacter($(this))}),$("#submitCustomerAdd").on("touch click",function(t){if(t.preventDefault(),""!==$("#customerAddName").val()||""!==$("#customerAddContact").val()){var a={id:generateRandom(),name:$("#customerAddName").val(),contact:$("#customerAddContact").val(),etc:$("#customerAddEtc").val()};NMNS.socket.emit("add customer",a),NMNS.customerList.splice(0,0,a),e()}else alert("고객 이름과 전화번호 중 하나는 반드시 입력해주세요.")}),$("#submitCustomer").on("touch click",function(t){t.preventDefault();var a=$("#customerModal").data("customer");if(a){if(""===$("#customerName").val()&&""===$("#customerContact").val())return void alert("고객 이름과 전화번호 중 하나는 반드시 입력해주세요.");NMNS.socket.emit("update customer",{id:a.id,name:$("#customerName").val(),contact:$("#customerContact").val(),etc:$("#customerEtc").val()})}else alert("알 수 없는 오류입니다. 새로고침 후 다시 시도해주세요.")}),$(".customerSortType").off("touch click").on("touch click",function(t){if(!$(this).hasClass("active")){var a=t.target.getAttribute("data-action");a||(a=t.target.parentElement.getAttribute("data-action")),NMNS.customerList.sort(function e(t){switch(t){case"sort-date":return function(t,a){return t.history&&0!==t.history.length?a.history&&0!==a.history.length?t.history[0].date<a.history[0].date?1:t.history[0].date>a.history[0].date?-1:e("sort-name")(t,a):1:a.history&&0<a.history.length?-1:0};case"sort-manager":return function(t,a){return t.history&&0!==t.history.length?a.history&&0!==a.history.length?t.history[0].managerName<a.history[0].managerName?-1:t.history[0].managerName>a.history[0].managerName?1:e("sort-name")(t,a):-1:a.history&&0<a.history.length?1:0};case"sort-name":default:return function(t,a){return t.name?a.name?t.name<a.name?-1:t.name>a.name?1:0:-1:a.name?1:0}}}(a)),e(),o(a)}}),$("#customerSearchBtn").on("touch click",function(t){t.preventDefault(),s($("#customerSearchTarget").val())}),$("#customerSearchTarget").on("keyup",function(t){13===t.which&&s($(this).val())})}();