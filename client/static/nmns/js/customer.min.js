function drawCustomerHistoryList(a){var s=$("#customerHistory");if(s.children(".card").remove(),s.hasClass("ps")||s.data("scroll",new PerfectScrollbar(s[0])),0===a.history.length)s.append("<span class='text-center'>아직 "+(a.name&&""!==a.name?a.name:"이 ")+"고객에 등록된 예약내역이 없습니다.</span>");else{var o="";a.history.forEach(function(a,t){switch(o+='<div class="card col-12 col-lg-10" data-index="'+t+'"><div class="card-body"><h6>'+(a.contents&&""!==a.contents?a.contents:"(예약내용 없음)")+" ",a.status){case"CANCELED":o+="<small class='badge badge-light'>취소</small>";break;case"NOSHOW":o+="<small class='badge badge-danger'>노쇼</small>";break;case"CUSTOMERCANCELED":o+="<small class='badge badge-light'>고객취소</small>";break;case"RESERVED":o+="<small class='badge badge-success'>정상</small>"}o+="</h6>"+(moment(a.date,"YYYYMMDDHHmm").isValid()?'<p class="card-subtitle text-muted">'+moment(a.date,"YYYYMMDDHHmm").format("YYYY-MM-DD HH:mm")+"</p>":"")+'<div class="col-12 px-0"><small class="text-muted">담당자 </small>'+(a.managerName&&""!==a.managerName?'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot" style="background-color:'+a.managerColor+'"></span><span> '+a.managerName+"</span>":"(담당자 없음)")+'</div></div><div class="cardLeftBorder" style="background-color:'+(a.managerColor||"#b2dfdb")+'"></div></div></div>',0<t&&t%50==0&&(s.append(o),o="")}),s.append(o)}s.data("scroll").update()}function initCustomerModal(a){var t=NMNS.customerList[Number(a.parent().data("index"))];$("#customerName").val(t.name),$("#customerContact").val(t.contact),$("#customerEtc").val(t.etc);var s="";s=0===t.totalNoShow?"이 고객은 노쇼하신 적이 없으시네요! :)":0===t.myNoShow?"이 고객은 다른 매장에서 "+t.totalNoShow+"번 노쇼하셨어요.":t.myNoShow===t.totalNoShow?"이 고객은 우리 매장에서만 "+t.totalNoShow+"번 노쇼하셨어요.":"이 고객은 우리 매장에서 "+t.myNoShow+"번, 전체 매장에서 "+t.totalNoShow+"번 노쇼하셨어요.",$("#customerNoShow").text(s),drawCustomerHistoryList(t),$("#customerName").focus(),$("#customerModal").data("customer",t)}function drawCustomerList(){var s=$("#mainCustomerList");s.children(".card").remove(),s.hasClass("ps")||s.data("scroll",new PerfectScrollbar(s[0],{suppressScrollX:!0}));var o="";NMNS.customerList&&0<NMNS.customerList.length&&(NMNS.customerList.forEach(function(a,t){o+='<div class="card row col-12 col-sm-10" data-index="'+t+'"><div class="card-body"><h5 class="card-title">'+(a.name&&""!==a.name?a.name:"(이름없음)")+(a.contact&&""!==a.contact?'&nbsp;<a href="tel:'+a.contact+'"><small class="card-subtitle text-muted">'+dashContact(a.contact)+"</small></a>":"")+'</h5><div class="col-12 row px-0"><div class="col-4 border-right"><small class="text-muted">담당자</small><br/>'+(a.history&&0<a.history.length?'<span class="tui-full-calendar-icon tui-full-calendar-calendar-dot" style="background-color:'+a.history[0].managerColor+'"></span><span> '+a.history[0].managerName+"</span>":"")+'</div><div class="col-8"><small class="text-muted">메모</small><br/><span>'+(a.etc||"")+'</span></div></div></div><div class="cardLeftBorder" style="background-color:'+(a.history&&0<a.history.length?a.history[0].managerColor:"#b2dfdb")+'"></div><small class="customerSubInfo text-muted">'+(a.history&&0<a.history.length?"총 "+a.history.length+"회 방문":"")+(a.history&&0<a.history.length?" | 마지막 방문 "+moment(a.history[0].date,"YYYYMMDDHHmm").format("YYYY-MM-DD"):"")+'</small><a class="w-100 h-100 position-absolute customerModalLink" href="#" data-toggle="modal" data-target="#customerModal"></a></div></div>',0<t&&t%50==0&&(s.append(o),o="")}),s.append(o),s.data("scroll").update(),s.find(".customerModalLink").off("touch click").on("touch click",function(a){a.preventDefault(),initCustomerModal($(this))}),$("#customerCount").text(NMNS.customerList.length))}$(".addHistory").on("touch click",function(a){$($("#sidebarContainer .calendarMenuLink")[0]).trigger("click"),$("#customerModal").data("trigger",!0).modal("hide")}),NMNS.socket.on("get customer list",socketResponse("고객 조회",function(a){NMNS.customerList=a.data,drawCustomerList(),console.log(a)})),$("#customerModal").on("hidden.bs.modal",function(){if($(this).data("trigger")){$(this).removeData("trigger");var a=$(this).data("customer");NMNS.calendar.openCreationPopup({title:a.name,raw:{contact:a.contact,etc:a.etc},calendarId:a.history&&0<a.history.length?a.history[0].managerId:void 0})}});