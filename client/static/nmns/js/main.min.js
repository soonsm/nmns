!function(l){if(document.documentMode){var e,a=navigator.userAgent.toLowerCase();if("Microsoft Internet Explorer"==navigator.appName?e="msie ":-1<a.search("trident")?e="trident/.*rv:":-1<a.search("edge/")&&(e="edge/"),null!==new RegExp(e+"([0-9]{1,})(\\.{0,}[0-9]{0,1})").exec(a)&&parseFloat(RegExp.$1+RegExp.$2)<10&&!confirm("오래된 IE"+parseFloat(RegExp.$1+RegExp.$2)+" 브라우저를 사용하고 계십니다.\n 계속하시면 페이지가 정확히 표시되지 않을 수 있습니다. 그래도 계속하시겠습니까?\n *No More No Show는 IE10 이상의 브라우저를 지원하고,\nChrome 브라우저에 최적화되어있습니다."))return location.href="/signout"}function t(e,a){var t="task"===e.category?"일정":"예약",n="";if(console.log("get time schedule : ",e),"week"===NMNS.calendar.getViewName())n+="<div class='tui-full-calendar-schedule-cover font-weight-bold row mx-auto align-items-center'><div class='col-11 px-0'>",a||(n+="<div class='row' style='margin-bottom:10px'><div class='montserrat col' style='font-weight:500'>"+moment(e.start.toDate()).format("HH:mm")+" - "+moment(e.end.toDate()).format("HH:mm")+"</div></div>"),e.title&&(n+="<div class='row'><div class='col' title='"+t+"이름:"+e.title+"'>","task"===e.category?n+="<span>#</span>":a&&(n+="<span class='far fa-clock'></span> "),n+=e.title+"</div></div>"),n+="</div></div>";else if("day"===NMNS.calendar.getViewName()){switch(n+="<div class='tui-full-calendar-schedule-cover flex-column d-flex' style='padding:20px'><div class='row align-items-center' style='margin-bottom:5px'><div class='col d-flex'>",e.raw.contents&&(n+="<div title='"+t+"내용:'"+e.raw.contents+" class='tui-full-calendar-time-schedule-title'>"+e.raw.contents+"</div>"),e.raw.status){case"CANCELED":n+="<span title='상태/"+t+"내용'><span class='badge badge-light'>취소</span>";break;case"NOSHOW":n+="<span title='상태/"+t+"내용'><span class='badge badge-danger'>노쇼</span>";break;case"CUSTOMERCANCELED":n+="<span title='상태/"+t+"내용'><span class='badge badge-light'>고객취소</span>"}n+="<div class='montserrat ml-auto' style='font-weight:500'>"+moment(e.start.toDate()).format("HH:mm")+" - "+moment(e.end.toDate()).format("HH:mm")+"</div></div></div><div>"+(e.raw.etc||"")+"</div><div class='mt-auto tui-full-calendar-time-schedule-contact'>"+(e.title?"<span title='이름:"+e.title+"' class='mr-1'>"+e.title+"</span>":"")+(e.raw.contact?"<span title='연락처:"+dashContact(e.raw.contact,".")+"'>"+dashContact(e.raw.contact,".")+"</span>":"")+"</div></div>"}else n+="</div>";return n}function n(e){var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action"));var t="";switch(a){case"toggle-daily":t="day",l("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-weekly":t="week",l("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-monthly":t="month",l("#mainCalendar").css("height","598px")}NMNS.calendar.changeView(t,!0),u(),m(),h()}function o(e){var a=e.target.getAttribute("data-action");switch(a||(a=e.target.parentElement.getAttribute("data-action")),a){case"prev":NMNS.calendar.prev();break;case"next":NMNS.calendar.next();break;default:return}m(),h()}function i(e){e.preventDefault();var a,t,n;l(e.target).closest('a[role="menuitem"]')[0].getAttribute("data-action");a=document.getElementById("calendarName"),t=NMNS.manager,(n=[]).push('<span class="calendar-bar" style="background-color: '+t.bgColor+"; border-color:"+t.borderColor+';"></span>'),n.push('<span class="calendar-name">'+t.name+"</span>"),a.innerHTML=n.join("")}function c(e){e.preventDefault();var a=moment(new Date);a.hour()>=Number(NMNS.info.bizEndTime.substring(0,2))||a.hour()+1==Number(NMNS.info.bizEndTime.substring(0,2))&&a.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?a=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):a.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||a.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&a.minute()<Number(NMNS.info.bizBeginTime.substring(2))?a=moment(NMNS.info.bizBeginTime,"HHmm"):a.minute(10*Math.ceil(a.minute()/10)),NMNS.calendar.openCreationPopup({start:a.toDate(),end:a.add(30,"m").toDate()}),l("#creationPopupName").focus()}function r(a){return NMNS.calendar.getCalendars().find(function(e){return e.id===a})}function d(e){var a=e.target.checked,t=l(e.target).parents(".lnbManagerItem");if(!t.is(".addManagerItem")){var n=t.data("value");n&&(r(n).checked=a),s()}}function s(){var e=Array.prototype.slice.call(document.querySelectorAll("#lnbManagerList input"));NMNS.calendar.getCalendars().forEach(function(e){NMNS.calendar.toggleSchedules(e.id,!e.checked,!1)}),NMNS.calendar.render(!0),e.forEach(function(e){var a=e.nextElementSibling;a.style.backgroundColor=e.checked?a.getAttribute("data-color"):"transparent",a.style.borderColor=e.checked?a.getAttribute("data-color"):"#7f8fa4"})}function u(){switch(l(".calendarType").removeClass("active"),NMNS.calendar.getViewName()){case"day":l("#calendarTypeMenu").html(l(".calendarType[data-action='toggle-daily']").addClass("active").html());break;case"week":l("#calendarTypeMenu").html(l(".calendarType[data-action='toggle-weekly']").addClass("active").html());break;default:l("#calendarTypeMenu").html(l(".calendarType[data-action='toggle-monthly']").addClass("active").html())}}function m(){var e=document.getElementById("renderRange"),a=NMNS.calendar.getOptions(),t=NMNS.calendar.getViewName(),n="";"day"===t?(n+=moment(NMNS.calendar.getDate().getTime()).format("YYYY. MM. DD"),n+="<span class='ml-2 base-font' style='opacity:0.5;font-size:22px;vertical-align:bottom'>"+["일","월","화","수","목","금","토"][moment(NMNS.calendar.getDate().getTime()).day()]+"요일</span>"):"month"===t&&(!a.month.visibleWeeksCount||4<a.month.visibleWeeksCount)?n+=moment(NMNS.calendar.getDate().getTime()).format("YYYY. MM"):(n+=moment(NMNS.calendar.getDateRangeStart().getTime()).format("YYYY. MM. DD"),n+=" - ",n+=moment(NMNS.calendar.getDateRangeEnd().getTime()).format(" MM. DD")),e.innerHTML=n}function h(){var e,a;NMNS.calendar.clear(),e=NMNS.calendar.getDateRangeStart(),a=NMNS.calendar.getDateRangeEnd(),NMNS.socket.emit("get reserv",{start:toYYYYMMDD(e._date)+"0000",end:toYYYYMMDD(a._date)+"2359"})}function f(e){switch(e){case"BEFORE_EMAIL_VERIFICATION":return"<span class='badge badge-danger' title='인증메일 보내기' style='cursor:pointer;'>이메일 미인증</span><span class='btn btn-sm btn-flat btn-secondary ml-2'>인증메일 보내기</span>";case"EMAIL_VERIFICATED":return"<span class='badge badge-success'>인증</span>"}return l("#infoAccountStatus").removeClass("pl-2"),""}function p(e){switch(e){case"RESERVED":return"<span class='badge badge-success' title='바꾸기'>정상 </span><span class='btn btn-sm btn-light noShowScheduleNoShow' title='노쇼처리'><i class='fas fa-exclamation-triangle'></i><span class='d-none d-lg-inline-block'> 노쇼처리</span></span>";case"CANCELED":case"CUSTOMERCANCELED":return"<span class='badge badge-secondary' title='바꾸기'>취소 </span><span class='btn btn-sm btn-light noShowScheduleNoShow' title='노쇼처리'><i class='fas fa-exclamation-triangle'></i><span class='d-none d-lg-inline-block'> 노쇼처리</span></span>";case"NOSHOW":return"<span class='badge badge-danger' title='바꾸기'>노쇼 </span><span class='btn btn-sm btn-light noShowScheduleNormal' title='되돌리기'><i class='fas fa-undo'></i><span class='d-none d-lg-inline-block'> 되돌리기</span></span>"}return""}function N(e){var a="";return e.forEach(function(e){a+="<div class='infoManagerItem'><label><input class='tui-full-calendar-checkbox-round' checked='checked' readonly='readonly' type='checkbox'/><span class='infoManagerColor' style='background-color:"+e.color+"; border-color:"+e.color+";'></span><input type='text' name='name' class='align-middle form-control form-control-sm rounded-0' data-id='"+e.id+"' data-color='"+e.color+"' placeholder='담당자 이름' value='"+e.name+"' data-name='"+e.name+"'/></label><i class='fas fa-trash deleteManager pl-2' title='삭제'></i></div>"}),a}function S(e){var a="";return e.forEach(function(e){a+="<div class='lnbManagerItem row mx-0' data-value='"+e.id+"'><label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'>",a+="<span title='이 담당자의 예약 가리기/보이기' data-color='"+e.color+"'></span><span class='menu-collapsed'>"+e.name+"</span></label><button class='btn btn-sm btn-flat lnbManagerAction ml-auto text-white py-0 pr-0' type='button'><i class='fa fa-ellipsis-v'></i></button></div>"}),a}function g(e){l("#mainShopName").length?""!==e?l("#mainShopName").text(e):l("#navbarResponsive").prev().children("span").html(NMNS.email):""!==e&&l("#navbarResponsive").prev().children("span").html("<span id='mainShopName'>"+e+"</span><small class='d-none d-md-inline-block'>("+NMNS.email+")</small>")}function M(){"Y"===NMNS.info.alrimTalkInfo.useYn?(l("#alrimUseYn").prop("checked",!0),l("#alrimScreen").hide()):(l("#alrimUseYn").prop("checked",!1),l("#alrimScreen").show()),l("#alrimCallbackPhone").val(NMNS.info.alrimTalkInfo.callbackPhone||""),l("#alrimShopName").val(NMNS.info.shopName||""),l("#alrimCancelDue").val(NMNS.info.alrimTalkInfo.cancelDue||""),l("#alrimNotice").val(NMNS.info.alrimTalkInfo.notice||""),l("#noticeByteCount").text(l("#alrimNotice").val().length),"알림톡 정보"!==l("#alrimModalTitle").text()&&l("#alrimSwitchBtn").trigger("click")}function b(){if(700<l("#alrimNotice").val().length)return alert("알림 안내문구의 길이가 너무 깁니다. 조금만 줄여주세요 :)"),void l("#alrimNotice").focus();if(l("#alrimUseYn").prop("checked")){if(""===l("#alrimCallbackPhone").val())return alert("알림톡을 사용하시려면 반드시 휴대폰번호를 입력해주세요!"),void l("#alrimCallbackPhone").focus();if(!/^01([016789]?)([0-9]{3,4})([0-9]{4})$/.test(l("#alrimCallbackPhone").val()))return alert("입력하신 휴대폰번호가 정확하지 않은 것 같습니다.\n휴대폰번호를 정확히 입력해주세요!"),void l("#alrimCallbackPhone").focus();if(""===l("#alrimShopName").val())return alert("알림톡을 사용하시려면 고객에게 보여줄 매장 이름을 입력해주세요!"),void l("#alrimShopName").focus()}var e={},a={id:"alrimInfo"},t=!1;l("#alrimShopName").val()!==(NMNS.info.shopName||"")&&(NMNS.history.push({id:"info",shopName:NMNS.info.shopName}),e={shopName:l("#alrimShopName").val()},NMNS.info.shopName=e.shopName,NMNS.socket.emit("update info",e),g(e.shopName),e={},t=!0),(l("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!l("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(a.useYn=NMNS.info.alrimTalkInfo.useYn,e.useYn=l("#alrimUseYn").prop("checked")?"Y":"N",NMNS.info.alrimTalkInfo.useYn=e.useYn),l("#alrimCallbackPhone").val()!==(NMNS.info.alrimTalkInfo.callbackPhone||"")&&(a.callbackPhone=NMNS.info.alrimTalkInfo.callbackPhone,e.callbackPhone=l("#alrimCallbackPhone").val(),NMNS.info.alrimTalkInfo.callbackPhone=e.callbackPhone),l("#alrimCancelDue").val()!==(NMNS.info.alrimTalkInfo.cancelDue||"")&&(a.cancelDue=NMNS.info.alrimTalkInfo.cancelDue,e.cancelDue=l("#alrimCancelDue").val(),NMNS.info.alrimTalkInfo.cancelDue=e.cancelDue),l("#alrimNotice").val()!==(NMNS.info.alrimTalkInfo.notice||"")&&(a.notice=NMNS.info.alrimTalkInfo.notice,e.notice=l("#alrimNotice").val(),NMNS.info.alrimTalkInfo.notice=e.notice),Object.keys(e).length&&(NMNS.history.push(a),NMNS.socket.emit("update alrim",e)),Object.keys(e).length||t?l("#alrimModal").modal("hide"):showSnackBar("<span>변경된 내역이 없습니다.</span>")}function k(){if(l(".infoManagerItem input[type='text']").length){var e=!0;if(l(".infoManagerItem input[type='text']").each(function(){l(this).val().length||(e=!1,l(this).focus())}),e){var a=moment(l("#infoBizBeginTime").val(),"HH:mm");if(!a.isValid())return alert("매장 운영 시작시간이 올바르지 않습니다."),void l("#infoBizBeginTime").focus();var t=moment(l("#infoBizEndTime").val(),"HH:mm");if(!t.isValid())return alert("매장 운영 종료시간이 올바르지 않습니다."),void l("#infoBizEndTime").focus();if(a.isAfter(t,"hour")&&(a=[t,t=a][0]),""===l("#infoShopName").val()&&"Y"===NMNS.info.alrimTalkInfo.useYn)return alert("알림톡을 사용하고 계실 때는 예약고객에게 보여드릴 매장이름이 반드시 있어야 합니다.\n매장이름을 삭제하고 싶으시다면 알림톡 사용을 먼저 해제해주세요."),void l("#infoShopName").val(NMNS.info.shopName);var n={},o={id:"info"};a.format("HHmm")===NMNS.info.bizBeginTime&&t.format("HHmm")===NMNS.info.bizEndTime||(o.hourStart=NMNS.info.bizBeginTime||"0900",o.hourEnd=NMNS.info.bizEndTime||"2300",n.bizBeginTime=a.format("HHmm"),n.bizEndTime=t.format("HHmm"),NMNS.info.bizBeginTime=n.bizBeginTime||"0900",NMNS.info.bizEndTime=n.bizEndTime||"2300",NMNS.calendar.setOptions({week:{hourStart:n.bizBeginTime?parseInt(n.bizBeginTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourStart,hourEnd:n.bizEndTime?parseInt(n.bizEndTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourEnd}})),l("#infoShopName").val()!==(NMNS.info.shopName||"")&&(o.shopName=NMNS.info.shopName,n.shopName=l("#infoShopName").val(),NMNS.info.shopName=n.shopName,g(n.shopName)),l("#infoBizType").val()!==(NMNS.info.bizType||"")&&(o.bizType=NMNS.info.bizType,n.bizType=l("#infoBizType").val(),NMNS.info.bizType=n.bizType),Object.keys(n).length&&(NMNS.history.push(o),NMNS.socket.emit("update info",n));var i=!1;""!==l("#infoPassword").val()&&(NMNS.socket.emit("update password",{password:l("#infoPassword").val()}),l("#infoPassword").val(""),i=!0),l(".infoManagerItem").each(function(){if(l(this).hasClass("addManagerItem"))i=!0,H(l(this).find("input[type='text']")[0]);else{var e=l(this).find("input[type='text']"),a=r(e.data("id"));if(l(this).data("delete")&&a)i=!0,NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().remove(a.id,function(e,a){return e.id===a})),NMNS.history.push({id:a.id,bgColor:a.bgColor,borderColor:a.borderColor,color:a.color,name:a.name}),NMNS.socket.emit("delete manager",{id:a.id});else if(a&&(e.data("color")!==a.bgColor||e.val()!==a.name)){i=!0;var t=e.data("color");NMNS.calendar.setCalendar(a.id,{color:t,bgColor:getBackgroundColor(t),borderColor:t,name:e.val()},!0),NMNS.calendar.setCalendarColor(a.id,{color:t,bgColor:getBackgroundColor(t),borderColor:t},!0),NMNS.history.push({id:a.id,color:a.bgColor,name:a.name}),NMNS.socket.emit("update manager",{id:a.id,color:t,name:e.val()})}}}),i&&(l("#lnbManagerList").html(S(NMNS.calendar.getCalendars())),s()),i||Object.keys(n).length?l("#infoModal").modal("hide"):showSnackBar("<span>변경된 내역이 없습니다.</span>")}else alert("담당자의 이름을 입력해주세요.")}else alert("담당자는 최소 1명 이상이 있어야 합니다.")}function v(e){l("#infoModalColorPicker").css("left",l("#infoManagerList").position().left+e.position().left+"px").css("top",l("#infoManagerList").position().top+e.position().top+74+"px").data("target",e.next().data("id")).show(300)}function w(){l("#infoEmail").text(NMNS.email),l("#infoPassword").val(""),l("#infoAuthStatus").html("BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus?l(f(NMNS.info.authStatus)).on("touch click",function(){NMNS.socket.emit("send verification",{}),showSnackBar("<span>인증메일을 보냈습니다. 도착한 이메일을 확인해주세요!</span>")}):f(NMNS.info.authStatus)),l("#infoShopName").val(NMNS.info.shopName),l("#infoBizType").val(NMNS.info.bizType);var e=l("#infoManagerList");e.hasClass("ps")?(e.children(":not(.ps__rail-x):not(.ps__rail-y)").remove(),l(N(NMNS.calendar.getCalendars())).prependTo(e)):(e.html(N(NMNS.calendar.getCalendars())),e.data("scroll",new PerfectScrollbar(e[0]))),l(".infoManagerItem .deleteManager").off("touch click").on("touch click",function(){var e=l(this).parents(".infoManagerItem");0!=e.siblings(".infoManagerItem:visible").length?(e.hide(),l(e.siblings(".infoManagerItem:visible")[0]).find("input.form-control").focus(),e.attr("data-delete","true"),l("#infoManagerList").data("scroll").update()):alert("담당자는 반드시 1명 이상 있어야합니다!")}),l(".infoManagerItem input.form-control").off("keyup").on("keyup",function(e){if(27===e.which){var a=l(this).parents(".infoManagerItem");if(0==a.siblings(".infoManagerItem:visible").length)return;a.hide(),l(a.siblings(".infoManagerItem:visible")[0]).find("input.form-control").focus(),a.attr("data-delete","true"),l("#infoManagerList").data("scroll").update()}}),l(".infoManagerItem .infoManagerColor").off("touch click").on("touch click",function(){v(l(this))})}function y(e){var a=e.children("input"),t=e.parent();NMNS.history.push({id:t.data("id"),calendarId:t.data("manager"),status:"NOSHOW"}),NMNS.calendar.updateSchedule(t.data("id"),t.data("manager"),{raw:{status:"NOSHOW"}}),NMNS.socket.emit("update reserv",{id:t.data("id"),status:"NOSHOW",noShowCase:a.val()});var n=l("#noShowScheduleList .row[data-id='"+t.data("id")+"']");n.children("span:last-child").html(l(p("NOSHOW"))),n.find(".badge, .noShowScheduleNoShow").each(function(){l(this).on("touch click",function(e){e.stopPropagation(),E(l(this))})}),n.find(".noShowScheduleNormal").on("touch click",function(e){e.stopPropagation(),V(l(this))}),t.hide(300)}function C(){if(NMNS.initedNoShowModal)l("#noShowAddContact").autocomplete().clearCache(),l("#noShowSearchContact").autocomplete().clearCache(),l("#noShowScheduleName").autocomplete().clearCache(),l("#noShowScheduleContact").autocomplete().clearCache();else{NMNS.initedNoShowModal=!0;var t={format:"Y-m-d",defaultDate:new Date,appendTo:document.getElementById("noShowModal"),locale:"ko",closeOnSelect:!0};l("#noShowSearchList").hasClass("ps")||l("#noShowSearchList").data("scroll",new PerfectScrollbar("#noShowSearchList",{suppressScrollX:!0})),l("#noShowScheduleList").hasClass("ps")||l("#noShowScheduleList").data("scroll",new PerfectScrollbar("#noShowScheduleList",{suppressScrollX:!0})),l(".noShowAddCase").off("touch click").on("touch click",function(){l(".noShowAddCase").not(l(this)).removeClass("badge-danger").addClass("badge-light"),l(this).removeClass("badge-light").addClass("badge-danger").is("#noShowAddCaseEtc")?l(this).next().removeAttr("disabled").focus():l(this).siblings("input").attr("disabled","disabled")}),l("#noShowAddBtn").off("touch click").on("touch click",function(){if(""!==l("#noShowAddContact").val()){var e=l("#noShowAddContent .badge-danger").is("#noShowAddCaseEtc")?l("#noShowAddContent input").val():l("#noShowAddContent .badge-danger").data("value");NMNS.socket.emit("add noshow",{id:NMNS.email+generateRandom(),contact:l("#noShowAddContact").val(),noShowCase:e})}else alert("저장할 전화번호를 입력해주세요!")}),l("#noShowSearchBtn").off("touch click").on("touch click",function(){""!==l("#noShowSearchContact").val()?NMNS.socket.emit("get noshow",{contact:l("#noShowSearchContact").val(),mine:!1}):alert("검색할 전화번호를 입력해주세요!")}),l("#noShowScheduleSearch").off("touch click").on("touch click",function(){var e={};if(""!==l("#noShowScheduleStartDate").val()){var a=moment(l("#noShowScheduleStartDate").val(),"YYYY-MM-DD");if(!a.isValid())return void alert("검색 시작일자가 올바르지 않습니다. 다시 입력해주세요!");e.start=a.format("YYYYMMDD")}if(""!==l("#noShowScheduleEndDate").val()){var t=moment(l("#noShowScheduleEndDate").val(),"YYYY-MM-DD");if(!t.isValid())return void alert("검색 끝일자가 올바르지 않습니다. 다시 입력해주세요!");e.end=t.format("YYYYMMDD")}""!==l("#noShowScheduleName").val()&&(e.name=l("#noShowScheduleName").val()),""!==l("#noShowScheduleContact").val()&&(e.contact=l("#noShowScheduleContact").val()),l("#noShowScheduleList .row").remove(),NMNS.socket.emit("get summary",e)}),l("#noShowSearchAdd").off("touch click").on("touch click",function(){var e=generateRandom(),a=l("<div class='row px-0 col-12 mt-1 noShowSearchAdd' data-id='"+e+"'><div class='col-4 pr-0'><input type='text' class='form-control form-control-sm rounded-0' name='noShowSearchAddContact' placeholder='고객 전화번호'></div><div id='noShowSearchAddDatePicker"+e+"' class='col-4 input-group input-group-sm pr-0'><div class='input-group-prepend'><i id='noShowSearchAddDateIcon"+e+"' class='input-group-text far fa-calendar rounded-0'></i></div><input id='noShowSearchAddDate"+e+"' type='text' class='form-control form-control-sm rounded-0' name='noShowSearchAddDate' aria-describedby='noShowSearchAddDateIcon"+e+"'></div><div class='col-3'><select class='form-control form-control-sm rounded-0' name='noShowType'><option value='지각'>지각</option><option value='잠수' selected='selected'>잠수</option><option value='직전취소'>직전취소</option><option value='기타'>기타</option></select></div><div class='col-1 px-0'><i class='fas fa-check noShowSearchAddSubmit align-middle' title='저장'></i>  <i class='fas fa-trash noShowSearchAddCancel align-middle ml-lg-2 ml-md-1' title='취소'></i></div></div>");l("#noShowSearchList .empty").length?l("#noShowSearchList").html(a):l("#noShowSearchList").append(a),a.find(".noShowSearchAddSubmit").off("touch click").on("touch click",function(){I(l(this))}),a.find(".noShowSearchAddCancel").off("touch click").on("touch click",function(){var e,a;e=l(this),(a=e.parentsUntil("#noShowSearchList",".row")).data("datetimepicker").destroy(),a.remove(),""===l("#noShowSearchList").html()&&l("#noShowSearchList").html("<div class='row col-12 px-0 mt-2 empty'><span class='col-12 text-center'>전화번호로 검색하거나 아래 버튼을 눌러<br/>노쇼를 직접 추가해보세요!</span></div>")}),a.find("input[name='noShowSearchAddContact']").off("blur").on("blur",function(){filterNonNumericCharacter(l(this))}).val(l("#noShowSearchContact").val()).select().focus(),a.data("datetimepicker",flatpickr("#noShowSearchAddDate"+e,t))}),l("#noShowSearchContact, #noShowAddContact, #noShowScheduleContact").off("blur").on("blur",function(){filterNonNumericCharacter(l(this))}),l("#noShowSearchContact").on("keyup",function(e){13===e.which&&(filterNonNumericCharacter(l(this)),l("#noShowSearchBtn").trigger("click"))}),l("#noShowAddContact").on("keyup",function(e){13===e.which&&(filterNonNumericCharacter(l(this)),l("#noShowAddBtn").trigger("click"))}),l("#noShowScheduleContact").off("keyup").on("keyup",function(e){13===e.which&&(filterNonNumericCharacter(l(this)),l("#noShowScheduleSearch").trigger("click"))}),flatpickr("#noShowScheduleStartDate",t).setDate(moment().subtract(1,"M").toDate()),flatpickr("#noShowScheduleEndDate",t).setDate(moment().add(1,"M").toDate()),l("#noShowScheduleDropdown .dropdown-item:not(:last-child)").off("touch click").on("touch click",function(e){var a=l(this).parent();e.preventDefault(),NMNS.history.push({id:a.data("id"),calendarId:a.data("manager"),raw:{status:a.data("status")}}),NMNS.calendar.updateSchedule(a.data("id"),a.data("manager"),{raw:{status:l(this).data("status")}}),NMNS.socket.emit("update reserv",{id:a.data("id"),status:l(this).data("status"),noShowCase:l(this).data("type")});var t=l("#noShowScheduleList .row[data-id='"+a.data("id")+"']");t.children("span:last-child").html(l(p(l(this).data("status")))),t.find(".badge, .noShowScheduleNoShow").each(function(){l(this).on("touch click",function(e){e.stopPropagation(),E(l(this))})}),t.find(".noShowScheduleNormal").on("touch click",function(e){e.stopPropagation(),V(l(this))}),a.hide(300)}),l("#noShowScheduleDropdown .noShowScheduleCheck").off("touch click").on("touch click",function(){y(l(this).parent())}),l("#noShowScheduleDropdown .dropdown-item-etc").off("touch click").on("touch click",function(e){e.preventDefault()}),l("#noShowScheduleDropdown .dropdown-item-etc input").off("keyup").on("keyup",function(e){switch(e.which){case 13:y(l(this).parent());break;case 27:l(this).parent().parent().hide(300)}}).off("touch click").on("touch click",function(e){e.preventDefault(),e.stopPropagation(),l(this).focus()}),l("#noShowAddContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),l("#noShowSearchContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),l("#noShowScheduleName").autocomplete({serviceUrl:"get customer info",paramName:"name",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return e.value+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){l("#noShowScheduleContact").val(e.data)}},NMNS.socket),l("#noShowScheduleContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){l("#noShowScheduleName").val(e.data)}},NMNS.socket)}}function D(){var a="";return NMNS.calendar.getCalendars().forEach(function(e){a+="<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='"+e.id+"' data-bgcolor='"+e.bgColor+"'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+e.bgColor+"'></span><span class='tui-full-calendar-content'>"+e.name+"</span></button>"}),a}function T(a){if(!NMNS.initedTaskModal){var e={format:"Y-m-d H:i",enableTime:NMNS.initedTaskModal=!0,defaultDate:new Date,appendTo:document.getElementById("taskModal"),locale:"ko",minuteIncrement:10,time_24hr:!0,minTime:moment(NMNS.info.bizBeginTime||"0900","HHmm").format("HH:mm"),maxTime:moment(NMNS.info.bizEndTime||"2300","HHmm").format("HH:mm"),applyBtn:!0};flatpickr("#taskStartDate",e),flatpickr("#taskEndDate",e),l("#taskModalSave").on("touch click",function(){if(""===l("#taskName").val())return alert("일정 이름을 입력해주세요!"),void l("#taskName").focus();var e,a=l("#taskStartDate")[0]._flatpickr.selectedDates[0],t=l("#taskEndDate")[0]._flatpickr.selectedDates[0];if(a.getTime()>t.getTime()&&(a=[t,t=a][0]),l("#taskModal").data("edit")){var n=l("#taskModal").data("task");n.manager=n.calendarId,NMNS.history.push(n),n.calendarId!==l("#taskManager").data("calendar-id")?(n.newCalendarId=l("#taskManager").data("calendar-id"),NMNS.calendar.deleteSchedule(n.id,n.manager,!0),NMNS.calendar.createSchedules([{id:n.id,calendarId:l("#taskManager").data("calendar-id"),title:l("#taskName").val(),start:a,end:t,isAllDay:!1,category:"task",dueDateClass:"",color:l("#taskManager").data("bgcolor"),bgColor:getBackgroundColor(l("#taskManager").data("bgcolor")),borderColor:l("#taskManager").data("bgcolor"),raw:{contents:l("#taskContents").val(),status:"RESERVED"}}])):NMNS.calendar.updateSchedule(n.id,n.calendarId,{title:l("#taskName").val(),start:a,end:t,isAllDay:!1,raw:{contents:l("#taskContents").val()}}),NMNS.socket.emit("update reserv",{id:n.id,manager:l("#taskManager").data("calendar-id"),name:l("#taskName").val(),start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),isAllDay:!1,contents:l("#taskContents").val()})}else e=NMNS.email+generateRandom(),NMNS.calendar.createSchedules([{id:e,calendarId:l("#taskManager").data("calendar-id"),title:l("#taskName").val(),start:a,end:t,isAllDay:!1,category:"task",dueDateClass:"",color:l("#taskManager").data("bgcolor"),bgColor:getBackgroundColor(l("#taskManager").data("bgcolor")),borderColor:l("#taskManager").data("bgcolor"),raw:{contents:l("#taskContents").val(),status:"RESERVED"}}]),NMNS.history.push({id:e,manager:l("#taskManager").data("calendar-id")}),NMNS.socket.emit("add reserv",{id:e,manager:l("#taskManager").data("calendar-id"),name:l("#taskName").val(),start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),isAllDay:!1,type:"T",contents:l("#taskContents").val(),status:"RESERVED"});l("#taskModal").modal("hide")}),l("#taskModal .information").tooltip({title:"일정에는 매장 운영에 필요한 사항 등을 자유롭게 등록할 수 있습니다.<br/>예)임대료 납기일 표기 등",placement:"top",trigger:"focus hover",delay:{hide:1e3},html:!0})}var t;if(a.start&&a.end)l("#taskModal").data("edit",!!a.id).data("task",a),document.getElementById("taskStartDate")._flatpickr.setDate(a.start.toDate()),document.getElementById("taskEndDate")._flatpickr.setDate(a.end.toDate()),l("#taskName").val(a.title||""),l("#taskContents").val(a.raw&&a.raw.contents||""),(t=a.calendarId?NMNS.calendar.getCalendars().find(function(e){return e.id===a.calendarId}):NMNS.calendar.getCalendars()[0])||(t={id:a.calendarId,bgColor:a.bgColor,name:"삭제된 담당자"});else{l("#taskModal").data("edit",!1).removeData("task");var n=moment(new Date);n.hour()>Number(NMNS.info.bizEndTime.substring(0,2))||n.hour()==Number(NMNS.info.bizEndTime.substring(0,2))&&n.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?n=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):n.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||n.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&n.minute()<Number(NMNS.info.bizBeginTime.substring(2))?n=moment(NMNS.info.bizBeginTime,"HHmm"):n.minute(10*Math.ceil(n.minute()/10)),document.getElementById("taskStartDate")._flatpickr.setDate(n.toDate()),document.getElementById("taskEndDate")._flatpickr.setDate(n.add(30,"m").toDate()),l("#taskName").val(""),l("#taskContents").val(""),t=NMNS.calendar.getCalendars()[0]}l("#taskManager").next().html(D()).off("touch click","button").on("touch click","button",function(){l("#taskManager").data("calendar-id",l(this).data("calendar-id")).data("bgcolor",l(this).data("bgcolor")).html(l(this).html())}),l("#taskManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+t.bgColor+"'></span><span class='tui-full-calendar-content'>"+t.name+"</span>").data("calendar-id",t.id).data("bgcolor",t.bgColor)}function Y(e){NMNS.calendar.createSchedules(e.map(function(e){if(e.raw)return"string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),e;var a=r(e.manager||e.calendarId)||{};return{id:e.id,calendarId:a.id||"A1",title:e.name||e.title,start:"string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,end:"string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,isAllDay:e.isAllDay,category:"T"===e.type?"task":e.isAllday?"allday":"time",dueDateClass:"T"===e.type?"dueDateClass":"",attendees:[],recurrenceRule:!1,isPending:e.isCanceled,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:getBackgroundColor(a.color||"#334150"),borderColor:a.borderColor||"#334150",color:a.color||"#334150",dragBgColor:a.bgColor||"#334150",raw:{contact:e.contact,contents:e.contents,etc:e.etc,status:e.status}}}),!0)}function E(e){var a=e.parentsUntil("#noShowScheduleList",".row");l("#noShowScheduleDropdown").data("id",a.data("id")).data("manager",a.data("manager")).data("status",a.data("status")).css("top",e[0].getBoundingClientRect().top-l("#noShowSchedule")[0].getBoundingClientRect().top+e.height()+3+"px").css("right",e[0].getBoundingClientRect().right-l("#noShowSchedule")[0].getBoundingClientRect().right<-20?"1rem":e[0].getBoundingClientRect().right-l("#noShowSchedule")[0].getBoundingClientRect().right+"px").show()}function I(e){var a=e.parentsUntil("#noShowSearchList",".row");if(""===a.find("input[name='noShowSearchAddContact']").val())return alert("전화번호를 입력해주세요!"),void a.find("input[name='noShowSearchAddContact']").focus();if(!moment(a.find("input[name='noShowSearchAddDate']").val(),"YYYY-MM-DD").isValid())return alert("노쇼 날짜를 알맞게 입력해주세요!"),void a.find("input[name='noShowSearchAddDate']").focus();var t={id:a.data("id"),contact:a.find("input[name='noShowSearchAddContact']").val(),date:moment(a.find("input[name='noShowSearchAddDate']").val(),"YYYY-MM-DD").format("YYYYMMDD"),noShowCase:a.find("select").val()};NMNS.socket.emit("add noshow",t),e.off("touch click").on("touch click",function(){alert("저장 요청중입니다..!")})}function x(e){var a=e.parentsUntil("#noShowSearchList",".row");NMNS.history.push({id:a.data("id"),contact:a.data("contact"),date:a.data("date"),noShowCase:a.data("noshowcase")}),NMNS.socket.emit("delete noshow",{id:a.data("id")}),a.remove()}function H(e){var a=l(e).parents(".addManagerItem"),t=a.find("input[type='text']");if(!t.val()||t.val().length<1)alert("담당자 이름을 입력해주세요.");else{var n=t.data("id"),o=a.find(".addManagerColor").data("color");a.removeClass("addManagerItem"),a.html("<label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'><span style='background-color:"+t.data("color")+"; border-color:"+t.data("color")+"' title='이 담당자의 예약 가리기/보이기' data-color='"+t.data("color")+"'></span><span class='menu-collapsed'>"+t.val()+"</span></label><button class='btn btn-sm btn-flat lnbManagerAction ml-auto text-white py-0 pr-0' type='button'><i class='fa fa-ellipsis-v'></i></button>");var i=NMNS.calendar.getCalendars();i.push({id:n,name:t.val(),checked:!0,bgColor:getBackgroundColor(o),borderColor:o,color:o}),NMNS.calendar.setCalendars(i),NMNS.socket.emit("add manager",{id:n,name:t.val(),color:o})}}function B(e){l(e).parents(".addManagerItem").remove()}l(".js-scroll-trigger").click(function(){l(".navbar-collapse").collapse("hide")}),NMNS.calendar=new tui.Calendar("#mainCalendar",{taskView:[],defaultView:550<l(window).width()?"week":"day",scheduleView:["time"],useCreationPopup:!0,useDetailPopup:!0,disableDblClick:!0,template:{allday:function(e){return t(e,e.isAllDay)},time:function(e){return t(e,e.isAllDay)},task:function(e){return t(e,e.isAllDay)},alldayTitle:function(){return"<span class='tui-full-calendar-left-content'>하루종일</span>"},taskTitle:function(){return"<span class='tui-full-calendar-left-content'>일정</span>"},timegridDisplayPrimayTime:function(e){return e.hour+":00"},popupIsAllDay:function(){return"하루종일"},startDatePlaceholder:function(){return"시작시간"},endDatePlaceholder:function(){return"종료시간"},popupDetailDate:function(e,a,t){var n=moment(a instanceof Date?a:a.toDate()),o=moment(t instanceof Date?t:t.toDate()),i=n.isSame(o,"day"),l=(i?"":"YYYY.MM.DD ")+"a h:mm";return e?n.format("YYYY.MM.DD")+(i?"":" - "+o.format("YYYY.MM.DD")):n.format("YYYY.MM.DD a h:mm")+" - "+o.format(l)},popupEdit:function(){return"수정"},popupDelete:function(){return"삭제"},weekDayname:function(a){var e="tui-full-calendar-dayname-date",t="tui-full-calendar-dayname-name"+(NMNS.calendar&&"week"===NMNS.calendar.getViewName()?" weekViewDayName":""),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===a.renderDate}):void 0;return n&&(t+=" tui-full-calendar-holiday",e+=" tui-full-calendar-holiday"),'<span class="'+e+'">'+a.date+'</span>&nbsp;&nbsp;<span class="'+t+'">'+a.dayName+(n?"["+n.title+"]":"")+"</span>"},monthGridHeader:function(a){var e=parseInt(a.date.split("-")[2],10),t=["tui-full-calendar-weekday-grid-date"],n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===a.date}):void 0;return n&&t.push("tui-full-calendar-holiday"),'<span class="'+t.join(" ")+'">'+e+(n?"<small class='d-none d-sm-inline'>["+n.title+"]</small>":"")+"</span>"},monthGridHeaderExceed:function(e){return'<span class="tui-full-calendar-weekday-grid-more-schedules" title="전체 예약">전체 예약 <i class="fa fa-chevron-right"></i></span>'},monthMoreTitleDate:function(e,a){var t=e.split(".").join("-"),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===t}):void 0;return'<span class="'+("tui-full-calendar-month-more-title-day"+("일"===a?" tui-full-calendar-holiday-sun":"")+(n?" tui-full-calendar-holiday":"")+("토"===a?" tui-full-calendar-holiday-sat":""))+'">'+parseInt(t.substring(8),10)+'</span> <span class="tui-full-calendar-month-more-title-day-label">'+a+(n?"<small class='d-none d-sm-inline'>["+n.title+"]</small>":"")+"</span>"}},month:{daynames:["일","월","화","수","목","금","토"],scheduleFilter:function(){return!0},grid:{header:{height:26}}},week:{daynames:["일","월","화","수","목","금","토"],hourStart:NMNS.info?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23},theme:{"week.currentTime.color":"#fd5b77","week.currentTimeLinePast.border":"1px solid #fd5b77","week.currentTimeLineBullet.backgroundColor":"transparent","week.currentTimeLineToday.border":"1px solid #fd5b77","week.currentTimeLineFuture.border":"1px solid #fd5b77","common.border":".07rem solid rgba(57, 53, 53, 0.35)","common.saturday.color":"#1736ff","common.dayname.color":"#393535","common.holiday.color":"#fd5b77","week.timegridOneHour.height":"68px","week.timegridHalfHour.height":"34px","week.vpanelSplitter.height":"5px","week.pastDay.color":"#393535","week.futureDay.color":"#393535","week.pastTime.color":"#393535","week.futureTime.color":"#393535","month.schedule.marginLeft":"0px","month.schedule.marginRight":"1px","month.schedule.height":"18px","month.dayname.height":"52px","month.dayname.borderLeft":"none","month.dayname.borderTop":"none","month.dayname.textAlign":"center","month.dayname.fontWeight":"normal","month.holidayExceptThisMonth.color":"rgba(253, 91, 119, 0.35)","month.saturdayExceptThisMonth.color":"rgba(23, 54, 255, 0.35)","month.dayExceptThisMonth.color":"rgba(57, 53, 53, 0.35)","month.day.fontSize":"13px","common.creationGuide.backgroundColor":"rgba(68, 138, 255, 0.05)","common.creationGuide.border":"1px solid #448aff","week.creationGuide.color":"#448aff","week.timegrid.paddingRight":"1px","week.dayGridSchedule.marginRight":"1px","week.dayname.borderTop":"none","week.dayname.borderBottom":"none","week.dayname.borderLeft":"none","week.dayname.textAlign":"center","week.dayname.height":"51px","week.dayGridSchedule.borderLeft":"2px solid","week.timegridLeft.borderRight":"none"}}),NMNS.calendar.on({beforeCreateSchedule:function(e){!function(e){e.id=NMNS.email+generateRandom(),NMNS.calendar.createSchedules([e]),NMNS.history.push(e);var a=l.extend({},e);a.start=moment(a.start.toDate()).format("YYYYMMDDHHmm"),a.end=moment(a.end.toDate()).format("YYYYMMDDHHmm"),NMNS.socket.emit("add reserv",a)}(e)},beforeUpdateSchedule:function(e){var a=e.history||l.extend(!0,{},e.schedule);NMNS.history.push(a),e.schedule.start=e.start||e.schedule.start,e.schedule.end=e.end||e.schedule.end,e.schedule.raw.status=e.schedule.status||e.schedule.raw.status,e.history&&e.history.selectedCal.id!==e.schedule.calendarId?(NMNS.calendar.deleteSchedule(e.schedule.id,e.history.selectedCal.id,!0),e.schedule.category=e.schedule.isAllDay?"allday":"time",e.schedule.dueDateClass="",NMNS.calendar.createSchedules([e.schedule]),e.history.newCalendarId=e.schedule.calendarId):NMNS.calendar.updateSchedule(e.schedule.id,e.history?e.history.selectedCal.id:e.schedule.calendarId,e.schedule),NMNS.socket.emit("update reserv",{id:e.schedule.id,start:moment(e.schedule.start.toDate?e.schedule.start.toDate():e.schedule.start).format("YYYYMMDDHHmm"),end:moment(e.schedule.end.toDate?e.schedule.end.toDate():e.schedule.end).format("YYYYMMDDHHmm"),manager:e.schedule.calendarId,name:e.schedule.title,contact:e.schedule.contact||e.schedule.raw.contact,contents:e.schedule.contents||e.schedule.raw.contents,etc:e.schedule.etc||e.schedule.raw.etc,status:e.schedule.status||e.schedule.raw.status,isAllDay:e.schedule.isAllDay})},beforeDeleteSchedule:function(e){NMNS.history.push(e.schedule),NMNS.calendar.deleteSchedule(e.schedule.id,e.schedule.calendarId),NMNS.socket.emit("update reserv",{id:e.schedule.id,status:"DELETED"})},afterRenderSchedule:function(e){NMNS.calendar.getViewName()}}),NMNS.socket=io(),NMNS.socket.emit("get info"),NMNS.socket.emit("get manager"),NMNS.socket.on("get reserv",socketResponse("예약 정보 받아오기",function(e){Y(e.data),NMNS.holiday=e.holiday,s()})),NMNS.socket.on("get info",socketResponse("매장 정보 받아오기",function(e){if(NMNS.info=e.data,NMNS.calendar&&NMNS.calendar.setOptions({week:{hourStart:NMNS.info.bizBeginTime?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info.bizEndTime?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23}}),NMNS.email=e.data.email||NMNS.email,NMNS.calendarHeight=4.26*(NMNS.calendar.getOptions().week.hourEnd-NMNS.calendar.getOptions().week.hourStart)+7.25,l("#mainCalendar").css("height",NMNS.calendarHeight+"rem"),"BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus&&moment(NMNS.info.signUpDate,"YYYYMMDD").add(30,"d").isSameOrAfter(moment(),"day")&&showNotification({title:"이메일을 인증해주세요!",body:"인증메일은 내 매장 정보 화면에서 다시 보내실 수 있습니다. 이메일을 인증해주세요!"}),NMNS.info.isFirstVisit){if(!document.getElementById("tutorialScript")){var a=document.createElement("script");a.src="/nmns/js/tutorial.min.js",a.id="tutorialScript",document.body.appendChild(a),a.onload=function(){l("#tutorialModal").modal()}}}else("true"===getCookie("showTips")||void 0===getCookie("showTips"))&&Math.random()<.5&&l("#tipsModal").modal("show");NMNS.info.newAnnouncement&&l(".announcementCount").html(NMNS.info.newAnnouncement)})),NMNS.socket.on("get manager",socketResponse("매니저 정보 받아오기",function(e){e.data.forEach(function(e){e.checked=!0,e.bgColor=getBackgroundColor(e.color),e.borderColor=e.color,e.color=e.color}),l("#lnbManagerList").html(S(e.data)),NMNS.calendar.setCalendars(e.data),NMNS.needInit&&(delete NMNS.needInit,h()),s()})),NMNS.initAlrimModal=function(){if(!NMNS.initedAlrimModal){NMNS.initedAlrimModal=!0,l("#alrimNotice").off("keyup keydown paste cut change").on("keyup keydown paste cut change",function(){l("#noticeByteCount").text(l(this).val().length),l(this).height(0).height(150<this.scrollHeight?150:this.scrollHeight<60?60:this.scrollHeight)}).on("blur",function(){l(this).val(removeNonCharacter(l(this).val()))}),l("#alrimUseYn").off("change").on("change",function(){l(this).prop("checked")?l("#alrimScreen").hide():l("#alrimScreen").show()}),l("#alrimModalRefresh").off("touch click").on("touch click",M),l("#alrimModalSave").off("touch click").on("touch click",b),l("#alrimCallbackPhone").off("blur").on("blur",function(){filterNonNumericCharacter(l(this))}),l("#alrimHistorySearch").off("touch click").on("touch click",function(){var e={};if(""!==l("#alrimHistoryStartDate").val()){var a=moment(l("#alrimHistoryStartDate").val(),"YYYY-MM-DD");if(!a.isValid())return void alert("검색 시작일자가 올바르지 않습니다. 다시 입력해주세요!");e.start=a.format("YYYYMMDD")}if(""!==l("#alrimHistoryEndDate").val()){var t=moment(l("#alrimHistoryEndDate").val(),"YYYY-MM-DD");if(!t.isValid())return void alert("검색 끝일자가 올바르지 않습니다. 다시 입력해주세요!");e.end=t.format("YYYYMMDD")}""!==l("#alrimHistoryName").val()&&(e.name=l("#alrimHistoryName").val()),""!==l("#alrimHistoryContact").val()&&(e.contact=l("#alrimHistoryContact").val()),l("#alrimHistoryList .row").remove(),NMNS.socket.emit("get alrim history",e)}),l("#alrimHistoryContact").off("keyup").on("keyup",function(e){13===e.which&&(filterNonNumericCharacter(l(this)),l("#alrimHistorySearch").trigger("click"))}).on("blur",function(){filterNonNumericCharacter(l(this))}),l("#alrimHistoryName").off("keyup").on("keyup",function(e){13===e.which&&l("#alrimHistorySearch").trigger("click")});var e={format:"Y-m-d",defaultDate:new Date,appendTo:document.getElementById("alrimModal"),locale:"ko",closeOnSelect:!0};flatpickr("#alrimHistoryStartDate",e).setDate(moment().subtract(1,"M").toDate()),flatpickr("#alrimHistoryEndDate",e).setDate(moment().toDate()),l("#alrimHistoryName").autocomplete({serviceUrl:"get customer info",paramName:"name",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return e.value+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){l("#alrimHistoryContact").val(e.data)}},NMNS.socket),l("#alrimHistoryContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){l("#alrimHistoryName").val(e.data)}},NMNS.socket)}M()},NMNS.initInfoModal=function(){if(!NMNS.initedInfoModal){NMNS.initedInfoModal=!0;var t="";NMNS.colorTemplate.forEach(function(e,a){a<21&&(t+='<i class="fas fa-circle infoModalColor" data-color="'+e+'" style="color:'+e+'" aria-label="'+e+'"></i>')}),l("#infoModalColors").html(t),flatpickr("#infoBizBeginTime",{dateFormat:"H:i",time_24hr:!0,defaultHour:Number((NMNS.info.bizBeginTime||"0900").substring(0,2)),defaultMinute:Number((NMNS.info.bizBeginTime||"0900").substring(2,4)),minuteIncrement:10,noCalendar:!0,enableTime:!0,appendTo:document.getElementById("infoModal"),applyBtn:!0}).setDate(moment(NMNS.info.bizBeginTime?NMNS.info.bizBeginTime:"0900","HHmm").toDate()),flatpickr("#infoBizEndTime",{dateFormat:"H:i",time_24hr:!0,defaultHour:Number((NMNS.info.bizEndTime||"2300").substring(0,2)),defaultMinute:Number((NMNS.info.bizEndTime||"2300").substring(2,4)),minuteIncrement:10,noCalendar:!0,enableTime:!0,appendTo:document.getElementById("infoModal"),applyBtn:!0}).setDate(moment(NMNS.info.bizEndTime?NMNS.info.bizEndTime:"2300","HHmm").toDate()),l("#infoManagerList").hasClass("ps")||l("#infoManagerList").data("scroll",new PerfectScrollbar("#infoManagerList")),l("#infoModalSave").off("touch click").on("touch click",k),l("#infoModalRefresh").off("touch click").on("touch click",w),l("#infoModalColorPickerClose").off("touch click").on("touch click",function(){l("#infoModalColorPicker").hide(300)}),l(".infoModalColor").off("touch click").on("touch click",function(){var e=l(".infoManagerItem input[data-id='"+l("#infoModalColorPicker").data("target")+"']"),a=l(this).attr("data-color");e.length&&(e.data("color",a),e.prev().css("background-color",a).css("border-color",a).data("color",a))})}w()},NMNS.initTaskModal=T;var A,R,L,z,P,O,V=function(e){var a=e.parentsUntil("#noShowScheduleList",".row");NMNS.history.push({id:a.data("id"),calendarId:a.data("manager"),raw:{status:a.data("status")}}),NMNS.calendar.updateSchedule(a.data("id"),a.data("manager"),{raw:{status:"RESERVED"}}),NMNS.socket.emit("update reserv",{id:a.data("id"),status:"RESERVED"}),a.children("span:last-child").html(l(p("RESERVED"))).on("touch click",function(){E(l(this))})};l("#nextTips").one("touch click",function(){NMNS.socket.emit("get tips"),l("#waitTips").parent().addClass("wait"),NMNS.tips=[{title:l("#tipsTitle").html(),body:l("#tipsBody").html()}],l(this).on("touch click",function(){if(!l(this).hasClass("disabled")&&!l("#waitTips").is(":visible")){var e=l("#tipsModal").data("index")+1;NMNS.tips&&e<NMNS.tips.length&&(l("#tipsModal").data("index",e),e===NMNS.tips.length-1&&l("#nextTips").addClass("disabled"),l("#tipsTitle").html(NMNS.tips[e].title),l("#tipsBody").html(NMNS.tips[e].body),l("#prevTips").removeClass("disabled"))}}),l("#prevTips").on("touch click",function(){if(!l(this).hasClass("disabled")){var e=l("#tipsModal").data("index")-1;l("#waitTips").is(":visible")||0<=e&&NMNS.tips&&(l("#tipsModal").data("index",e),0===e&&l("#prevTips").addClass("disabled"),l("#tipsTitle").html(NMNS.tips[e].title),l("#tipsBody").html(NMNS.tips[e].body),l("#nextTips").removeClass("disabled"))}})}),l("#submitFeedback").off("touch click").on("touch click",function(e){var a=l("#feedbackBody").val();a&&0<a.trim().length?(NMNS.socket.emit("submit feedback",{data:a.trim()}),l("#feedbackModal").modal("hide"),showSnackBar("제안/문의해주신 내용이 잘 전달되었습니다.<br/> 소중한 의견에 감사드립니다."),l("#feedbackBody").val("")):alert("제안/문의하실 내용을 입력해주세요!")}),u(),m(),l(".moveDate").on("touch click",o),l(".calendarType").on("touch click",n),l("#calendarTypeMenu").next().children("a").on("touch click",function(e){e.preventDefault();var a=l(e.target);a.hasClass("dropdown-item")||(a=a.parents(".dropdown-item")),l("#calendarTypeMenu").html(a.html()),l("#calendarTypeMenu").attr("data-action",a.data("action")),l("#calendarTypeMenu").trigger("click")}),l("#managerElements").on("change",d),l("#dropdownMenu-calendars-list").on("touch click",i),l(".addReservLink").on("touch click",c),l(".addTaskLink").on("touch click",T),l("#infoLink").on("touch click",NMNS.initInfoModal),l("#alrimLink").on("touch click",NMNS.initAlrimModal),l(".addNoShowLink, .getNoShowLink").on("touch click",C),window.addEventListener("resize",debounce(function(){NMNS.calendar.render()},200)),flatpickr.localize("ko"),NMNS.socket.on("get tips",socketResponse("팁 정보 가져오기",function(e){e.data&&0<e.data.length?(NMNS.tips=NMNS.tips.concat(e.data),l("#tipsModal").data("index",1),l("#tipsModal #tipsTitle").html(NMNS.tips[1].title),l("#tipsModal #tipsBody").html(NMNS.tips[1].body),l("#prevTips").removeClass("disabled"),2===NMNS.tips.length&&l("#nextTips").addClass("disabled")):l("#nextTips").add("disabled"),l("#waitTips").parent().removeClass("wait")})).on("get summary",socketResponse("예약정보 가져오기",function(e){var a="";0===e.data.length?a="<div class='row col-12 px-0 mt-1 empty'><span class='col-12 text-center'>검색된 내용이 없습니다. 검색조건을 바꿔서 검색해보세요 :)</span></div>":e.data.forEach(function(e){a+="<div class='row col-12 px-0 mt-1' data-id='"+(e.id||"")+"' data-manager='"+(e.manager||"")+"' data-status='"+(e.status||"")+"'"+(e.contents?" title='"+e.contents+"'":"")+"><span class='col-3 col-lg-2 pr-0'>"+(e.start?moment(e.start,"YYYYMMDDHHmm").format("YYYY-MM-DD"):"")+"</span><span class='col-4 col-lg-3'>"+(e.name||"")+"</span><span class='col-3 col-lg-2 px-0'>"+dashContact(e.contact)+"</span><span class='col-3 d-none d-lg-inline-flex'>"+(e.contents||"")+"</span><span class='col-2 px-0'>"+p(e.status)+"</span></div>"}),l("#noShowScheduleList").html(a),l("#noShowScheduleList .badge, #noShowScheduleList .noShowScheduleNoShow").each(function(){l(this).off("touch click").on("touch click",function(e){e.stopPropagation(),E(l(this))})}),l("#noShowScheduleList .noShowScheduleNormal").off("touch click").on("touch click",function(e){e.stopPropagation(),V(l(this))}),l("#noShowScheduleList").hasClass("ps")&&l("#noShowScheduleList").data("scroll").update()})),NMNS.socket.on("add reserv",socketResponse("예약/일정 추가하기",function(e){NMNS.history.remove(e.data.id,function(e,a){return e.id===a})},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),delete e.id,NMNS.calendar.deleteSchedule(a.data.id,e.manager)})),NMNS.socket.on("update reserv",socketResponse("예약/일정 정보 변경하기",function(e){NMNS.history.remove(e.data.id,function(e,a){return e.id===a})},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),"DELETED"===(e.status||e.raw.status)?(Y([e]),s()):e.newCalendarId&&!NMNS.calendar.getSchedule(a.data.id,e.selectedCal?e.selectedCal.id:e.calendarId)?(NMNS.calendar.deleteSchedule(a.data.id,e.newCalendarId,!0),e.category="task"===e.category?"task":e.isAllDay?"allday":"time",e.dueDateClass="",e.calendarId=e.selectedCal?e.selectedCal.id:e.calendarId,e.start="string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,e.end="string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,e.color=e.color||e.selectedCal.color,e.bgColor=e.bgColor||e.selectedCal.bgColor,e.borderColor=e.borderColor||e.selectedCal.borderColor,NMNS.calendar.createSchedules([e])):("string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),NMNS.calendar.updateSchedule(a.data.id,e.selectedCal?e.selectedCal.id:e.calendarId,e)),l("#noShowScheduleList").is(":visible")&&l("#noShowScheduleList .row[data-id='"+a.data.id+"']").length){var t=l("#noShowScheduleList .row[data-id='"+a.data.id+"']");t.children("span:last-child").html(l(p(e.status||e.raw.status))),t.find(".badge, .noShowScheduleNoShow").each(function(){l(this).on("touch click",function(e){e.stopPropagation(),E(l(this))})}),t.find(".noShowScheduleNormal").on("touch click",function(e){e.stopPropagation(),V(l(this))})}})),NMNS.socket.on("add manager",socketResponse("담당자 추가하기",void 0,function(a){NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().filter(function(e){return e.id!==a.data.id})),l(".lnbManagerItem[data-value='"+a.data.id+"']").remove()})),NMNS.socket.on("delete manager",socketResponse("담당자 삭제하기",function(e){NMNS.history.remove(e.data.id,findById)},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(e){var t=NMNS.calendar.getCalendars();t.push(e),NMNS.calendar.setCalendars(NMNS.calendar.getCalendars()),l("#lnbManagerList").html(S(t)),s(),NMNS.history.remove(a.data.id,findById)}})),NMNS.socket.on("update manager",socketResponse("담당자 변경하기",function(e){NMNS.history.remove(e.data.id,findById)},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});e&&(NMNS.calendar.setCalendar(a.data.id,e),l("#lnbManagerList").html(S(NMNS.calendar.getCalendars())),s(),NMNS.history.remove(a.data.id,findById))})),NMNS.socket.on("update info",socketResponse("매장 정보 변경하기",function(){showSnackBar("<span>정상적으로 매장 정보를 변경하였습니다.</span>"),NMNS.history.remove("info",findById)},function(e){var a=NMNS.history.find(function(e){return"info"===e.id});(a.bizBeginTime||a.bizEndTime)&&NMNS.calendar.setOptions({week:{hourStart:a.bizBeginTime?a.bizBeginTime.substring(0,2):NMNS.info.bizBeginTime.substring(0,2),hourEnd:a.bizEndTime?a.bizEndTime.substring(0,2):NMNS.info.bizEndTime.substring(0,2)}}),a.shopName&&g(a.shopName),NMNS.info.shopName=a.shopName||NMNS.info.shopName,NMNS.info.bizType=a.bizType,NMNS.history.remove("info",findById),NMNS.initedInfoModal=!1})),NMNS.socket.on("update alrim",socketResponse("알림톡 정보 변경하기",function(){showSnackBar("<span>정상적으로 알림톡 정보를 변경하였습니다.</span>"),NMNS.history.remove("alrimInfo",findById)},function(){var a=NMNS.history.find(function(e){return"alrimInfo"===e.id});Object.keys(a).forEach(function(e){NMNS.info.alrimTalkInfo[e]=a[e]}),NMNS.history.remove("alrimInfo",findById),NMNS.initedAlrimModal=!1})),NMNS.socket.on("get noshow",socketResponse("노쇼 정보 가져오기",function(a){var t="";0<a.data.summary.noShowCount?(l("#noShowSearchSummary").html(dashContact(a.data.summary.contact)+" 고객은 "+(0<a.data.detail.length?a.data.detail.length==a.data.summary.noShowCount?"우리매장에서만 ":"다른 매장 포함 ":"다른 매장에서만 ")+(1<a.data.summary.noShowCount?"총 ":"")+a.data.summary.noShowCount+"번 노쇼하셨어요. <br class='d-inline-block d-lg-none'/> 가장 마지막은 "+(moment().year()+""===a.data.summary.lastNoShowDate.substring(0,4)?"올해 ":moment().year()-1+""===a.data.summary.lastNoShowDate.substring(0,4)?"작년 ":a.data.summary.lastNoShowDate.substring(0,4)+"년 ")+parseInt(a.data.summary.lastNoShowDate.substring(4,6),10)+"월 "+parseInt(a.data.summary.lastNoShowDate.substring(6),10)+"일이었어요.").show(),0<a.data.detail.length?a.data.detail.forEach(function(e){t+="<div class='row col-12 px-0 mt-1' data-id='"+e.id+"' data-contact='"+(a.data.summary.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"+(e.noShowCase||"")+"'><span class='col-4 pr-0'>"+(a.data.summary.contact?dashContact(a.data.summary.contact):"")+"</span><span class='col-4'>"+(e.date?e.date.substring(0,4)+"-"+e.date.substring(4,6)+"-"+e.date.substring(6):"")+"</span><span class='col-3'>"+(e.noShowCase?"<span class='badge badge-danger'>"+e.noShowCase+"</span>":"")+"</span><span class='col-1 px-0'><i class='fas fa-trash noShowSearchDelete' title='삭제'></i></span></div>"}):t="<div class='row col-12 px-0 mt-1 empty'><span class='col-12 text-center'>우리 매장에서 추가한 노쇼는 아직 없네요!<br/>이분이 노쇼를 하셨다면 아래 추가 버튼을 눌러 다른 매장에도 공유해주세요.</span></div>"):(l("#noShowSearchSummary").html("전화번호 "+dashContact(a.data.summary.contact)+" 고객에 대해 등록된 노쇼 전적이 없습니다.").show(),t="<div class='row col-12 px-0 mt-1 empty'><span class='col-12 text-center'>이분은 노쇼를 한 적이 없으시네요! 안심하세요 :)</span></div>");var e=l("#noShowSearchList");e.addClass("summary").html(t),e.find(".noShowSearchDelete").off("touch click").on("touch click",function(){x(l(this))}),e.hasClass("ps")&&e.data("scroll").update()})),NMNS.socket.on("add noshow",socketResponse("노쇼 추가하기",function(e){var a,t="";if(l("#noShowSearch").is(":visible")){t=e.data.noShowCase?"<span class='badge badge-light'>"+e.data.noShowCase+"</span>":"",(a=l("<div class='row col-12 px-0 mt-1' data-id='"+e.data.id+"' data-contact='"+e.data.contact+"' data-date='"+e.data.date+"' data-noshowcase='"+e.data.noShowCase+"'><span class='col-4'>"+(e.data.contact||l("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"'] input[name='noShowSearchAddContact']").val())+"</span><span class='col-4'>"+(e.data.date?e.data.date.substring(0,4)+"-"+e.data.date.substring(4,6)+"-"+e.data.date.substring(6):"")+"</span><span class='col-3'>"+t+"</span><span class='col-1 px-0'><i class='fas fa-trash noShowSearchDelete' title='삭제'></i></span></div>")).insertBefore(l("#noShowSearchList").children(".noShowSearchAdd:eq(0)")),a.find(".noShowSearchDelete").on("touch click",function(){x(l(this))});var n=l("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"']");n.data("datetimepicker").destroy(),n.remove()}showSnackBar("<span>추가되었습니다! 다른 분들에게 많은 도움이 될거에요 :)</span>")},function(e){l("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"'] .noShowSearchAddSubmit").off("touch click").on("touch click",function(){I(l(this))})})),NMNS.socket.on("delete noshow",socketResponse("노쇼 삭제하기",function(e){NMNS.history.remove(e.data.id,findById)},function(a){if(a&&a.data){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(e){var t=l("<div class='row col-12 px-0 mt-1' data-id='"+e.id+"' data-contact='"+(e.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"(e.noShowCase||"")+"'><span class='col-4'>"+(e.contact?dashContact(e.contact):"")+"</span><span class='col-4'>"+(e.date?e.date.substring(0,4)+"-"+e.date.substring(4,6)+"-"+e.date.substring(6):"")+"</span><span class='col-3'>"+(e.noShowCase?"<span class='badge badge-light'>"+e.noShowCase+"</span>":"")+"</span><span class='col-1 px-0'><i class='fas fa-trash noShowSearchDelete' title='삭제'></i></span></div>");t.find(".noShowSearchDelete").off("touch click").on("touch click",function(){x(l(this))}),l("#noShowSearchList .empty").length?l("#noShowSearchList").html(t):l("#noShowSearchList .noShowSearchAdd").length?t.insertBefore("#noShowSearchList .noShowSearchAdd:first-child"):l("#noShowSearchList").append(t)}}})),NMNS.socket.on("update password",socketResponse("비밀번호 변경하기")),NMNS.socket.on("get customer info",socketResponse("자동완성 자료 가져오기",function(e){if(e.data.id){var a=l("#"+e.data.id);a.autocomplete().onSuccess.call(a.autocomplete(),e.data.query,e.data.result)}},function(e){if(e.data.id){var a=l("#"+e.data.id);a.autocomplete().onFail.call(a.autocomplete(),e.data)}},!0)),NMNS.socket.on("get customer",socketResponse("고객 정보 가져오기",function(e){var a=l("#creationPopup");if(e.data.contact===a.find("#creationPopupContact").val()&&a.data("contact")!==e.data.contact||e.data.name===a.find("#creationPopupName").val()&&a.data("name")!==e.data.name){if(e.data.etc&&a.find("#creationPopupEtc").val(e.data.etc),e.data.manager){var t=r(e.data.manager);t&&a.find("#creationPopupManager").html(a.find("#creationPopupManager").next().find("button[data-calendar-id='"+t.id+"']").html()).data("calendarid",t.id)}e.data.contents&&a.find("#creationPopupContents").val(e.data.contents),void 0!==e.data.isAllDay&&a.find("#creationPopupAllDay").attr("checked",e.data.isAllDay),e.data.name&&""===a.find("#creationPopupName").val()&&a.find("#creationPopupName").val(e.data.name),e.data.contact&&""===a.find("#creationPopupContact").val()&&a.find("#creationPopupContact").val(e.data.contact),a.find("#creationPopupEtc").prop("readonly",!0),a.find(".creationPopupEtcNotice").show()}void 0!==e.data.totalNoShow&&0<e.data.totalNoShow&&a.find("#creationPopupContact").is(":visible")&&(a.find("#creationPopupContact").tooltip({title:"이 번호에는 총 "+e.data.totalNoShow+"건의 노쇼가 등록되어 있습니다."+(e.data.myNoShow&&0<e.data.myNoShow?"<br/>우리 매장에서는 "+e.data.myNoShow+"건 등록되었습니다.":""),placement:576<l(window).width()?"right":"top",trigger:"click hover focus",delay:{hide:1e3},html:!0}).tooltip("show"),setTimeout(function(){a.find("#creationPopupContact").tooltip("hide")},3e3),a.find("#creationPopupContact").one("keyup change",function(){l(this).tooltip("dispose")}))},void 0,!0)),NMNS.socket.on("message",socketResponse("서버 메시지 받기",function(e){"push"===e.type?e.data.forEach(function(e){showNotification(e)}):"alert"===e.type&&showSnackBar(e.data.body)},void 0,!0)),NMNS.socket.on("get alrim history",socketResponse("알림톡 내역 조회",function(e){!function(e){var t=l("#alrimHistoryList");if(t.hasClass("ps")||t.data("scroll",new PerfectScrollbar("#alrimHistoryList")),e&&0<e.length){var n="";e.forEach(function(e,a){n+='<div class="row alrimRow col" title="눌러서 전송된 알림톡 내용 보기"><a href="#alrimDetail'+a+'" class="alrimDetailLink" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="alrimDetail'+a+'"></a><div class="col-4 px-0 ellipsis">'+moment(e.date,"YYYYMMDDHHmm").format("YYYY-MM-DD HH:mm")+'</div><div class="col-4 ellipsis">'+e.name+'</div><div class="col-4 px-0 ellipsis">'+dashContact(e.contact)+'</div></div><div class="row alrimDetailRow collapse" id="alrimDetail'+a+'"><small class="col px-0">'+e.contents+"</small></div>",0<a&&a%50==0&&(t.append(n),n="")}),t.append(n)}else t.append("<div class='row alrimRow'><span class='col-12 text-center'>검색 조건에 맞는 결과가 없습니다.</span></div>");t.data("scroll").update()}(e.data)},void 0,!0)),NMNS.socket.on("resend alrimtalk",socketResponse("알림톡 다시 보내기",function(e){showSnackBar("<span>고객에게 알림톡을 다시 보냈습니다!</span>")},function(e){l("#detailPopupResendAlrim").addClass("d-none"),showSnackBar("<span>"+e.message||"알림톡을 다시 보내지 못했습니다.</span>")})),NMNS.socket.on("get announcement",socketResponse("공지사항 조회",function(e){var a,t;l("#announcementBody").append((a=e.data,t="",a.forEach(function(e){t+='<div class="announcement col-12 card px-0 border-0 rounded-0 shadow-sm mb-3"><div class="card-header"><h6 class="d-inline-block mb-0">'+e.title+(e.isRead?"":'<span class="badge badge-danger badge-pill ml-1">new</span>')+'</h6><small class="float-right">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDD").format("Y년 M월 D일"):"")+'</small></div><div class="card-body"><p class="card-text">'+e.contents+"</p></div></div>"}),t));var n=1*l(".announcementCount").text();if(n&&0<n){var o=0;e.data.forEach(function(e){e.isRead||o++}),o<n?l(".announcementCount").text(n-o):n===o&&l(".announcementCount").text("")}l("#announcementBody").parent().removeClass("wait"),5===e.data.length?NMNS.expectMoreAnnouncement=!0:NMNS.expectMoreAnnouncement=!1},function(e){l("#announcementBody").parent().removeClass("wait")})),l("#infoModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;var t=!1;return moment(l("#infoBizBeginTime").val(),"HH:mm").format("HHmm")!==NMNS.info.bizBeginTime&&(t=!0),t||moment(l("#infoBizEndTime").val(),"HH:mm").format("HHmm")===NMNS.info.bizEndTime||(t=!0),t||l("#infoShopName").val()===(NMNS.info.shopName||"")||(t=!0),t||""===l("#infoPassword").val()||(t=!0),t||l("#infoBizType").val()===(NMNS.info.bizType||"")||(t=!0),t||l(".infoManagerItem").each(function(){if(!t)if(l(this).hasClass("addManagerItem"))t=!0;else{var e=l(this).find("input[type='text']"),a=r(e.data("id"));l(this).data("delete")&&a?t=!0:a&&(e.data("color")===a.bgColor&&e.val()===a.name||(t=!0))}}),!(t&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))&&void 0}).on("touch click",function(e){if(l("#infoModalColorPicker").is(":visible")){var a=l(e.target);a.parents("#infoModalColorPicker").length||a.hasClass("infoManagerColor")||a.hasClass("tui-full-calendar-checkbox-round")||a.parents(".infoManagerColor").length||a.parents(".tui-full-calendar-checkbox-round").length||a.hasClass("addManagerColor")||a.parents(".addManagerColor").length||a.parents(".addManagerColor").length||l("#infoModalColorPicker").hide(300)}}).on("shown.bs.modal",function(){l("#infoManagerList").data("scroll").update(),l("#infoManagerList")[0].scrollTop=0,l("body .popover").length&&l("body .popover").popover("update")}),l("#alrimModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;if(l("#alrimShopName").is(":visible")){var e=!1;if((l("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!l("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(e=!0),e||l("#alrimShopName").val()===(NMNS.info.shopName||"")||(e=!0),e||l("#alrimCallbackPhone").val()===(NMNS.info.alrimTalkInfo.callbackPhone||"")||(e=!0),e||l("#alrimCancelDue").val()===(NMNS.info.alrimTalkInfo.cancelDue||"")||(e=!0),e||l("#alrimNotice").val()===(NMNS.info.alrimTalkInfo.notice||"")||(e=!0),e&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))return!1}}).on("shown.bs.modal",function(){l("body .popover").length&&l("body .popover").popover("update")}),l("#noShowModal").on("touch click",function(e){if(l("#noShowScheduleDropdown").is(":visible")){var a=l(e.target);a.parents("#noShowScheduleDropdown").length||a.hasClass("badge")||a.parents(".noShowScheduleNoShow").length||l("#noShowScheduleDropdown").hide(300)}}).on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1}).on("show.bs.modal",function(e){l(e.relatedTarget).hasClass("getNoShowLink")?l("#noShowTabList .nav-link[href='#noShowSearch']").tab("show"):l(e.relatedTarget).hasClass("addNoShowLink")&&l("#noShowTabList .nav-link[href='#noShowAdd']").tab("show")}),l("#taskModal").on("hide.bs.modal",function(e){var a=l(this).data("task");a&&a.guide&&(a.guide.clearGuideElement(),a.guide=null)}),l("#mainRow").on("touch click",function(){l("#navbarResponsive").hasClass("show")&&l("#navbarResponsive").collapse("hide")}),l("#noMoreTips").on("touch click",function(){document.cookie="showTips=false"}),l("#showTips").on("touch click",function(e){e.preventDefault(),l("#noMoreTips").remove(),l("#tipsModal").modal("show")}),l("#lnbLastMenu a").on("touch click",function(e){e.preventDefault()}),l("#alrimSwitchBtn").on("touch click",function(e){e.preventDefault(),l("#alrimForm").is(":visible")?(l("#alrimModalTitle").text("알림톡 사용내역"),l(this).text("알림톡 정보")):(l("#alrimModalTitle").text("알림톡 정보"),l(this).text("알림톡 사용내역")),l("#alrimModal .alrimData").toggle(),l(this).blur()}),l("#navbarResponsive").on("show.bs.collapse",function(){l("#mainNav").addClass("shadow")}).on("hidden.bs.collapse",function(){l("#mainNav").removeClass("shadow")}),l("#showTutorial").on("touch click",function(){if(document.getElementById("tutorialScript"))l("#tutorialModal").modal();else{var e=document.createElement("script");e.src="/nmns/js/tutorial.min.js",e.id="tutorialScript",document.body.appendChild(e),e.onload=function(){l("#tutorialModal").modal()}}}),l("#announcementModal").on("show.bs.modal",function(){0===l("#annoumcementBody").children().length&&(NMNS.announcementPage=1,l("#announcementBody").parent().addClass("wait"),NMNS.socket.emit("get announcement",{page:1}))}),A=document.getElementById("mainRow"),O=function(e){"left"===e?l("#renderRange").next().trigger("click"):"right"===e&&l("#renderRange").prev().trigger("click")}||function(e){},(P=A).addEventListener("touchstart",function(e){var a=e.changedTouches[0];R=a.pageX,z=(new Date).getTime()},!1),P.addEventListener("touchend",function(e){var a=e.changedTouches[0];L=a.pageX-R,(new Date).getTime()-z<=300&&100<=Math.abs(L)&&O(L<0?"left":"right")},!1),l(".addManager").on("touch click",function(){var e=NMNS.colorTemplate[Math.floor(Math.random()*NMNS.colorTemplate.length)],a=l(this).prev(),t="lnbManagerList"===a.attr("id")?"lnbManagerItem":"infoManagerItem",n=l("<div class='"+t+" addManagerItem row mx-0'><label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'/><span class='addManagerColor' style='background-color:"+e+"; border-color:"+e+";' data-color='"+e+"'></span><input type='text' name='name' class='align-middle form-control form-control-sm rounded-0' data-color='"+e+"' data-id='"+NMNS.email+generateRandom()+"' placeholder='담당자 이름'/></label>"+("lnbManagerItem"===t?"<i class='fas fa-check submitAddManager pl-1' title='추가'></i><i class='fas fa-times cancelAddManager pl-1' title='취소'></i>":"<i class='fas fa-trash cancelAddManager pl-2 title='삭제'></i>")+"</div>");a.append(n),"lnbManagerItem"===t?(n.find(".submitAddManager").off("touch click").on("touch click",function(){H(this)}),n.find("input[type='text']").off("keyup").on("keyup",function(e){27===e.which?(B(this),a.find("div:last-child input[type='text']").focus()):13===e.which&&H(this)}),n.find(".cancelAddManager").off("touch click").on("touch click",function(){B(this),a.find("div:last-child input[type='text']").focus()}),n.find(".addManagerColor").attr("title","담당자 색상은 저장 후 내 매장 정보 메뉴에서 바꾸실 수 있습니다.")):(n.find("input[type='text']").off("keyup").on("keyup",function(e){if(27===e.which){if(1==a.children(".infoManagerItem:visible").length)return;B(this),a.find("div:last-child input[type='text']").focus(),a.data("scroll").update()}}),n.find(".addManagerColor").off("touch click").on("touch click",function(){v(l(this))}),n.find(".cancelAddManager").off("touch click").on("touch click",function(){1!=a.children(".infoManagerItem:visible").length?(B(this),a.find("div:last-child input[type='text']").focus(),a.data("scroll").update()):alert("담당자는 반드시 1명 이상 있어야합니다!")})),a.find("div:last-child input[type='text']").focus()}),l("#copyEmail").on("touch click",function(e){e.preventDefault();var a=document.createRange();a.selectNodeContents(l(this)[0]);var t=window.getSelection?window.getSelection():document.selection;t.removeAllRanges(),t.addRange(a);var n="";return n=document.execCommand("copy")?"메일주소가 복사되었습니다.":"메일주소를 복사하지 못했습니다. 직접 선택하여 복사해주세요.",l(this).attr("title",n).tooltip({trigger:"manual",delay:{hide:1e3}}),l(this).tooltip("show"),setTimeout(function(){l("#copyEmail").attr("title","메일주소 복사").tooltip("dispose")},1500),t.empty?t.empty():t.removeAllRanges&&t.removeAllRanges(),!1}),l(".openAppLink").off("touch click").on("touch click",function(e){var a=navigator.userAgent.toLocaleLowerCase();-1<a.indexOf("android")||(-1<a.indexOf("ipod")||-1<a.indexOf("iphone")||-1<a.indexOf("ipad"))&&window.open(l(this).data("ios"),"_system")}),l(".mfb-component__button--child").off("touch click").on("touch click",function(e){e.preventDefault(),document.getElementById("floatingButton").setAttribute("data-mfb-state","closed")}),l("#announcementBody").on("scroll",debounce(function(){var e=Math.max(0,l(this)[0].scrollHeight-l(this).scrollTop()-l(this).innerHeight());!l("#waitAnnouncement").is(":visible")&&NMNS.expectMoreAnnouncement&&e<Math.max(100,.2*l(this).innerHeight())&&(l("#waitAnnouncement").parent().addClass("wait"),NMNS.socket.emit("get announcement",{page:++NMNS.announcementPage}))},100)),NMNS.socket.emit("get noti"),NMNS.socket.on("get noti",socketResponse("서버 메시지 받기",function(e){e.data.data.forEach(function(e){showNotification(e)})})),l(".customerMenuLink").off("touch click").on("touch click",function(e){e.preventDefault();var a=l(l(".customerSortType.active")[0]).data("action");if(document.getElementById("customerScript"))NMNS.socket.emit("get customer list",{type:"all",target:""===l("#customerSearchTarget").val()?void 0:l("#customerSearchTarget").val(),sort:a}),l(".calendarMenu").addClass("d-none"),l(".customerMenu").css("display","block");else{var t=document.createElement("script");t.src="/nmns/js/customer.min.js",t.id="customerScript",document.body.appendChild(t),t.onload=function(){NMNS.socket.emit("get customer list",{type:"all",target:""===l("#customerSearchTarget").val()?void 0:l("#customerSearchTarget").val(),sort:a}),l(".calendarMenu").addClass("d-none"),l(".customerMenu").css("display","block")}}l("#customerAddManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(D()).off("touch click","button").on("touch click","button",function(){l("#customerAddManager").data("calendar-id",l(this).data("calendar-id")).data("bgcolor",l(this).data("bgcolor")).html(l(this).html())}),l("#customerAddManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+NMNS.calendar.getCalendars()[0].bgColor+"'></span><span class='tui-full-calendar-content'>"+NMNS.calendar.getCalendars()[0].name+"</span>").data("calendar-id",NMNS.calendar.getCalendars()[0].id).data("bgcolor",NMNS.calendar.getCalendars()[0].bgColor),l("#customerManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(D()).off("touch click","button").on("touch click","button",function(){l("#customerManager").data("calendar-id",l(this).data("calendar-id")).data("bgcolor",l(this).data("bgcolor")).html(l(this).html())})}),l(".calendarMenuLink").off("touch click").on("touch click",function(e){e.preventDefault(),l(".customerMenu").css("display","none"),l(".calendarMenu").removeClass("d-none"),h()})}(jQuery);