!function(u){if(document.documentMode){var e,a=navigator.userAgent.toLowerCase();if("Microsoft Internet Explorer"==navigator.appName?e="msie ":-1<a.search("trident")?e="trident/.*rv:":-1<a.search("edge/")&&(e="edge/"),null!==new RegExp(e+"([0-9]{1,})(\\.{0,}[0-9]{0,1})").exec(a)&&parseFloat(RegExp.$1+RegExp.$2)<10&&!confirm("오래된 IE"+parseFloat(RegExp.$1+RegExp.$2)+" 브라우저를 사용하고 계십니다.\n 계속하시면 페이지가 정확히 표시되지 않을 수 있습니다. 그래도 계속하시겠습니까?\n *WA:SHOW는 IE10 이상의 브라우저를 지원하고,\nChrome 브라우저에 최적화되어있습니다."))return location.href="/signout"}function t(a,e){var t="task"===a.category?"일정":"예약",n="";if("week"===NMNS.calendar.getViewName())n+="<div class='tui-full-calendar-schedule-cover font-weight-bold row mx-auto align-items-center text-center'><div class='col-11 px-0'>",!e&&60<moment(a.end.toDate()).diff(a.start.toDate(),"minutes")&&(n+="<div class='row mx-0' style='margin-bottom:10px'><div class='montserrat col px-0' style='font-weight:500'>"+(moment(a.start.toDate()).isSame(moment(a.end.toDate()),"days")?moment(a.start.toDate()).format("HH:mm")+" - "+moment(a.end.toDate()).format("HH:mm"):moment(a.start.toDate()).format("MM.DD HH:mm")+" - "+moment(a.end.toDate()).format("MM.DD HH:mm"))+"</div></div>"),a.title&&(n+="<div class='row mx-0'><div class='col px-0' title='"+t+"이름:"+a.title+"'>"+a.title+"</div></div>"),n+="</div></div>";else if("day"===NMNS.calendar.getViewName()){var o=null;if(a.raw.contents)try{o=JSON.parse(a.raw.contents).map(function(e){return e.value}).join(", ")}catch(e){o=a.raw.contents}n+="<div class='tui-full-calendar-schedule-cover'><div><div class='row align-items-center' style='margin-bottom:5px'><div class='row mx-0 col'>",n+="<div title='"+t+"내용:"+(o||"")+"' class='tui-full-calendar-time-schedule-title'>"+(o||"(예약내용 없음)")+"</div>",n+="<div class='montserrat ml-auto' style='font-weight:500'>"+(moment(a.start.toDate()).isSame(moment(a.end.toDate()),"days")?moment(a.start.toDate()).format("HH:mm")+" - "+moment(a.end.toDate()).format("HH:mm"):moment(a.start.toDate()).format("MM.DD HH:mm")+" - "+moment(a.end.toDate()).format("MM.DD HH:mm"))+"</div></div></div><div style='font-size:11px'>"+(a.raw.etc||"")+"</div><div class='mt-auto tui-full-calendar-time-schedule-contact'>"+(a.title?"<span title='이름:"+a.title+"' class='mr-1'>"+a.title+"</span>":"")+(a.raw.contact?"<span title='연락처:"+dashContact(a.raw.contact,".")+"'>"+dashContact(a.raw.contact,".")+"</span>":"")+"</div></div></div>"}else n+="예약 "+a.count+"건</div>";return n}function n(e){var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action"));var t="";switch(a){case"toggle-daily":t="day",u("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-weekly":t="week",u("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-monthly":t="month",u("#mainCalendar").css("height","598px")}NMNS.calendar.changeView(t,!0),o(),r(),m()}function o(){switch(u(".calendarType").removeClass("active"),NMNS.calendar.getViewName()){case"day":u("#calendarTypeMenu").html(u(".calendarType[data-action='toggle-daily']").addClass("active").html());break;case"week":u("#calendarTypeMenu").html(u(".calendarType[data-action='toggle-weekly']").addClass("active").html());break;default:u("#calendarTypeMenu").html(u(".calendarType[data-action='toggle-monthly']").addClass("active").html())}}function i(e){var a=e.target.getAttribute("data-action");switch(a||(a=e.target.parentElement.getAttribute("data-action")),a){case"prev":NMNS.calendar.prev();break;case"next":NMNS.calendar.next();break;default:return}r(),m()}function l(){u(window).width()<1600&&u(document.body).toggleClass("overflow-y-hidden"),u("#mainTask").toggleClass("show")}function s(a){return NMNS.calendar.getCalendars()?NMNS.calendar.getCalendars().find(function(e){return e.id===a}):null}function d(e){var a=s(u(e.target).parents(".lnbManagerItem").data("value"));a&&a.checked!==e.target.checked&&(a.checked=e.target.checked,c())}function c(){var e=Array.prototype.slice.call(document.querySelectorAll("#lnbManagerList input"));NMNS.calendar.getCalendars().forEach(function(e){NMNS.calendar.toggleSchedules(e.id,!e.checked,!1)}),NMNS.calendar.render(!0),e.forEach(function(e){var a=e.nextElementSibling;a.style.backgroundColor=e.checked?a.getAttribute("data-color"):"transparent",a.style.borderColor=e.checked?a.getAttribute("data-color"):"#7f8fa4"})}function r(){var e=document.getElementById("renderRange"),a=NMNS.calendar.getOptions(),t=NMNS.calendar.getViewName(),n="";if("day"===t){var o=moment(NMNS.calendar.getDate().getTime());n+=o.format("YYYY. MM. DD");var i=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===o.format("YYYY-MM-DD")}):void 0;n+="<span class='flex-column base-font ml-3 position-relative'"+(i?"":" style='opacity:0.5'")+">"+(i?"<div class='render-range-text-holiday'>"+i.title+"</div>":"")+"<span style='font-size:22px;vertical-align:bottom'>"+["일","월","화","수","목","금","토"][moment(NMNS.calendar.getDate().getTime()).day()]+"요일</span></span>",e.style.width="280px"}else"month"===t&&(!a.month.visibleWeeksCount||4<a.month.visibleWeeksCount)?(n+=moment(NMNS.calendar.getDate().getTime()).format("YYYY. MM"),e.style.width="120px"):(n+=moment(NMNS.calendar.getDateRangeStart().getTime()).format("YYYY. MM. DD"),n+=" - ",n+=moment(NMNS.calendar.getDateRangeEnd().getTime()).format(" MM. DD"),e.style.width="280px");e.innerHTML=n}function m(){var e,a;NMNS.calendar.clear(),e=NMNS.calendar.getDateRangeStart(),a=NMNS.calendar.getDateRangeEnd(),NMNS.socket.emit("get reserv",{start:toYYYYMMDD(e._date)+"0000",end:toYYYYMMDD(a._date)+"2359"})}function h(e){switch(e){case"BEFORE_EMAIL_VERIFICATION":return"<span class='badge badge-danger' title='인증메일 보내기' style='cursor:pointer;'>이메일 미인증</span><span class='btn btn-sm btn-flat btn-secondary ml-2'>인증메일 보내기</span>";case"EMAIL_VERIFICATED":return"<span class='badge badge-primary badge-pill'><span class='icon-email-ok mr-1'></span>인증완료</span>"}return""}function p(e){var a="";return e.forEach(function(e){a+="<div class='lnbManagerItem row mx-0' data-value='"+e.id+"'><label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'>",a+="<span title='이 담당자의 예약 가리기/보이기' data-color='"+e.color+"'"+(e.checked?" style='background-color:"+e.color+";border-color:"+e.color+"'":"")+"></span><span class='menu-collapsed'>"+e.name+"</span></label><div class='dropdown menu-collapsed ml-auto'><button class='btn btn-flat dropdown-toggle lnbManagerAction text-white py-0 pr-0' type='button' data-toggle='dropdown' aria-haspopup='true' aria-expanded='false' data-offset='9,10'><span class='contextual menu-collapsed'></span></button><div class='dropdown-menu dropdown-menu-right'><a class='dropdown-item updateManagerLink' href='#'>이름/컬러 변경</a><a class='dropdown-item removeManagerLink' href='#'>삭제</a></div></div></div>"}),a}function f(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),u("#lnbManagerForm").data("id")&&u("#lnbManagerList .lnbManagerItem[data-value='"+u("#lnbManagerForm").data("id")+"']").show(),B();var a=s(u(this).parents(".lnbManagerItem").hide().data("value"));u("#lnbManagerFormColor").data("value",a.color).css("borderColor",a.color).css("backgroundColor",a.color),u("#lnbManagerColor .lnbManagerColorTemplate").prop("checked",!1).filter("[value='"+a.color+"']").prop("checked",!0),u("#lnbManagerForm").data("id",a.id).show(),u("#lnbManagerFormName").val(a.name).focus()}function g(e){if(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),u("#lnbManagerList .lnbManagerItem").length<=1)alert("담당자는 최소 1명 이상이 있어야 합니다.");else{var a=s(u(this).parents(".lnbManagerItem").data("value"));a?(NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().remove(a.id,function(e,a){return e.id===a})),NMNS.history.push({id:a.id,bgColor:a.bgColor,borderColor:a.borderColor,color:a.color,name:a.name}),u("#lnbManagerList .lnbManagerItem[value='"+a.id+"']").remove(),NMNS.socket.emit("delete manager",{id:a.id}),u(this).parents(".lnbManagerItem").remove()):showSnackBar("삭제할 담당자를 찾을 수 없습니다. 페이지를 새로고침해주세요.")}}function N(e){u("#mainShopName").text(""!==e?e:NMNS.email),u("#mainShopCapital").text(""!==e?e.substring(0,1):NMNS.email.substring(0,1))}function S(e,a){e?(u("#mainShopCapital").addClass("d-none"),u("#mainShopIcon").removeClass("d-none").attr("src",a)):(u("#mainShopIcon").addClass("d-none"),u("#mainShopCapital").text(""!==a?a.substring(0,1):NMNS.email.substring(0,1)).removeClass("d-none"))}function M(){"Y"===NMNS.info.alrimTalkInfo.useYn?(u("#alrimUseYn").prop("checked",!0),u("#alrimScreen").hide()):(u("#alrimUseYn").prop("checked",!1),u("#alrimScreen").show()),u("#alrimCallbackPhone").val(NMNS.info.alrimTalkInfo.callbackPhone||""),u("#alrimShopName").val(NMNS.info.shopName||""),u("#alrimCancelDue").val(NMNS.info.alrimTalkInfo.cancelDue||""),u("#alrimNotice").val(NMNS.info.alrimTalkInfo.notice||""),u("#noticeByteCount").text(u("#alrimNotice").val().length)}function v(){if(700<u("#alrimNotice").val().length)return alert("알림 안내문구의 길이가 너무 깁니다. 조금만 줄여주세요 :)"),void u("#alrimNotice").focus();if(u("#alrimUseYn").prop("checked")){if(""===u("#alrimCallbackPhone").val().replace(/-/gi,""))return alert("알림톡을 사용하시려면 예약취소 알림톡을 받을 휴대폰번호를 입력해주세요!"),void u("#alrimCallbackPhone").focus();if(!/^01([016789]?)([0-9]{3,4})([0-9]{4})$/.test(u("#alrimCallbackPhone").val().replace(/-/gi,"")))return alert("입력하신 휴대폰번호가 정확하지 않습니다.\n휴대폰번호를 정확히 입력해주세요!"),void u("#alrimCallbackPhone").focus();if(""===u("#alrimShopName").val())return alert("알림톡을 사용하시려면 고객에게 보여줄 매장 이름을 입력해주세요!"),void u("#alrimShopName").focus()}var e={},a={id:"alrimInfo"},t=!1;u("#alrimShopName").val()!==(NMNS.info.shopName||"")&&(NMNS.history.push({id:"info",shopName:NMNS.info.shopName}),e={shopName:u("#alrimShopName").val()},NMNS.info.shopName=e.shopName,NMNS.socket.emit("update info",e),N(e.shopName),e={},t=!0),(u("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!u("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(a.useYn=NMNS.info.alrimTalkInfo.useYn,e.useYn=u("#alrimUseYn").prop("checked")?"Y":"N",NMNS.info.alrimTalkInfo.useYn=e.useYn),u("#alrimCallbackPhone").val().replace(/-/gi,"")!==(NMNS.info.alrimTalkInfo.callbackPhone||"")&&(a.callbackPhone=NMNS.info.alrimTalkInfo.callbackPhone,e.callbackPhone=u("#alrimCallbackPhone").val().replace(/-/gi,""),NMNS.info.alrimTalkInfo.callbackPhone=e.callbackPhone),u("#alrimCancelDue").val()!==(NMNS.info.alrimTalkInfo.cancelDue||"")&&(a.cancelDue=NMNS.info.alrimTalkInfo.cancelDue,e.cancelDue=u("#alrimCancelDue").val(),NMNS.info.alrimTalkInfo.cancelDue=e.cancelDue),u("#alrimNotice").val()!==(NMNS.info.alrimTalkInfo.notice||"")&&(a.notice=NMNS.info.alrimTalkInfo.notice,e.notice=u("#alrimNotice").val(),NMNS.info.alrimTalkInfo.notice=e.notice),Object.keys(e).length&&(NMNS.history.push(a),NMNS.socket.emit("update alrim",e)),Object.keys(e).length||t?u("#alrimModal").modal("hide"):showSnackBar("<span>변경된 내역이 없습니다.</span>")}function k(){var e=moment(u("#infoBizBeginTime").val(),"HHmm");if(!e.isValid())return alert("매장 운영 시작시간이 올바르지 않습니다."),void u("#infoBizBeginTime").focus();var a=moment(u("#infoBizEndTime").val(),"HHmm");if(!a.isValid())return alert("매장 운영 종료시간이 올바르지 않습니다."),void u("#infoBizEndTime").focus();if(e.isAfter(a))e=[a,a=e][0];else if(e.isSame(a))return void alert("매장 운영 시작시간과 종료시간이 같습니다.");if(""===u("#infoShopName").val()&&"Y"===NMNS.info.alrimTalkInfo.useYn)return alert("알림톡을 사용하고 계실 때는 예약고객에게 보여드릴 매장이름이 반드시 있어야 합니다.\n매장이름을 삭제하고 싶으시다면 알림톡 사용을 먼저 해제해주세요."),void u("#infoShopName").val(NMNS.info.shopName);var t={},n=!1,o=!1,i={id:"info"};if(e.format("HHmm")===NMNS.info.bizBeginTime&&a.format("HHmm")===NMNS.info.bizEndTime||(i.hourStart=NMNS.info.bizBeginTime||"0900",i.hourEnd=NMNS.info.bizEndTime||"2300",t.bizBeginTime=e.format("HHmm"),t.bizEndTime=a.format("HHmm"),NMNS.info.bizBeginTime=t.bizBeginTime||"0900",NMNS.info.bizEndTime=t.bizEndTime||"2300",NMNS.calendar.setOptions({week:{hourStart:t.bizBeginTime?parseInt(t.bizBeginTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourStart,hourEnd:t.bizEndTime?parseInt(t.bizEndTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourEnd}}),n=!0),u("#infoShopName").val()!==(NMNS.info.shopName||"")&&(i.shopName=NMNS.info.shopName,t.shopName=u("#infoShopName").val(),NMNS.info.shopName=t.shopName,N(t.shopName),n=!0),u("#infoBizType").val()!==(NMNS.info.bizType||"")&&(i.bizType=NMNS.info.bizType,t.bizType=u("#infoBizType").val(),NMNS.info.bizType=t.bizType,n=!0),document.getElementById("infoLogo").files[0]&&!u("#infoLogo").data("deleted")?o=!0:u("#infoLogo").data("deleted")&&NMNS.info.logo&&(i.logo=NMNS.info.logo,i.logoFileName=NMNS.info.logoFileName,t.logo=null,S(!1,NMNS.info.shopName),n=!0),o){var l=new FileReader;l.loadend=function(){},l.onload=function(e){NMNS.socket.emit("upload logo",{fileData:e.target.result,fileName:document.getElementById("infoLogo").files[0].name})},l.readAsArrayBuffer(document.getElementById("infoLogo").files[0])}n&&(NMNS.history.push(i),NMNS.socket.emit("update info",t)),n||o||showSnackBar("<span>변경된 내역이 없습니다.</span>")}function b(){u("#noShowScheduleList").hasClass("ps")?(u("#noShowAddContact").autocomplete().clearCache(),u("#noShowScheduleTarget").autocomplete().clearCache()):(u("#noShowScheduleList").data("scroll",new PerfectScrollbar("#noShowScheduleList",{suppressScrollX:!0})),u(".noShowAddCase").off("touch click").on("touch click",function(){u(this).siblings().removeClass("bg-primary"),u(this).toggleClass("bg-primary"),u(this).parent().is(u("#noShowAddContent"))&&0<u("#noShowAddContact").val().replace(/-/gi,"").trim().length&&(0<u(this).parent().children(".bg-primary").length||0<u(this).siblings("input").val().trim().length)?u(this).parent().next().children("span").css("opacity",1):u(this).parent().is(u("#noShowScheduleContent"))&&0<u("#noShowScheduleList input:checked").length&&(0<u(this).parent().children(".bg-primary").length||0<u(this).siblings("input").val().trim().length)?u(this).parent().next().children("span").css("opacity",1):u(this).parent().next().children("span").css("opacity",.35)}),u("#noShowAddCaseEtc,#noShowScheduleCaseEtc").on("keyup",function(e){u(this).siblings().removeClass("bg-primary"),u(this).parent().is(u("#noShowAddContent"))&&0<u("#noShowAddContact").val().replace(/-/gi,"").trim().length&&0<u(this).val().trim().length?u(this).parent().next().children("span").css("opacity",1):u(this).parent().is(u("#noShowScheduleContent"))&&0<u("#noShowScheduleList input:checked").length&&0<u(this).val().trim().length?u(this).parent().next().children("span").css("opacity",1):u(this).parent().next().children("span").css("opacity",.35),13===e.which&&u(this).parent().next().trigger("click")}),u("#noShowAddBtn").off("touch click").on("touch click",function(){""!==u("#noShowAddContact").val().replace(/-/gi,"")?0!==u("#noShowAddContent .noShowAddCase.bg-primary").length||0!==u("#noShowAddCaseEtc").val().trim().length?NMNS.socket.emit("add noshow",{id:NMNS.email+generateRandom(),contact:u("#noShowAddContact").val().replace(/-/gi,""),noShowCase:0===u("#noShowAddContent .bg-primary").length?u("#noShowAddCaseEtc").val().trim():u("#noShowAddContent .bg-primary").data("value")}):showSnackBar("<span>노쇼 사유를 선택해주세요.</span>"):showSnackBar("<span>저장할 전화번호를 입력해주세요!</span>")}),u("#noShowScheduleBtn").off("touch click").on("touch click",function(){if(0!==u("#noShowScheduleList input:checked").length)if(0!==u("#noShowScheduleContent .noShowAddCase.bg-primary").length||0!==u("#noShowScheduleCaseEtc").val().trim().length){var e=u("#noShowScheduleList input:checked").parent().parent();NMNS.history.push({id:e.data("id"),status:e.data("status"),manager:e.data("manager"),contents:e.data("contents")}),NMNS.calendar.updateSchedule(e.data("id"),e.data("manager"),{raw:{status:"NOSHOW"}}),NMNS.socket.emit("update reserv",{id:e.data("id"),status:"NOSHOW",noShowCase:0<u("#noShowScheduleContent .noShowAddCase.bg-primary").length?u("#noShowScheduleContent .noShowAddCase.bg-primary").data("value"):u("#noShowScheduleCaseEtc").val().trim()})}else showSnackBar("<span>노쇼 사유를 선택해주세요.</span>");else showSnackBar("<span>노쇼로 등록할 예약을 선택해주세요.</span>")}),u("#noShowScheduleSearch").off("touch click").on("touch click",function(){var e={};""!==u("#noShowScheduleTarget").val()&&(e.target=u("#noShowScheduleTarget").val()),u("#noShowScheduleList .row").remove(),NMNS.socket.emit("get summary",e)}),u("#noShowAddContact").on("keyup",function(e){13===e.which&&u("#noShowAddBtn").trigger("click")}),u("#noShowTabList a[href='#noShowSchedule']").on("show.bs.tab",function(){u("#noShowScheduleSearch").trigger("click")}).on("shown.bs.tab",function(){u("#noShowScheduleTarget").focus()}),u("#noShowAddContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+(e.data||"(이름없는 고객)")+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),u("#noShowScheduleTarget").on("keyup",function(e){13===e.which&&u("#noShowScheduleSearch").trigger("click")}).autocomplete({serviceUrl:"get customer info",paramName:"target",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,a){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return(e.value||"(이름없는 고객)")+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){u("#noShowScheduleContact").val(e.data)}},NMNS.socket))}function y(e){var a=e?"<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id=''>선택</button>":"";return NMNS.calendar.getCalendars().forEach(function(e){a+="<button type='button' class='dropdown-item tui-full-calendar-dropdown-item ellipsis' data-calendar-id='"+e.id+"' data-color='"+e.color+"'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot mr-3' style='background-color: "+e.color+"'></span><span class='tui-full-calendar-content'>"+e.name+"</span></button>"}),a}function w(a){var t="";if(null==a)a=[""];else if("string"==typeof a)try{a=JSON.parse(a)}catch(e){a=[a]}else Array.isArray(a)||(a=[a]);var n=u("#scheduleTabContents input").toArray();return a.filter(function(a){return!n.find(function(e){return e.value===(a&&a.value||a)&&!(""===a&&""===e.value)})}).forEach(function(a){var e=n.find(function(e){return(""===e.value||!e.value)&&""!==a});e?u(e).data("menu-id",a?a.menuId:null).val(a&&a.value||a):t+='<div class="row mx-0 col-12 px-0"><input class="form-control form-control-sm han col" name="scheduleContents" aria-label="예약 내용" placeholder="예약 내용을 직접 입력하거나 메뉴에서 선택하세요." autocomplete="off" list="scheduleTabContentList" value="'+(a&&a.value||a)+'" '+(a&&a.menuId?'data-menu-id="'+a.menuId+'"':"")+'><button type="button" class="btn btn-sm btn-form ml-2 deleteScheduleContents">삭제</button></div>'}),t}function D(e){1===u("#scheduleTabContents .row").length?u(e).prev().data("menu-id",null).val(""):u(e).parent().remove()}function C(e){var a="";return e.forEach(function(e){a+='<option value="'+e.name+'"></option>'}),a}function T(e){if(!u("#scheduleStartDate")[0]._flatpickr){var a,t={dateFormat:"Y. m. d",defaultDate:new Date,locale:"ko"};function n(){clearTimeout(a),(9<u("#scheduleContact").val().replace(/-/gi,"").length||""!==u("#scheduleName").val())&&NMNS.socket.emit("get customer",{name:u("#scheduleName").val(),contact:u("#scheduleContact").val().replace(/-/gi,"")})}flatpickr("#scheduleStartDate",t),flatpickr("#scheduleEndDate",t),u("#scheduleAddContents").on("touch click",function(){u("#scheduleTabContents").append(u(w("")).on("touch click","button",function(){D(this)}))}),u("#scheduleName").autocomplete({serviceUrl:"get customer info",paramName:"name",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e){return(e.value||"(이름없는 고객)")+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){u("#scheduleContact").val(e.data).trigger("blur")}},NMNS.socket).on("blur",function(){clearTimeout(a),a=setTimeout(function(){n()},300)}),u("#scheduleContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e){return(e.value||"(이름없는 고객)")+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){u("#scheduleName").val(e.data),n()}},NMNS.socket).on("blur",function(){clearTimeout(a),a=setTimeout(function(){n()},300)}),u("#scheduleBtn").on("touch click",function(){var e,a,t,n,o,i,l,s,d,c;try{if(a=u("#scheduleStartDate")[0]._flatpickr.selectedDates[0],t=u("#scheduleEndDate")[0]._flatpickr.selectedDates[0],!moment(a).isValid())return void showSnackBar("시작 일자를 확인해주세요.");if(!moment(t).isValid())return void showSnackBar("종료 일자를 확인해주세요.")}catch(e){if(!a||!t)return void showSnackBar("시간을 입력해주세요!")}if(n=u("#scheduleStartTime").val(),o=u("#scheduleEndTime").val(),n)if(o)if(a.setHours(1*n.substring(0,2)),a.setMinutes(1*n.substring(2)),t.setHours(1*o.substring(0,2)),t.setMinutes(1*o.substring(2)),d=u("#scheduleManager").data("calendar-id"),c=NMNS.calendar.getCalendars().find(function(e){return e.id===d})){if(a.getTime()>t.getTime()&&(a=[t,t=a][0]),e=u("#scheduleName").val(),i=JSON.stringify(u("#scheduleTabContents input").filter(function(){return""!==this.value}).map(function(){return{id:this.getAttribute("data-menu-id")||(NMNS.menuList&&NMNS.menuList.find(function(e){return e.name===this.value})?NMNS.menuList.find(function(e){return e.name===this.value}).id:NMNS.email+generateRandom()),value:this.value}}).toArray()),l=u("#scheduleContact").val().replace(/-/gi,""),s=u("#scheduleEtc").val(),"Y"!==NMNS.info.alrimTalkInfo.useYn||""===l||/^01([016789]?)([0-9]{3,4})([0-9]{4})$/.test(l)||confirm("입력하신 전화번호는 알림톡을 보낼 수 있는 전화번호가 아닙니다. 그래도 등록하시겠어요?")){if(NMNS.scheduleTarget&&NMNS.scheduleTarget.schedule){var r=NMNS.scheduleTarget.schedule;r.manager=r.calendarId,NMNS.history.push(r),r.calendarId!==d?(r.newCalendarId=d,NMNS.calendar.deleteSchedule(r.id,r.manager,!0),NMNS.calendar.createSchedules([{id:r.id,calendarId:d,title:e,start:a,end:t,isAllDay:!1,category:"time",attendees:[],recurrenceRule:!1,isPending:!1,dueDateClass:"",color:c.color,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:getBackgroundColor(c.color),borderColor:c.color,dragBgColor:c.bgColor||"#334150",raw:{contact:l,contents:i,etc:s,status:u("#scheduleStatus input:checked").val()}}])):NMNS.calendar.updateSchedule(r.id,r.calendarId,{title:e,start:a,end:t,raw:{contents:i,contact:l,status:u("#scheduleStatus input:checked").val()}}),NMNS.socket.emit("update reserv",{email:NMNS.email,id:r.id,manager:d,name:e,start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),contents:i,contact:l,isAllDay:!1,status:u("#scheduleStatus input:checked").val()})}else{var m=NMNS.email+generateRandom();NMNS.calendar.createSchedules([{id:m,calendarId:d,title:e,start:a,end:t,isAllDay:!1,category:"time",attendees:[],recurrenceRule:!1,isPending:!1,dueDateClass:"",color:c.color,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:getBackgroundColor(c.color),borderColor:c.color,dragBgColor:c.bgColor||"#334150",raw:{contact:l,contents:i,etc:s,status:"RESERVED"}}]),NMNS.history.push({id:m,manager:d}),NMNS.socket.emit("add reserv",{email:NMNS.email,id:m,manager:d,name:e,start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),isAllDay:!1,type:"R",bgColor:getBackgroundColor(c.color),borderColor:c.color,dragBgColor:c.bgColor||"#334150",color:c.color,contact:l,contents:i,etc:s,status:"RESERVED"})}u("#scheduleModal").modal("hide")}}else showSnackBar("담당자를 지정해주세요.");else showSnackBar("종료 시간을 확인해주세요.");else showSnackBar("시작 시간을 확인해주세요.")}),u("#deleteScheduleBtn").on("touch click",function(e){e.preventDefault(),NMNS.scheduleTarget&&NMNS.scheduleTarget.schedule&&confirm("이 예약을 삭제하시겠어요?")&&(NMNS.history.push(NMNS.scheduleTarget.schedule),NMNS.calendar.deleteSchedule(NMNS.scheduleTarget.schedule.id,NMNS.scheduleTarget.schedule.calendarId),NMNS.socket.emit("update reserv",{id:NMNS.scheduleTarget.schedule.id,status:"DELETED"}),u("#scheduleModal").modal("hide"))}),u("#resendAlrimScheduleBtn").on("touch click",function(e){e.preventDefault(),NMNS.scheduleTarget&&NMNS.scheduleTarget.schedule&&confirm("고객에게 알림톡을 다시 보낼까요?")&&NMNS.socket.emit("resend alrimtalk",{id:NMNS.scheduleTarget.schedule.id})})}!function(e){var a;if(NMNS.refreshScheduleManager&&(NMNS.refreshScheduleManager=!1,u("#scheduleManager").next().html(y()).off("touch click","button").on("touch click","button",function(){u("#scheduleManager").data("calendar-id",u(this).data("calendar-id")).data("color",u(this).data("color")).html(u(this).html())})),NMNS.refreshMenu&&(NMNS.refreshMenu=!1,NMNS.socket.emit("get menu list")),u("#scheduleBtn").text(e&&e.schedule?"예약 변경 완료":"예약 추가 완료"),u("#scheduleName").autocomplete()&&u("#scheduleName").autocomplete().clearCache(),u("#scheduleContact").autocomplete()&&u("#scheduleContact").autocomplete().clearCache(),u("#scheduleTab").data("contact",e&&e.schedule&&e.schedule.raw?e.schedule.raw.contact:null).data("name",e&&e.schedule?e.schedule.title:""),"object"==typeof e)e.schedule?(u("#scheduleStatus input[type='radio']").prop("checked",!1),u("#scheduleStatus input[value='"+e.schedule.raw.status+"']").length?u("#scheduleStatus input[value='"+e.schedule.raw.status+"']").prop("checked",!0):"CUSTOMERCANCELED"===e.schedule.raw.status?u("#scheduleStatus input[value='CANCELED']").prop("checked",!0):u("#scheduleStatus input[value='RESERVED']").prop("checked",!0),document.getElementById("scheduleStartDate")._flatpickr.setDate(e.schedule.start.toDate()),document.getElementById("scheduleEndDate")._flatpickr.setDate(e.schedule.end.toDate()),u("#scheduleStartTime").val(moment(e.schedule.start.toDate()).format("HHmm")),u("#scheduleEndTime").val(moment(e.schedule.end.toDate()).format("HHmm")),u("#scheduleName").val(e.schedule.title),u("#scheduleTabContents").append(w(e.schedule.raw?e.schedule.raw.contents:"")).find("button").off("touch click").on("touch click",function(){D(this)}),u("#scheduleContact").val(e.schedule.raw?e.schedule.raw.contact:e.schedule.contact),u("#scheduleEtc").val(e.schedule.raw?e.schedule.raw.etc:e.schedule.etc),moment(e.schedule.start.toDate()).isBefore(moment())?u("#resendAlrimScheduleBtn").addClass("d-none"):u("#resendAlrimScheduleBtn").removeClass("d-none"),a=s(e.schedule.calendarId)):e.customer?(document.getElementById("scheduleStartDate")._flatpickr.setDate(e.start),document.getElementById("scheduleEndDate")._flatpickr.setDate(e.end),u("#scheduleStartTime").val(moment(e.start).format("HHmm")),u("#scheduleEndTime").val(moment(e.end).format("HHmm")),u("#scheduleName").val(e.customer.name),u("#scheduleTabContents").append(w("")).find("button").off("touch click").on("touch click",function(){D(this)}),u("#scheduleContact").val(e.customer.contact),u("#scheduleEtc").val(e.customer.etc),u("#scheduleAllDay").attr("checked",!1),a=s(e.customer.managerId)||NMNS.calendar.getCalendars()[0]):(document.getElementById("scheduleStartDate")._flatpickr.setDate(e.start.toDate()),document.getElementById("scheduleEndDate")._flatpickr.setDate(e.end.toDate()),u("#scheduleStartTime").val(moment(e.start.toDate()).format("HHmm")),u("#scheduleEndTime").val(moment(e.end.toDate()).format("HHmm")),u("#scheduleName").val(""),u("#scheduleTabContents").html(w("")).find("button").off("touch click").on("touch click",function(){D(this)}),u("#scheduleContact").val(""),u("#scheduleEtc").val(""),a=NMNS.calendar.getCalendars()[0]),a?(a=u("#scheduleManagerList").find("button[data-calendar-id='"+a.id+"']"),u("#scheduleManager").html(a.html()).data("calendar-id",a.data("calendarId")).data("color",a.data("color"))):u("#scheduleManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+e.schedule.color+"'></span><span class='tui-full-calendar-content'>(삭제된 담당자)</span>").data("calendar-id",e.schedule.calendarId).data("color",e.schedule.color);else if("string"==typeof e)document.getElementById("scheduleStartDate")._flatpickr.setDate(document.getElementById("taskStartDate")._flatpickr.selectedDates[0]),u("#scheduleStartTime").val(u("#taskStartTime").val()),document.getElementById("scheduleEndDate")._flatpickr.setDate(document.getElementById("taskEndDate")._flatpickr.selectedDates[0]),u("#scheduleEndTime").val(u("#taskEndTime").val()),u("#scheduleAllDay").prop("checked",u("#taskAllDay").prop("checked")),a=u("#taskManager"),u("#scheduleManager").data("calendar-id",a.data("calendar-id")).data("color",a.data("color")).html(a.html());else{var t=moment().second(0).millisecond(0),n=moment().hour(1*NMNS.info.bizEndTime.substring(0,2)).minute(1*NMNS.info.bizEndTime.substring(2)).second(0).millisecond(0);n.diff(t,"minutes")<60?t=moment(NMNS.info.bizEndTime,"HHmm").subtract(1,"h"):(n.hour(1*NMNS.info.bizBeginTime.substring(0,2)).minute(1*NMNS.info.bizBeginTime.substring(2)),t.diff(n,"minutes")<60&&(t=moment(NMNS.info.bizBeginTime,"HHmm"))),t.minute(30*Math.ceil(t.minute()/30)),document.getElementById("scheduleStartDate")._flatpickr.setDate(t.toDate()),u("#scheduleStartTime").val(t.format("HHmm")),document.getElementById("scheduleEndDate")._flatpickr.setDate(t.add(1,"h").toDate()),u("#scheduleEndTime").val(t.format("HHmm")),u("#scheduleName").val(""),u("#scheduleTabContents").html(w("")).find("button").off("touch click").on("touch click",function(){D(this)}),u("#scheduleContact").val(""),u("#scheduleAllDay").attr("checked",!1),a=NMNS.calendar.getCalendars()[0],u("#scheduleManager").html(u("#scheduleManager").next().find("button[data-calendar-id='"+a.id+"']").html()).data("calendar-id",a.id).data("color",a.color)}}(e)}function Y(e){if(!u("#taskStartDate")[0]._flatpickr){var a={dateFormat:"Y. m. d",enableTime:!1,defaultDate:new Date,locale:"ko"};flatpickr("#taskStartDate",a),flatpickr("#taskEndDate",a),u("#taskBtn").on("touch click",function(){if(""===u("#taskName").val())return alert("일정 이름을 입력해주세요!"),void u("#taskName").focus();var e,a=u("#taskStartDate")[0]._flatpickr.selectedDates[0],t=u("#taskEndDate")[0]._flatpickr.selectedDates[0];a.getTime()>t.getTime()&&(a=[t,t=a][0]);var n=u("#taskStartTime").val(),o=u("#taskEndTime").val();if(n)if(o){if(a.setHours(1*n.substring(0,2)),a.setMinutes(1*n.substring(2)),t.setHours(1*o.substring(0,2)),t.setMinutes(1*o.substring(2)),u("#taskTab").data("edit")){var i=u("#taskTab").data("task");i.manager=i.calendarId,NMNS.history.push(i),i.calendarId!==u("#taskManager").data("calendar-id")?(i.newCalendarId=u("#taskManager").data("calendar-id"),NMNS.calendar.deleteSchedule(i.id,i.manager,!0),NMNS.calendar.createSchedules([{id:i.id,calendarId:u("#taskManager").data("calendar-id"),title:u("#taskName").val(),start:a,end:t,isAllDay:!1,category:"task",dueDateClass:"",color:u("#taskManager").data("color"),bgColor:getBackgroundColor(u("#taskManager").data("color")),borderColor:u("#taskManager").data("color"),raw:{status:"RESERVED"}}])):NMNS.calendar.updateSchedule(i.id,i.calendarId,{title:u("#taskName").val(),start:a,end:t,isAllDay:!1}),NMNS.socket.emit("update reserv",{id:i.id,manager:u("#taskManager").data("calendar-id"),name:u("#taskName").val(),start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),type:"T",isAllDay:!1})}else NMNS.scheduleTarget&&"function"==typeof NMNS.scheduleTarget.clearGuideElement&&NMNS.scheduleTarget.clearGuideElement(),e=NMNS.email+generateRandom(),NMNS.calendar.createSchedules([{id:e,calendarId:u("#taskManager").data("calendar-id"),title:u("#taskName").val(),start:a,end:t,isAllDay:!1,category:"task",dueDateClass:"",color:u("#taskManager").data("color"),bgColor:getBackgroundColor(u("#taskManager").data("color")),borderColor:u("#taskManager").data("color"),raw:{status:"RESERVED"}}]),NMNS.history.push({id:e,manager:u("#taskManager").data("calendar-id"),type:"T"}),NMNS.socket.emit("add reserv",{email:NMNS.email,id:e,manager:u("#taskManager").data("calendar-id"),name:u("#taskName").val(),start:moment(a).format("YYYYMMDDHHmm"),end:moment(t).format("YYYYMMDDHHmm"),isAllDay:!1,type:"T",status:"RESERVED"});u("#scheduleModal").modal("hide")}else showSnackBar("종료 시간을 확인해주세요.");else showSnackBar("시작 시간을 확인해주세요.")}),u("#deleteTaskBtn").on("touch click",function(){var e=u("#taskTab").data("task");NMNS.history.push(e),NMNS.socket.emit("update reserv",{id:e.id,status:"DELETED",type:"T"}),u("#scheduleModal").modal("hide")})}!function(a){var e;if(NMNS.refreshTaskManager&&(NMNS.refreshTaskManager=!1,u("#taskManager").next().html(y()).off("touch click","button").on("touch click","button",function(){u("#taskManager").data("calendar-id",u(this).data("calendar-id")).data("color",u(this).data("color")).html(u(this).html())})),a&&a.id?(u("#taskBtn").text("저장"),u("#deleteTaskBtn").show().next().addClass("ml-1")):(u("#taskBtn").text("일정 추가 완료"),u("#deleteTaskBtn").hide().next().removeClass("ml-1")),"object"==typeof a)u("#taskTab").data("edit",!!a.id).data("task",a),document.getElementById("taskStartDate")._flatpickr.setDate(moment(a.start,"YYYYMMDDHHmm").toDate()),document.getElementById("taskEndDate")._flatpickr.setDate(moment(a.end,"YYYYMMDDHHmm").toDate()),u("#taskStartTime").val(getTimeFormat(moment(a.start,"YYYYMMDDHHmm"))),u("#taskEndTime").val(getTimeFormat(moment(a.end,"YYYYMMDDHHmm"))),u("#taskName").val(a.name||""),u("#taskContents").val(a.raw&&a.raw.contents||""),(e=a.calendarId?NMNS.calendar.getCalendars().find(function(e){return e.id===a.calendarId}):NMNS.calendar.getCalendars()[0])?(e=u("#taskManager").next().find("button[data-calendar-id='"+e.id+"']"),u("#taskManager").html(e.html()).data("calendar-id",e.data("calendar-id")).data("color",e.data("color"))):u("#taskManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+a.color+"'></span><span class='tui-full-calendar-content'>(삭제된 담당자)</span>").data("calendar-id",a.calendarId).data("color",a.color);else if("string"==typeof a)document.getElementById("taskStartDate")._flatpickr.setDate(document.getElementById("scheduleStartDate")._flatpickr.selectedDates[0]),u("#taskStartTime").val(u("#scheduleStartTime").val()),document.getElementById("scheduleEndDate")._flatpickr.setDate(document.getElementById("taskEndDate")._flatpickr.selectedDates[0]),u("#taskEndTime").val(u("#scheduleEndTime").val()),u("#taskAllDay").prop("checked",u("#scheduleAllDay").prop("checked")),e=u("#scheduleManager"),u("#taskManager").data("calendar-id",e.data("calendar-id")).data("color",e.data("color")).html(e.html());else{u("#taskTab").data("edit",!1).removeData("task");var t=moment();t.hour()>Number(NMNS.info.bizEndTime.substring(0,2))||t.hour()==Number(NMNS.info.bizEndTime.substring(0,2))&&t.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?t=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):t.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||t.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&t.minute()<Number(NMNS.info.bizBeginTime.substring(2))?t=moment(NMNS.info.bizBeginTime,"HHmm"):t.minute(10*Math.ceil(t.minute()/10)),document.getElementById("taskStartDate")._flatpickr.setDate(t.toDate()),u("#taskStartTime").val(getTimeFormat(t)),document.getElementById("taskEndDate")._flatpickr.setDate(t.add(30,"m").toDate()),u("#taskEndTime").val(getTimeFormat(t)),u("#taskName").val(""),u("#taskContents").val(""),e=NMNS.calendar.getCalendars()[0].id,e=u("#taskManager").next().find("button[data-calendar-id='"+e+"']"),u("#taskManager").html(e.html()).data("calendarid",e.data("calendarId")).data("color",e.data("color"))}}(e)}function x(e){NMNS.calendar.createSchedules(e.map(function(e){if(e.raw)return"string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),e;var a=s(e.manager||e.calendarId)||{};return{id:e.id,calendarId:a.id||"A1",title:e.name||e.title,start:"string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,end:"string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,isAllDay:!1,category:"T"===e.type?"task":"time",dueDateClass:"T"===e.type?"dueDateClass":"",attendees:[],recurrenceRule:!1,isPending:e.isCanceled,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:getBackgroundColor(a.color||"#334150"),borderColor:a.borderColor||"#334150",color:a.color||"#334150",dragBgColor:a.bgColor||"#334150",raw:{contact:e.contact,contents:e.contents,etc:e.etc,status:e.status}}}),!0)}function E(e){var a=e.parentsUntil("#noShowSearchList",".row");NMNS.history.push({id:a.data("id"),contact:a.data("contact")+"",date:a.data("date")+"",noShowCase:a.data("noshowcase")}),NMNS.socket.emit("delete noshow",{id:a.data("id")}),a.remove()}function I(e){var a="";return e&&e.forEach(function(e){switch(e.type){case"SCHEDULE_ADDED":a+='<div class="notification"><div class="d-flex align-items-center"><span>'+(e.title?"고객명 : "+e.title:"고객번호 : "+e.contact)+'</span><span class="d-flex ml-auto montserrat notificationTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+(e.title?"고객번호 : "+dashContact(e.contact):"")+"<br>예약날짜 : "+moment(e.start,"YYYYMMDDHHmm").format("YYYY. MM. DD")+"<br>예약시간 : "+moment(e.start,"YYYYMMDDHHmm").format("HH시 mm분")+(e.contents?"<br>예약내용 : "+e.contents:"")+'</p></div><div><span class="text-accent font-weight-bold" style="font-size:14px">예약 등록</span></div></div>';break;case"SCHEDULE_CANCELED":a+='<div class="notification"><div class="d-flex align-items-center"><span>'+(e.title?"고객명 : "+e.title:"고객번호 : "+e.contact)+'</span><span class="d-flex ml-auto montserrat notificationTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+(e.title?"고객번호 : "+dashContact(e.contact):"")+"<br>예약날짜 : "+moment(e.start,"YYYYMMDDHHmm").format("YYYY. MM. DD")+"<br>예약시간 : "+moment(e.start,"YYYYMMDDHHmm").format("HH시 mm분")+'</p></div><div class="d-flex align-items-center"><span class="text-accent font-weight-bold" style="font-size:14px">예약 취소</span><span class="d-flex ml-auto addAnnouncementNoShow cursor-pointer" style="font-size:10px" data-schedule-id="'+e.id+'" data-manager-id="'+e.manager+'">직전취소로 노쇼등록 &gt;</span></div></div>';break;case"ANNOUNCEMENT":default:a+='<div class="announcement"><div class="d-flex align-items-center" style="margin-bottom:15px"><span class="announcementTitle">'+e.title+'</span><span class="d-flex ml-auto montserrat announcementTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+e.contents+'</p></div><div><span class="text-accent font-weight-bold" style="font-size:14px">공지사항</span></div></div>'}}),a}function B(){NMNS.initedLnbManagerForm||(NMNS.initedLnbManagerForm=!0,u("#lnbManagerColor").on("change",function(e){e.stopPropagation();var a=u(this).find("input:checked").val();u("#lnbManagerFormColor").css("borderColor",a).css("background-color",a).data("value",a)}),u("#lnbManagerFormSubmit").on("touch click",function(e){var a=u("#lnbManagerFormName").val();if(!a||a.length<1)showSnackBar("담당자 이름을 입력해주세요.");else{var t=u("#lnbManagerFormColor").data("value"),n=u("#lnbManagerForm").data("id");if(n){var o=s(n);if(o){var i=u("#lnbManagerList .lnbManagerItem[data-value='"+o.id+"']");return t===o.color&&a===o.name||(NMNS.calendar.setCalendar(o.id,{color:t,bgColor:getBackgroundColor(t),borderColor:t,name:a},!0),NMNS.calendar.setCalendarColor(o.id,{color:t,bgColor:getBackgroundColor(t),borderColor:t},!0),NMNS.history.push({id:o.id,color:o.color,name:o.name}),i.find("span:not(.menu-collapsed)").data("color",t),i.find("input").prop("checked")&&i.find("span:not(.menu-collapsed)").css("backgroundColor",t).css("borderColor",t),i.find("span.menu-collapsed").text(a),NMNS.socket.emit("update manager",{id:o.id,color:t,name:a})),i.show(),void u("#lnbManagerForm").hide()}}n=NMNS.email+generateRandom(),u("#lnbManagerList").append(u(p([{color:t,name:a,id:n,checked:!0}])).on("touch click",".updateManagerLink",f).on("touch click",".removeManagerLink",g)),u("#sidebarContainer").data("scroll")&&u("#sidebarContainer").data("scroll").update();var l=NMNS.calendar.getCalendars();l.push({id:n,name:a,checked:!0,bgColor:getBackgroundColor(t),borderColor:t,color:t}),NMNS.calendar.setCalendars(l),NMNS.socket.emit("add manager",{id:n,name:a,color:t}),u("#lnbManagerForm").hide()}}),u("#lnbManagerFormName").on("keyup",function(e){13===e.which?u("#lnbManagerFormSubmit").trigger("click"):27===e.which&&u(".addManager").trigger("click")}))}function H(e,a){e&&e.preventDefault&&e.preventDefault(),u(this).hasClass("menuLinkActive")||(u(".switchingMenu:not(."+u(this).data("link")+")").hide(),u("."+u(this).data("link")).show().hasClass("salesMenu")?u("#mainRow").addClass("fixedScroll"):u("#mainRow").removeClass("fixedScroll"),u(".menuLinkActive").removeClass("menuLinkActive"),u(this).addClass("menuLinkActive"),u("#mainCalendarArea").css("minWidth",""),u("#mainContents").css("minWidth","100%"),u("#mainAside").css("minWidth","0px"),u("#mainTask").removeClass("show"),u(document.body).removeClass("overflow-y-hidden"),a||history.pushState({link:u(this).data("link")},"",u(this).data("history")))}NMNS.calendar=new tui.Calendar("#mainCalendar",{taskView:[],defaultView:550<u(window).width()?"week":"day",scheduleView:["time"],useCreationPopup:!1,useDetailPopup:!0,disableDblClick:!0,template:{allday:function(e){return t(e,e.isAllDay)},time:function(e){return t(e,e.isAllDay)},task:function(e){return t(e,e.isAllDay)},alldayTitle:function(){return"<span class='tui-full-calendar-left-content'>하루종일</span>"},taskTitle:function(){return"<span class='tui-full-calendar-left-content'>일정</span>"},timegridDisplayPrimayTime:function(e){return e.hour+":00"},popupIsAllDay:function(){return"하루종일"},startDatePlaceholder:function(){return"시작시간"},endDatePlaceholder:function(){return"종료시간"},popupDetailDate:function(e,a,t){var n=moment(a instanceof Date?a:a.toDate()),o=moment(t instanceof Date?t:t.toDate()),i=n.isSame(o,"day"),l=(i?"":"YYYY.MM.DD ")+"a h:mm";return e?n.format("YYYY.MM.DD")+(i?"":" - "+o.format("YYYY.MM.DD")):n.format("YYYY.MM.DD a h:mm")+" - "+o.format(l)},popupEdit:function(){return"수정"},popupDelete:function(){return"삭제"},weekDayname:function(a){var e="tui-full-calendar-dayname-date",t="tui-full-calendar-dayname-name"+(NMNS.calendar&&"week"===NMNS.calendar.getViewName()?" weekViewDayName":""),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===a.renderDate}):void 0;return n&&(t+=" tui-full-calendar-holiday",e+=" tui-full-calendar-holiday"),'<span class="'+e+'">'+a.date+'</span>&nbsp;&nbsp;<span class="'+t+'">'+a.dayName+(n?" ("+n.title+")":"")+"</span>"},monthGridHeader:function(a){var e=parseInt(a.date.split("-")[2],10),t=["tui-full-calendar-weekday-grid-date"],n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===a.date}):void 0;return n&&t.push("tui-full-calendar-holiday"),'<span class="'+t.join(" ")+'">'+e+(n?"<small class='d-none d-sm-inline'> ("+n.title+")</small>":"")+"</span>"},monthGridHeaderExceed:function(){return""},monthGridFooterExceed:function(e){return'<span class="tui-full-calendar-weekday-grid-more-schedules" title="전체 예약">전체 예약 <span class="icon-arrow icon-arrow-right"></span></span>'},monthMoreTitleDate:function(e,a){var t=e.split(".").join("-"),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===t}):void 0;return'<span class="'+("tui-full-calendar-month-more-title-day"+("일"===a?" tui-full-calendar-holiday-sun":"")+(n?" tui-full-calendar-holiday":"")+("토"===a?" tui-full-calendar-holiday-sat":""))+'">'+parseInt(t.substring(8),10)+'</span> <span class="tui-full-calendar-month-more-title-day-label">'+a+(n?"<small class='d-none d-sm-inline'> ("+n.title+")</small>":"")+"</span>"},monthlyDetailPopup:function(e,a){var t,n="<div class='d-flex flex-column position-relative'><button type='button' class='tui-full-calendar-popup-close close p-0 ml-auto my-0 mr-0 position-absolute' aria-label='닫기' style='right:0'><span aria-hidden='true' style='vertical-align:top;font-size:12px'>&times;</span></button>",o=moment(a);return e.forEach(function(a,e){if(0===e&&(n+="<div class='d-flex'>"),n+="<div class='monthlyDetailPopupTime montserrat col px-0'>"+(moment(a.start.toDate()).isSame(o,"days")?moment(a.start.toDate()).format("HH:mm"):moment(a.start.toDate()).format("MM. DD HH:mm"))+(a.end?moment(a.end.toDate()).isSame(o,"days")?moment(a.end.toDate()).format(" - HH:mm"):moment(a.end.toDate()).format(" - MM. DD HH:mm"):"")+"</div>",0===e&&(n+="<div class='d-inline-block' style='width:25px'></div></div>"),a.title&&""!==a.title)t=a.title;else if(a.raw.contents&&""!==a.raw.contents)try{t=JSON.parse(a.raw.contents).map(function(e){return e.value}).join(", ")}catch(e){t=a.raw.contents}else t=a.raw.contact&&""!==a.raw.contact?a.raw.contact:"";n+="<div class='monthlyDetailPopupTitle col-12 px-0'>"+t+"</div>"}),n+="</div>"}},month:{daynames:["일","월","화","수","목","금","토"],scheduleFilter:function(){return!0},grid:{header:{height:26}}},week:{daynames:["일","월","화","수","목","금","토"],hourStart:NMNS.info.bizBeginTime?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info.bizEndTime?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23},theme:{"common.border":"1px solid rgba(57, 53, 53, 0.2)","common.saturday.color":"#1736ff","common.dayname.color":"#393535","common.holiday.color":"#fd5b77","common.creationGuide.backgroundColor":"#ffdbdb","common.creationGuide.border":"1px solid #ffdbdb","month.schedule.marginLeft":"0px","month.schedule.marginRight":"1px","month.schedule.marginTop":"5px","month.schedule.height":"12px","month.dayname.height":"52px","month.dayname.borderLeft":"none","month.dayname.borderTop":"none","month.dayname.textAlign":"center","month.dayname.fontWeight":"normal","month.holidayExceptThisMonth.color":"rgba(253, 91, 119, 0.35)","month.saturdayExceptThisMonth.color":"rgba(23, 54, 255, 0.35)","month.dayExceptThisMonth.color":"rgba(57, 53, 53, 0.35)","month.day.fontSize":"13px","week.currentTime.color":"#fd5b77","week.currentTimeLinePast.border":"1px solid #fd5b77","week.currentTimeLineBullet.backgroundColor":"transparent","week.currentTimeLineToday.border":"1px solid #fd5b77","week.currentTimeLineFuture.border":"1px solid #fd5b77","week.timegridOneHour.height":"68px","week.timegridHalfHour.height":"34px","week.vpanelSplitter.height":"5px","week.pastDay.color":"#393535","week.futureDay.color":"#393535","week.pastTime.color":"#393535","week.futureTime.color":"#393535","week.creationGuide.color":"#fd5b77","week.today.backgroundColor":"inherit","week.timegrid.paddingRight":"1px","week.dayGridSchedule.marginRight":"1px","week.dayname.borderTop":"none","week.dayname.borderBottom":"none","week.dayname.borderLeft":"none","week.dayname.textAlign":"center","week.dayname.height":"51px","week.dayGridSchedule.borderLeft":"2px solid","week.timegridHorizontalLine.borderBottom":"1px solid rgba(57, 53, 53, 0.2)","week.daygrid.borderRight":"1px solid rgba(57,53,53,0.2)","week.timegrid.borderRight":"1px solid rgba(57,53,53,0.2)","week.daygridLeft.width":"54px","week.timegridLeft.borderRight":"none","week.timegridLeft.width":"54px"}}),NMNS.calendar.on({clickSchedule:function(e){"monthlyClickSchedule"!==e.type&&(T(NMNS.scheduleTarget=e),u("#scheduleTabList a[data-target='#scheduleTab']").text("예약 상세").tab("show"),u("#scheduleTabList a[data-target='#taskTab']").text("일정 추가"),u("#taskBtn").text("일정 추가 완료"),u("#deleteTaskBtn").hide().next().removeClass("ml-1"),u("#scheduleBtn").text("저장"),u("#scheduleModal").addClass("update").modal("show"))},beforeCreateSchedule:function(e){T(NMNS.scheduleTarget=e),u("#scheduleTabList a[data-target='#scheduleTab']").text("예약 추가").tab("show"),u("#scheduleTabList a[data-target='#taskTab']").text("일정 추가"),u("#taskBtn").text("일정 추가 완료"),u("#deleteTaskBtn").hide().next().removeClass("ml-1"),u("#scheduleBtn").text("예약 추가 완료"),u("#scheduleModal").removeClass("update").modal("show")},beforeUpdateSchedule:function(e){if(e.schedule&&e.start&&e.end){var a=e.schedule||u.extend(!0,{},e.schedule);NMNS.history.push(a),e.schedule.start=e.start||e.schedule.start,e.schedule.end=e.end||e.schedule.end,NMNS.calendar.updateSchedule(e.schedule.id,e.history?e.history.selectedCal.id:e.schedule.calendarId,e.schedule),NMNS.socket.emit("update reserv",{id:e.schedule.id,start:moment(e.schedule.start.toDate?e.schedule.start.toDate():e.schedule.start).format("YYYYMMDDHHmm"),end:moment(e.schedule.end.toDate?e.schedule.end.toDate():e.schedule.end).format("YYYYMMDDHHmm")})}},beforeDeleteSchedule:function(e){NMNS.history.push(e.schedule),NMNS.calendar.deleteSchedule(e.schedule.id,e.schedule.calendarId),NMNS.socket.emit("update reserv",{id:e.schedule.id,status:"DELETED"})},beforeChangeView:function(e){NMNS.calendar.changeView(e.viewName),NMNS.calendar.setDate(e.date),o(),r(),m()}}),NMNS.socket=io(),NMNS.socket.emit("get info"),NMNS.socket.emit("get manager"),setTimeout(function(){NMNS.socket.emit("get task",{start:moment().format("YYYYMMDD"),end:moment().add(7,"days").format("YYYYMMDD")})},200),NMNS.socket.on("get reserv",socketResponse("예약 정보 받아오기",function(e){x(e.data),NMNS.holiday=NMNS.holiday.concat(e.holiday.filter(function(a){return!NMNS.holiday.some(function(e){return e.date===a.date})})),c()})),NMNS.socket.on("get info",socketResponse("매장 정보 받아오기",function(e){NMNS.info=e.data,NMNS.calendar&&NMNS.calendar.setOptions({week:{hourStart:NMNS.info.bizBeginTime?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info.bizEndTime?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23}}),NMNS.email=e.data.email||NMNS.email,NMNS.calendarHeight=4.26*(NMNS.calendar.getOptions().week.hourEnd-NMNS.calendar.getOptions().week.hourStart)+7.25,u("#mainCalendar").css("height",NMNS.calendarHeight+"rem"),"BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus&&moment(NMNS.info.signUpDate,"YYYYMMDD").add(30,"d").isSameOrAfter(moment(),"day")&&showNotification({title:"이메일을 인증해주세요!",body:"이메일을 인증하면 WA:SHOW의 모든 기능을 이용하실 수 있습니다. 이메일을 인증해주세요! 인증메일은 내 매장 정보 화면에서 다시 보내실 수 있습니다."}),NMNS.info.newAnnouncement?(u("#announcementIcon").addClass("icon-announcement-count"),u(".announcementCount").html(99<NMNS.info.newAnnouncement?"99+":NMNS.info.newAnnouncement)):u("#announcementIcon").removeClass("icon-announcement-count"),NMNS.info.logo&&S(!0,NMNS.info.logo)})),NMNS.socket.on("get manager",socketResponse("담당자 정보 받아오기",function(e){e.data.forEach(function(e){e.checked=!0,e.bgColor=getBackgroundColor(e.color),e.borderColor=e.color,e.color=e.color}),u("#lnbManagerList").html(p(e.data)).on("touch click",".updateManagerLink",f).on("touch click",".removeManagerLink",g),u("#sidebarContainer").data("scroll")&&u("#sidebarContainer").data("scroll").update(),NMNS.calendar.setCalendars(e.data),NMNS.needInit&&(delete NMNS.needInit,m()),u("#mainTaskContents input").off("change").on("change",function(e){e.stopPropagation();var a=u(this).parent();NMNS.history.push({id:a.data("id"),category:"task",isDone:!u(this).prop("checked")}),NMNS.socket.emit("update reserv",{id:a.data("id"),type:"T",isDone:u(this).prop("checked")})}),u("#mainTaskContents .task").off("touch click").on("touch click",function(e){e.stopPropagation();var a=u(this).parent();Y({id:a.data("id"),name:a.data("name"),start:a.data("start"),end:a.data("end"),calendarId:a.data("calendar-id"),category:"task"}),u("#scheduleTabList a[data-target='#taskTab']").tab("show"),u("#scheduleTabList a[data-target='#scheduleTab']").text("예약 추가"),u("#scheduleBtn").text("예약 추가 완료"),u("#scheduleModal").removeClass("update").modal("show")}),c()})),u("#resizeCalendar").on("touch click",function(){u(this).hasClass("maximized")?u(".calendarMenu .menuTitle").css("display","flex"):u(".calendarMenu .menuTitle").hide(),NMNS.calendar.render(),u(this).toggleClass("maximized").blur()}),u("#toggleCalendarToday").on("touch click",function(){u(this).blur(),NMNS.calendar.setDate(new Date),o(),r(),m()}),NMNS.generateMenuList=C,o(),r(),u(window).width()<900&&u("#sidebarToggler").trigger("click"),NMNS.socket.on("get summary",socketResponse("예약정보 가져오기",function(e){var n="";0===e.data.length?n="<div class='row col-12 px-0 mt-1 empty'><span class='col-12 text-center'>검색된 내용이 없습니다. 검색조건을 바꿔서 검색해보세요 :)</span></div>":e.data.forEach(function(a){var t="";if("NOSHOW"!==a.status){if(a.contents)try{t=JSON.parse(a.contents).map(function(e){return e.value}).join(", ")}catch(e){t=a.contents}n+="<div class='row col-12 mx-0' style='padding: 10px 0;font-size:12px' data-id='"+(a.id||"")+"' data-manager='"+(a.manager||"")+"' data-status='"+(a.status||"")+"'"+(a.contents?" title='"+t+"'":"")+"><div class='col-1 pl-0'><input type='checkbox' class='noShowScheduleCheck' id='noShowSchedule"+a.id+"'></input><label for='noShowSchedule"+a.id+"'></label></div><div class='col-2 montserrat px-0'>"+(a.start?moment(a.start,"YYYYMMDDHHmm").format("YYYY. MM. DD"):"")+"</div><div class='col-2 pr-0'>"+(a.name||"")+"</div><div class='col-3 pr-0 montserrat'>"+dashContact(a.contact)+"</div><div class='col-4 pr-0'>"+t+"</div></div>"}}),u("#noShowScheduleList").html(n),u("#noShowScheduleList input[type=checkbox]").on("change",function(e){u("#noShowScheduleList input[type=checkbox]").not(this).prop("checked",!1),u(this).prop("checked")&&(0<u("#noShowScheduleContent .bg-primary").length||0<u("#noShowScheduleCaseEtc").val().trim().length)?u("#noShowScheduleBtn span").css("opacity",1):u("#noShowScheduleBtn span").css("opacity",.35)}),u("#noShowScheduleList").hasClass("ps")&&u("#noShowScheduleList").data("scroll").update()})),NMNS.socket.on("add reserv",socketResponse("예약/일정 추가하기",function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),"T"===e.type&&NMNS.socket.emit("get task",{start:moment().format("YYYYMMDD"),end:moment().add(7,"days").format("YYYYMMDD")})},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),delete e.id,NMNS.calendar.deleteSchedule(a.data.id,e.manager)})),NMNS.socket.on("update reserv",socketResponse("예약/일정 정보 변경하기",function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),"task"===e.category?"boolean"!=typeof e.isDone&&NMNS.socket.emit("get task",{start:moment().format("YYYYMMDD"),end:moment().add(7,"days").format("YYYYMMDD")}):u("#noShowScheduleList").is(":visible")&&u("#noShowScheduleList .row[data-id='"+a.data.id+"']").length?(showSnackBar("<span>노쇼로 등록하였습니다.</span>"),u("#noShowScheduleList .row[data-id='"+a.data.id+"']").remove(),u("#noShowScheduleBtn span").css("opacity",.35)):u("#notificationBody").is(":visible")&&u("#notificationBody .addAnnouncementNoShow[data-schedule-id='"+a.data.id+"']").length&&(showSnackBar("<span>노쇼로 등록하였습니다.</span>"),u("#notificationBody .addAnnouncementNoShow[data-schedule-id='"+a.data.id+"']").hide())},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});NMNS.history.remove(a.data.id,function(e,a){return e.id===a}),e&&("task"===e.category?"boolean"==typeof e.isDone&&u("#mainTaskContents .task[data-id='"+e.id+"'] input").prop("checked",e.isDone):"DELETED"===(e.status||e.raw.status)?(x([e]),c()):e.newCalendarId&&!NMNS.calendar.getSchedule(a.data.id,e.selectedCal?e.selectedCal.id:e.calendarId)?(NMNS.calendar.deleteSchedule(a.data.id,e.newCalendarId,!0),e.category="task"===e.category?"task":"time",e.dueDateClass="",e.calendarId=e.selectedCal?e.selectedCal.id:e.calendarId,e.start="string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,e.end="string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,e.color=e.color||e.selectedCal.color,e.bgColor=e.bgColor||e.selectedCal.bgColor,e.borderColor=e.borderColor||e.selectedCal.borderColor,NMNS.calendar.createSchedules([e])):("string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),NMNS.calendar.updateSchedule(a.data.id,e.selectedCal?e.selectedCal.id:e.calendarId,e)))})),NMNS.socket.on("get task",socketResponse("일정 가져오기",function(e){e.data.some(function(e){return e.date===moment().format("YYYYMMDD")})&&u("#todayTask").text(e.data.find(function(e){return e.date===moment().format("YYYYMMDD")}).task.length),u("#mainTaskContents").html(function(e){var o="";if(0<e.length){var a=moment().format("YYYYMMDD"),t=moment().add(1,"days").format("YYYYMMDD");e.forEach(function(n){0<n.task.length&&(o+="<div class='taskDate' style='font-size:12px;opacity:0.5'><hr class='hr-text' data-content='"+(n.date===a?"오늘":n.date===t?"내일":moment(n.date,"YYYYMMDD").format("YYYY. MM. DD"))+"'></div>",n.task.forEach(function(e,a){var t=s(e.manager)||{};o+="<div class='position-relative' data-id='"+e.id+"' data-calendar-id='"+e.manager+"' data-start='"+e.start+"' data-end='"+e.end+"' data-name='"+e.name+"'><input type='checkbox' class='task-checkbox' id='task-checkbox"+a+"'"+(e.isDone?" checked='checked'":"")+"><label for='task-checkbox"+a+"'></label><div class='flex-column d-inline-flex cursor-pointer task' style='margin-left:10px;max-width:calc(100% - 35px)'><div style='font-size:14px'>"+e.name+"</div><div class='montserrat' style='font-size:12px;opacity:0.5'>"+moment(e.start,"YYYYMMDDHHmm").format(moment(e.start,"YYYYMMDDHHmm").isSame(moment(n.date,"YYYYMMDD"),"day")?"HH:mm":"MM. DD HH:mm")+(e.end?" - "+moment(e.end,"YYYYMMDDHHmm").format(moment(e.end,"YYYYMMDDHHmm").isSame(moment(n.date,"YYYYMMDD"),"day")?"HH:mm":"MM. DD HH:mm"):"")+"</div></div><span class='tui-full-calendar-weekday-schedule-bullet' style='top:8px;right:0;left:auto;background:"+t.borderColor+"' title='"+t.name+"'></span></div>"}))})}else o="<div class='align-items-center justify-center d-flex flex-column' style='height:100%;font-size:13px'>등록된 일정이 없어요.</div>";return o}(e.data)),0===e.data.length?u("#mainTaskContents").addClass("position-absolute"):u("#mainTaskContents").removeClass("position-absolute"),u("#mainTaskContents input").off("change").on("change",function(e){e.stopPropagation();var a=u(this).parent();NMNS.history.push({id:a.data("id"),category:"task",isDone:!u(this).prop("checked")}),NMNS.socket.emit("update reserv",{id:a.data("id"),type:"T",isDone:u(this).prop("checked")})}),u("#mainTaskContents .task").off("touch click").on("touch click",function(e){e.stopPropagation(),T();var a=u(this).parent();Y({id:a.data("id"),name:a.data("name"),start:a.data("start"),end:a.data("end"),calendarId:a.data("calendar-id"),category:"task"}),u("#deleteTaskBtn").show().next().addClass("ml-1"),u("#scheduleTabList a[data-target='#scheduleTab']").text("예약 추가").parent().next().find("a").text("일정 상세").tab("show"),u("#scheduleBtn").text("예약 추가 완료"),u("#taskBtn").text("저장"),u("#scheduleModal").removeClass("update").modal("show")})})),NMNS.socket.on("add manager",socketResponse("담당자 추가하기",function(){NMNS.refreshScheduleManager=!0},function(a){NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().filter(function(e){return e.id!==a.data.id})),u(".lnbManagerItem[data-value='"+a.data.id+"']").remove()})),NMNS.socket.on("delete manager",socketResponse("담당자 삭제하기",function(e){NMNS.history.remove(e.data.id,findById),NMNS.refreshScheduleManager=!0},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(e){var t=NMNS.calendar.getCalendars();t.push(e),NMNS.calendar.setCalendars(t),u("#lnbManagerList").html(p(t)).on("touch click",".updateManagerLink",f).on("touch click",".removeManagerLink",g),u("#sidebarContainer").data("scroll")&&u("#sidebarContainer").data("scroll").update(),c(),NMNS.history.remove(a.data.id,findById)}})),NMNS.socket.on("update manager",socketResponse("담당자 변경하기",function(e){NMNS.history.remove(e.data.id,findById),NMNS.refreshScheduleManager=!0},function(a){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(e){var t=u("#lnbManagerList .lnbManagerItem[value='"+a.data.id+"']");t.find("span:not(.menu-collapsed)").data("color",e.color),t.find("input").prop("checked")&&t.find("span:not(.menu-collapsed)").css("backgroundColor",e.color).css("borderColor",e.color),t.find(".menu-collapsed").text(e.name),t.hide(),u("#lnbManagerForm").show(),NMNS.history.remove(a.data.id,findById)}})),NMNS.socket.on("update info",socketResponse("매장 정보 변경하기",function(){showSnackBar("<span>정상적으로 매장 정보를 변경하였습니다.</span>");var e=NMNS.history.find(function(e){return"info"===e.id});NMNS.history.remove("info",findById),e.logo&&(u("#infoLogo").data("done",!0),NMNS.info.logo=void 0,NMNS.info.logoFileName=void 0),u("#infoModal").modal("hide")},function(e){var a=NMNS.history.find(function(e){return"info"===e.id});(a.bizBeginTime||a.bizEndTime)&&NMNS.calendar.setOptions({week:{hourStart:a.bizBeginTime?a.bizBeginTime.substring(0,2):NMNS.info.bizBeginTime.substring(0,2),hourEnd:a.bizEndTime?a.bizEndTime.substring(0,2):NMNS.info.bizEndTime.substring(0,2)}}),a.shopName&&N(a.shopName),a.logo&&S(!0,a.logo),NMNS.info.shopName=a.shopName||NMNS.info.shopName,NMNS.info.bizType=a.bizType,NMNS.history.remove("info",findById),NMNS.initedInfoModal=!1})),NMNS.socket.on("upload logo",socketResponse("로고이미지 등록하기",function(e){S(!0,e.data.logo),showSnackBar("<span>이미지를 등록하였습니다.</span>"),NMNS.info.logo=e.data.logo,u("#infoLogo").data("done",!0),u("#infoModal").modal("hide")})),NMNS.socket.on("update alrim",socketResponse("알림톡 정보 변경하기",function(){showSnackBar("<span>정상적으로 알림톡 정보를 변경하였습니다.</span>"),NMNS.history.remove("alrimInfo",findById)},function(){var a=NMNS.history.find(function(e){return"alrimInfo"===e.id});Object.keys(a).forEach(function(e){NMNS.info.alrimTalkInfo[e]=a[e]}),NMNS.history.remove("alrimInfo",findById),NMNS.initedAlrimModal=!1})),NMNS.socket.on("get noshow",socketResponse("노쇼 정보 가져오기",function(a){if(0<a.data.summary.noShowCount){if(u("#noShowClean").removeClass("d-flex").addClass("d-none"),u("#noShowDirtyImage").attr("src")||u("#noShowDirtyImage").attr("src","/nmns/img/badperson.png"),u("#myNoShowCount").text(a.data.detail.length),u("#otherNoShowCount").text(Math.max(a.data.summary.noShowCount-a.data.detail.length,0)),a.data.summary.lastNoShowDate&&u("#noShowSearchSummary").text("마지막 노쇼는 "+moment(a.data.summary.lastNoShowDate,"YYYYMMDD").format("YYYY년 M월 D일입니다.")),0<a.data.detail.length){var t="<div class='row col-12 mx-0'><div class='col col-3'>전화번호</div><div class='col col-3'>노쇼 날짜</div><div class='col col-4'>노쇼 사유</div></div>";a.data.detail.forEach(function(e){t+="<div class='row col-12 noShowRow' data-id='"+e.id+"' data-contact='"+(a.data.summary.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"+(e.noShowCase||"")+"'><div class='col col-3'>"+(a.data.summary.contact?dashContact(a.data.summary.contact):"")+"</div><div class='col col-3'>"+(e.date?e.date.substring(0,4)+". "+e.date.substring(4,6)+". "+e.date.substring(6):"")+"</div><div class='col col-4 base-font' style='font-size:10px'>"+(e.noShowCase||"")+"</div><div class='col-2 pr-0 d-flex'><span class='noShowSearchDelete' title='삭제'>&times;</span></div></div>"}),u("#noShowSearchList").html(t),u("#noShowSearchList .noShowSearchDelete").on("touch click",function(){E(u(this))})}u("#noShowDirty").removeClass("d-none").addClass("d-flex")}else u("#noShowDirty").removeClass("d-flex").addClass("d-none"),u("#noShowClean").removeClass("d-none").addClass("d-flex"),u("#noShowImage").attr("src")||u("#noShowImage").attr("src","/nmns/img/goodperson.png"),u("#noShowSentense").text(["안심하세요. 노쇼를 하신 적이 없어요!","이분 최소 배우신분!! 노쇼 이력이 없어요.","노쇼를 하신 적이 없어요! 격하게 환영해주세요~~"][Math.floor(3*Math.random())])})),NMNS.socket.on("add noshow",socketResponse("노쇼 추가하기",function(e){showSnackBar("<span>추가되었습니다! 다른 분들에게 많은 도움이 될거에요 :)</span>")})),NMNS.socket.on("delete noshow",socketResponse("노쇼 삭제하기",function(e){NMNS.history.remove(e.data.id,findById)},function(a){if(a&&a.data){var e=NMNS.history.find(function(e){return e.id===a.data.id});if(e){var t=u("<div class='row col-12 noShowRow' data-id='"+e.id+"' data-contact='"+(e.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"+(e.noShowCase||"")+"'><div class='col col-3'>"+(e.contact?dashContact(e.contact):"")+"</div><div class='col col-3'>"+(e.date?e.date.substring(0,4)+". "+e.date.substring(4,6)+". "+e.date.substring(6):"")+"</div><div class='col col-4 base-font' style='font-size:10px'>"+e.noShowCase+"</div><div class='col-2 pr-0 text-right'><span class='noShowSearchDelete' title='삭제'>&times;</span></div></div>");t.find(".noShowSearchDelete").off("touch click").on("touch click",function(){E(u(this))}),u("#noShowSearchList .empty").length?u("#noShowSearchList").html(t):u("#noShowSearchList .noShowSearchAdd").length?t.insertBefore("#noShowSearchList .noShowSearchAdd:first-child"):u("#noShowSearchList").append(t)}}})),NMNS.socket.on("update password",socketResponse("비밀번호 변경하기")),NMNS.socket.on("get customer info",socketResponse("자동완성 자료 가져오기",function(e){if(e.data.id){var a=u("#"+e.data.id);a.autocomplete().onSuccess.call(a.autocomplete(),e.data.query,e.data.result)}},function(e){if(e.data.id){var a=u("#"+e.data.id);a.autocomplete().onFail.call(a.autocomplete(),e.data)}},!0)),NMNS.socket.on("get customer",socketResponse("고객 정보 가져오기",function(e){var a=u("#scheduleTab");if(a.is(":visible")){if(e.data.contact===a.find("#scheduleContact").val().replace(/-/gi,"")&&a.data("contact")!==e.data.contact||e.data.name===a.find("#scheduleName").val()&&a.data("name")!==e.data.name){if(e.data.etc&&a.find("#scheduleEtc").val(e.data.etc),e.data.manager){var t=s(e.data.manager);t&&a.find("#scheduleManager").html(a.find("#scheduleManager").next().find("button[data-calendar-id='"+t.id+"']").html()).data("calendar-id",t.id)}e.data.contents&&a.find("#scheduleTabContents").append(w(e.data.contents)).find("button").off("touch click").on("touch click",function(){D(this)}),e.data.name&&""===a.find("#scheduleName").val()&&a.find("#scheduleName").val(e.data.name),e.data.contact&&""===a.find("#scheduleContact").val().replace(/-/gi,"")&&a.find("#scheduleContact").val(e.data.contact)}void 0!==e.data.totalNoShow&&0<e.data.totalNoShow&&a.find("#scheduleContact").is(":visible")&&(a.find("#scheduleContact").tooltip({title:"이 번호에는 총 "+e.data.totalNoShow+"건의 노쇼가 등록되어 있습니다."+(e.data.myNoShow&&0<e.data.myNoShow?"<br/>우리 매장에서는 "+e.data.myNoShow+"건 등록되었습니다.":""),placement:"top",trigger:"click hover focus",delay:{hide:1e3},html:!0}).tooltip("show"),setTimeout(function(){a.find("#scheduleContact").tooltip("hide")},3e3),a.find("#scheduleContact").one("keyup change",function(){u(this).tooltip("dispose")}))}},void 0,!0)),NMNS.socket.on("message",socketResponse("서버 메시지 받기",function(e){"push"===e.type?e.data.forEach(function(e){showNotification(e)}):"alert"===e.type&&(showSnackBar(e.data.body),0<=e.data.body.indexOf("새로운 고객이 추가되었습니다")&&(NMNS.customerList=null))},void 0,!0)),NMNS.socket.on("get alrim history",socketResponse("알림톡 내역 조회",function(e){!function(e){var a=u("#alrimHistoryList");if(a.hasClass("ps")||a.data("scroll",new PerfectScrollbar("#alrimHistoryList")),e&&0<e.length){var t="",n=u("#alrimHistoryList .alrimRow").length;e.forEach(function(e,a){t+='<div class="row alrimRow col mx-0 px-0" title="눌러서 전송된 알림톡 내용 보기"><a href="#alrimDetail'+(a+n)+'" class="alrimDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="alrimDetail'+(a+n)+'"></a><div class="col-2 pr-0 text-left montserrat">'+moment(e.date,"YYYYMMDDHHmm").format("YYYY. MM. DD")+'</div><div class="col-3 offset-2 ellipsis">'+(e.name||"(이름 없음)")+'</div><div class="col-4 px-0 montserrat">'+dashContact(e.contact)+'</div><div class="col-1"></div></div><div class="row alrimDetailRow collapse mx-0 col-12" id="alrimDetail'+(a+n)+'">'+(e.contents?e.contents.replace(/\n/g,"<br>"):"")+"</div>",0<a&&a%50==0&&(u("#alrimHistoryList").append(t),t="")}),a.append(t),u("#alrimHistoryList .alrimDetailLink").off("touch click").on("touch click",function(){u(this).parent().toggleClass("show")})}else a.append("<div class='row alrimRow'><span class='col-12 text-center'>검색된 결과가 없습니다.</span></div>");a.data("scroll").update()}(e.data)},void 0,!0)),NMNS.socket.on("resend alrimtalk",socketResponse("알림톡 다시 보내기",function(e){u("#resendAlrimScheduleBtn").addClass("d-none"),showSnackBar("<span>고객에게 알림톡을 다시 보냈습니다!</span>")},function(e){u("#resendAlrimScheduleBtn").addClass("d-none"),showSnackBar("<span>"+e.message||"알림톡을 다시 보내지 못했습니다.</span>")},!0)),NMNS.socket.on("get announcement",socketResponse("공지사항 조회",function(e){if(0===u("#notificationBody").children().length&&u("#notificationBody").html(""),0<e.data.announcement.length?(u("#announcementArea").parent().removeClass("d-none"),u("#announcementArea").append(I(e.data.announcement))):1===NMNS.announcementPage&&u("#announcementArea").parent().addClass("d-none"),u("#notificationBody").find(".flex-column").remove(),0<e.data.schedule.length){u("#notificationEmpty").hide();var a=u(I(e.data.schedule));a.find(".addAnnouncementNoShow").on("touch click",function(){var e=NMNS.calendar.getSchedule(u(this).data("schedule-id"),u(this).data("manager-id"));e&&(NMNS.history.push({id:e.id,calendarId:e.calendarId,raw:{status:e.raw.status}}),NMNS.calendar.updateSchedule(u(this).data("schedule-id"),u(this).data("manager-id"),{raw:{status:"NOSHOW"}})),NMNS.socket.emit("update reserv",{id:u(this).data("schedule-id"),status:"NOSHOW",noShowCase:"직전취소"})}),u("#notificationBody").append(a).show()}else 1===NMNS.announcementPage&&(u("#notificationBody").hide(),u("#notificationEmpty").css("display","flex"));var t=NMNS.info.newAnnouncement;if(t&&0<t){var n=0;e.data.schedule.forEach(function(e){e.isRead||n++}),e.data.announcement.forEach(function(e){e.isRead||n++}),n<t?(u(".announcementCount").text(99<t-n?"99+":t-n),NMNS.info.newAnnouncement=t-n,u("#announcementIcon").addClass("icon-announcement-count")):(u(".announcementCount").text(""),NMNS.info.newAnnouncement=0,u("#announcementIcon").removeClass("icon-announcement-count"))}5<=e.data.schedule.length+e.data.announcement.length?NMNS.expectMoreAnnouncement=!0:NMNS.expectMoreAnnouncement=!1})),NMNS.socket.on("get menu list",socketResponse("메뉴 목록 조회",function(e){u("#scheduleTabContentList").length&&u("#scheduleTabContentList").html(C(e.data)),NMNS.menuList=e.data,NMNS.drawMenuList&&u("#mainMenuList").is(":visible")&&NMNS.drawMenuList(!0)},void 0,!0)),NMNS.socket.on("get reserv sales",socketResponse("매출 정보 가져오기",function(e){u("#salesForm").html(function(t){var n="";if(Array.isArray(t)&&0<t.length){var o,i=t[0]&&0<t[0].balanceMembership;t.forEach(function(e,a){o=Number.isInteger(e.priceCard)||Number.isInteger(e.priceCash)||Number.isInteger(e.priceMembership),n+='<div class="scheduleSalesItem">'+e.item+'</div><div class="scheduleSalesPayments" data-item="'+e.item+'" data-index="'+a+'" data-id="'+(e.id||moment().format("YYYYMMDDHHmmssSSS")+generateRandom())+'"'+(e.customerId?' data-customer-id="'+(e.customerId||"")+'"':"")+(e.managerId?' data-manager-id="'+(e.managerId||"")+'"':"")+' data-type="'+(e.type||"CARD")+'" data-is-registered="'+o+'">',o||(n+='<input type="text" pattern="[0-9]*" class="form-control form-control-sm scheduleSalesPaymentPrice" name="scheduleSalesPaymentPrice" value="'+(e.price||"")+'" data-old-value="'+(e.price||"")+'" placeholder="금액을 숫자로 입력하세요.">'),o&&!Number.isInteger(e.priceCard)||(n+='<input type="radio" class="scheduleSalesPayment" name="scheduleSalesPayment'+a+'" value="CARD" data-price="'+e.priceCard+'" data-index="'+a+'" id="scheduleSalesPaymentCard'+a+'"'+("CARD"!==e.type&&e.type?"":' checked="checked"')+'><label for="scheduleSalesPaymentCard'+a+'"></label><label for="scheduleSalesPaymentCard'+a+'" style="margin-right:30px">카드'+(e.priceCard?' <span class="montserrat">'+(e.priceCard+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</span> 원":"")+"</label>"),o&&!Number.isInteger(e.priceCard)||(n+='<input type="radio" class="scheduleSalesPayment" name="scheduleSalesPayment'+a+'" value="CASH" data-price="'+e.priceCash+'" data-index="'+a+'" id="scheduleSalesPaymentCash'+a+'"'+("CASH"===e.type||o&&!Number.isInteger(e.priceCard)?' checked="checked"':"")+'><label for="scheduleSalesPaymentCash'+a+'"></label><label for="scheduleSalesPaymentCash'+a+'" style="margin-right:30px">현금'+(e.priceCash?' <span class="montserrat">'+(e.priceCash+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</span> 원":"")+"</label>"),(o&&Number.isInteger(e.priceMembership)||!o&&i)&&(n+='<input type="radio" class="scheduleSalesPayment" name="scheduleSalesPayment'+a+'" value="MEMBERSHIP" data-price="'+e.priceMembership+'" data-index="'+a+'" id="scheduleSalesPaymentMembership'+a+'"'+(!i||t[0].balanceMembership<e.priceMembership?' disabled="disabled"':"")+'><label for="scheduleSalesPaymentMembership'+a+'"'+("MEMBERSHIP"===e.type||o&&!Number.isInteger(e.priceMembership)?' checked="checked"':"")+'></label><label for="scheduleSalesPaymentMembership'+a+'">멤버십'+(e.priceMembership?' <span class="montserrat">'+(e.priceMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</span> 원":"")+"</label>"),n+="</div>"}),n+='<div class="scheduleSalesSummary">',i&&(n+='<div id="scheduleSalesBalanceMembership" class="scheduleSalesSummaryItem" data-index="0" data-balance-membership="'+t[0].balanceMembership+'">멤버십 잔액<span class="ml-auto montserrat">'+(t[0].balanceMembership+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+" </span> 원</div>");var l=0,s=0;t.forEach(function(e,a){n+='<div class="scheduleSalesSummaryItem" data-index="'+a+'">'+e.item+'<span class="ml-auto montserrat'+("MEMBERSHIP"===e.type?" membershipSummary":"")+'"><span class="scheduleSalesSummaryMembershipSign">- </span><span class="scheduleSalesSummaryPrice">'+("CARD"!==e.type&&e.type?"CASH"===e.type?((e.price||e.priceCash||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):((e.price||e.priceMembership||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):((e.price||e.priceCard||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))+" </span></span> 원</div>","MEMBERSHIP"===e.type?(l+=Number.isInteger(e.price||e.priceMembership)?e.price||e.priceMembership:0,s+=Number.isInteger(e.price||e.priceMembership)?e.price||e.priceMembership:0):"CASH"===e.type?s+=Number.isInteger(e.price||e.priceCash)?e.price||e.priceCash:0:s+=Number.isInteger(e.price||e.priceCard)?e.price||e.priceCard:0}),n+='<hr/><div id="scheduleSalesPriceTotal" class="scheduleSalesSummaryItem" data-price-total="'+s+'">총 결제금액<span class="ml-auto montserrat">'+(s+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</span> 원</div>",i&&(n+='<div id="scheduleSalesRemainingMembership" class="scheduleSalesSummaryItem" data-remaining-balance="'+(t[0].balanceMembership-l)+'">차감 후 멤버십 잔액<span class="ml-auto montserrat">'+(t[0].balanceMembership-l+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+"</span> 원</div>"),n=u(n+="</div>").on("change",".scheduleSalesPayment",function(e){var a,t,n=1*u("#scheduleSalesRemainingMembership").data("remaining-balance"),o=!0===u(this).parent().data("is-registered");"MEMBERSHIP"===u(this).val()?(a=o?1*u(this).data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val(),n<a&&(alert("멤버십 잔액이 부족합니다."),u("#salesBtn").addClass("disabled"),u("#scheduleSalesRemainingMembership span").addClass("text-accent")),n-=a,u("#scheduleSalesRemainingMembership").data("remaining-balance",n).find("span").text((n+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),t=o?1*u(this).siblings('[value="'+u(this).parent().data("type")+'"]').data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val(),u("#salesTab .scheduleSalesPayment[value='MEMBERSHIP']").each(function(e,a){u(a).prop("disabled",1*u(a).data("price")>n)}),u(".scheduleSalesSummaryItem[data-index='"+u(this).parent().data("index")+"']").addClass("membershipSummary")):"MEMBERSHIP"===u(this).parent().data("type")?(t=o?1*u(this).siblings('[value="MEMBERSHIP"]').data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val(),n<0&&0<n+t&&(u("#salesBtn").removeClass("disabled"),u("#scheduleSalesRemainingMembership span").removeClass("text-accent")),n+=t,u("#scheduleSalesRemainingMembership").data("remaining-balance",n).find("span").text((n+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),a=o?1*u(this).data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val(),u("#salesTab .scheduleSalesPayment[value='MEMBERSHIP']").each(function(e,a){u(a).prop("disabled",1*u(a).data("price")>n)}),u(".scheduleSalesSummaryItem[data-index='"+u(this).parent().data("index")+"']").removeClass("membershipSummary")):(t=o?1*u(this).siblings('[value="'+u(this).parent().data("type")+'"]').data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val(),a=o?1*u(this).data("price"):1*u(this).siblings(".scheduleSalesPaymentPrice").val()),u("#scheduleSalesPriceTotal").data("price-total",1*u("#scheduleSalesPriceTotal").data("price-total")-t+a).find("span").text((u("#scheduleSalesPriceTotal").data("price-total")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),u(".scheduleSalesSummaryItem[data-index='"+u(this).parent().data("index")+"'] .scheduleSalesSummaryPrice").text((a+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),u(this).parent().data("type",u(this).val())}).on("keyup",".scheduleSalesPaymentPrice",debounce(function(e){var a=1*u(this).data("old-value"),t=u(this).val().replace(/[^\d]/g,"");if(u(this).val(t),a!==(t*=1)){if(u(this).data("old-value",t),"MEMBERSHIP"===u(this).parent().data("type")){var n=1*u("#scheduleSalesRemainingMembership").data("remaining-balance");n+a-t<0?(alert("멤버십 잔액이 부족합니다."),u("#salesBtn").addClass("disabled"),u("#scheduleSalesRemainingMembership span").addClass("text-accent")):(u("#salesBtn").removeClass("disabled"),u("#scheduleSalesRemainingMembership span").removeClass("text-accent")),n=n+a-t,u("#scheduleSalesRemainingMembership").data("remaining-balance",n).find("span").text((n+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))}u(".scheduleSalesSummaryItem[data-index='"+u(this).parent().data("index")+"'] .scheduleSalesSummaryPrice").text((t+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),u("#scheduleSalesPriceTotal").data("price-total",1*u("#scheduleSalesPriceTotal").data("price-total")-a+t).find("span").text((u("#scheduleSalesPriceTotal").data("price-total")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"))}},300))}else n+='<div style="height:300px;align-items:center;width:100%;display:flex;justify-content:center;font-size:15px">예약 내용(메뉴)을 입력하면 매출내역을 기록할 수 있어요!</div>';return n}(e.data)),Array.isArray(e.data)&&0<e.data.length?u("#salesBtn").show().prev().addClass("mr-1"):u("#salesBtn").hide().prev().removeClass("mr-1"),u("#salesBtn").removeClass("disabled"),u("#salesLoading").hide(),u("#salesForm").show()})),NMNS.socket.on("save sales",socketResponse("매출 내역 저장",function(e){showSnackBar("매출 내역을 저장하였습니다."),u("#salesTab").is(":visible")&&u("#scheduleModal").modal("hide")})).on("link sns",socketResponse("SNS 계정 연결",function(e){"NAVER"===e.data.snsType&&(NMNS.info.naver=e.data.snsLinkId,u("#naverBtn").is(":visible")&&u("#naverBtn").addClass("connected"),alert("연동이 완료되었습니다. 앞으로 네이버 계정으로 로그인하실 수 있습니다.")),"KAKAO"===e.data.snsType&&(NMNS.info.kakao=e.data.snsLinkId,u("#kakaoBtn").is(":visible")&&u("#kakaoBtn").addClass("connected"),alert("연동이 완료되었습니다. 앞으로 카카오 계정으로 로그인하실 수 있습니다."))},function(e){"KAKAO"===e.data.snsType&&alert("카카오톡과의 연동을 하지 못했습니다. 카카오톡에서 연동을 해제한 뒤 다시 시도해주세요.")},!0)),u(".modal").on("shown.bs.modal",function(){u(".modal-backdrop").one("touch click",function(e){u(".modal.show").modal("hide")})}),u("#infoModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;var e=!1;if(u("#infoBizBeginTime").val()!==NMNS.info.bizBeginTime&&(e=!0),e||u("#infoBizEndTime").val()===NMNS.info.bizEndTime||(e=!0),e||u("#infoShopName").val()===(NMNS.info.shopName||"")||(e=!0),e||u("#infoBizType").val()===(NMNS.info.bizType||"")||(e=!0),e||u("#infoLogo").data("done")||!(NMNS.info.logo&&u("#infoLogo").data("deleted")||document.getElementById("infoLogo").files[0])||(e=!0),e&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))return!1;u("#infoLogo").data("done",!1).data("deleted",null)}).one("show.bs.modal",function(){u("#infoBtn").off("touch click").on("touch click",k),u("#addLogo").on("touch click",function(e){"삭제"===u(this).text()?(u(this).text("첨부").prev().val(""),u("#infoLogo").data("deleted",!0),document.getElementById("infoLogo").value="",/safari/i.test(navigator.userAgent)||(document.getElementById("infoLogo").type="",document.getElementById("infoLogo").type="file")):(e.preventDefault(),u("#infoLogo").trigger("click"))}).prev().on("touch click",function(e){e.preventDefault(),u("#infoLogo").trigger("click")}),u("#infoLogo").on("change",function(e){var a=this.files[0];if(u(this).data("deleted",a),a){var t=document.createElement("img");t.onload=function(){t.naturalWidth<=130&&t.naturalHeight<=130?(u("#addLogo").text("삭제").prev().val(a.name),u("#infoLogo").data("deleted",!1)):(alert("이미지의 크기가 130 X 130보다 큽니다.\n작은 이미지로 올려주세요."),document.getElementById("infoLogo").value="",/safari/i.test(navigator.userAgent)||(document.getElementById("infoLogo").type="",document.getElementById("infoLogo").type="file"),u("#addLogo").text("첨부").prev().val("")),t.remove()},t.setAttribute("src",(window.URL||window.webkitURL).createObjectURL(a))}else u("#addLogo").text("첨부")})}).on("show.bs.modal",function(){u("#infoEmail").text(NMNS.email),u("#infoAuthStatus").html("BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus?u(h(NMNS.info.authStatus)).on("touch click",function(){NMNS.socket.emit("send verification",{}),showSnackBar("<span>인증메일을 보냈습니다. 도착한 이메일을 확인해주세요!</span>")}):h(NMNS.info.authStatus)),u("#infoShopName").val(NMNS.info.shopName),u("#infoBizType").val(NMNS.info.bizType),u("#infoBizBeginTime").val(NMNS.info.bizBeginTime),u("#infoBizEndTime").val(NMNS.info.bizEndTime),"삭제"===u("#addLogo").text()&&u("#addLogo").trigger("click"),NMNS.info.logo&&u("#addLogo").text("삭제").prev().val(NMNS.info.logoFileName),u("#infoLogo").data("done",null).data("deleted",null)}),u("#alrimModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;if(u("#alrimShopName").is(":visible")){var e=!1;if((u("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!u("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(e=!0),e||u("#alrimShopName").val()===(NMNS.info.shopName||"")||(e=!0),e||u("#alrimCallbackPhone").val().replace(/-/gi,"")===(NMNS.info.alrimTalkInfo.callbackPhone||"")||(e=!0),e||u("#alrimCancelDue").val()===(NMNS.info.alrimTalkInfo.cancelDue||"")||(e=!0),e||u("#alrimNotice").val()===(NMNS.info.alrimTalkInfo.notice||"")||(e=!0),e&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))return!1}}).on("shown.bs.modal",function(){u("body .popover").length&&u("body .popover").popover("update")}).one("show.bs.modal",function(){u("#labelAlrimUseYn").on("touch click",function(){u(this).next().children("label").trigger("click")}),u("#alrimNotice").off("keyup keydown paste cut change").on("keyup keydown paste cut change",function(){u("#noticeByteCount").text(u(this).val().length)}).on("blur",function(){u(this).val(removeNonCharacter(u(this).val()))}),u("#alrimUseYn").off("change").on("change",function(){u(this).prop("checked")?u("#alrimScreen").hide():u("#alrimScreen").show()}),u("#alrimInfoBtn").off("touch click").on("touch click",v),u("#alrimHistorySearch").off("touch click").on("touch click",function(){var e={};""!==u("#alrimHistoryTarget").val()&&(e.target=u("#alrimHistoryTarget").val()),u("#alrimHistoryList .row").remove(),NMNS.socket.emit("get alrim history",e)}),u("#alrimHistoryTarget").off("keyup").on("keyup",function(e){13===e.which&&u("#alrimHistorySearch").trigger("click")})}).on("show.bs.modal",function(){u("#alrimTabList a[data-target='#alrimTab']").tab("show")}).on("hidden.bs.modal",function(){M()}),u("#noShowModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1}).on("show.bs.modal",function(e){u(e.relatedTarget).hasClass("getNoShowLink")?u("#noShowTabList .nav-link[href='#noShowSearch']").tab("show"):u(e.relatedTarget).hasClass("addNoShowLink")&&u("#noShowTabList .nav-link[href='#noShowAdd']").tab("show")}).on("shown.bs.modal",function(){u("#noShowAddContact").focus()}),u("#scheduleModal").on("hide.bs.modal",function(){NMNS.scheduleTarget&&NMNS.scheduleTarget.guide&&NMNS.scheduleTarget.guide.clearGuideElement(),delete NMNS.scheduleTarget}).on("hidden.bs.modal",function(){u("#scheduleName").val(""),u("#scheduleTabContents").html(w("")).find("button").off("touch click").on("touch click",function(){D(this)}),u("#scheduleContact").val("")}).on("shown.bs.modal",function(){u("#scheduleTab").is(":visible")&&""===u("#scheduleName").val()&&u("#scheduleName").focus()}),u("#lnbLastMenu a").on("touch click",function(e){e.preventDefault()}),u("#showTutorial").on("touch click",function(){if(document.getElementById("tutorialScript"))u("#tutorialModal").modal();else{var e=document.createElement("script");e.src="/nmns/js/tutorial.min.js",e.id="tutorialScript",document.body.appendChild(e),e.onload=function(){u("#tutorialModal").modal()}}}),u(".announcementMenuLink").on("show.bs.popover",function(){NMNS.announcementPage||(NMNS.announcementPage=1,NMNS.socket.emit("get announcement",{page:1})),u(document.body).addClass("modal-open").append(u('<div class="modal-backdrop fade show"></div>').on("touch click",function(e){e.preventDefault(),e.stopPropagation(),u(this).remove(),u(document.body).removeClass("modal-open"),u(".popover.show").popover("hide")}))}).on("shown.bs.popover",function(){u("#notificationBody").parents(".popover").find(".close-button").on("touch click",function(){u(this).parents(".popover").popover("hide"),u(document.body).removeClass("modal-open"),u(".modal-backdrop.show").remove()}),u("#notificationBody, #announcementArea").off("scroll").on("scroll",debounce(function(){var e=Math.max(0,u(this)[0].scrollHeight-u(this).scrollTop()-u(this).innerHeight());NMNS.expectMoreAnnouncement&&e<Math.max(100,.2*u(this).innerHeight())&&NMNS.socket.emit("get announcement",{page:++NMNS.announcementPage})},100))}),u("#mainMenu").on("shown.bs.popover",function(){u(".mainMenuRow a[data-link]").off("touch click").on("touch click",function(e){u("#mainMenu").popover("hide"),u(u(this).data("link")).modal("show")}),u("#signoutLink").on("touch click",function(){NMNS.socket.close()})}),u("html").on("click",function(e){0<u("body").children(".popover.show").length&&void 0===u(e.target).data("original-title")&&!u(e.target).parents().is(".popover.show")&&0===u(e.target).parents('[data-toggle="popover"]').length&&u("body").children(".popover.show").popover("hide")}),u("#alrimTabList a[data-target='#alrimTab']").on("show.bs.tab",M),u("#alrimTabList a[data-target='#alrimHistoryTab']").on("show.bs.tab",function(){u("#alrimHistorySearch").trigger("click")}),u("#scheduleTabList a[data-target='#scheduleTab']").on("touch click",function(){u(this).next().hasClass("active")&&T("switch")}).on("shown.bs.tab",function(){""===u("#scheduleName").val()&&u("#scheduleName").focus()}),u("#scheduleTabList a[data-target='#taskTab']").on("touch click",function(){u(this).hasClass("active")||Y("switch")}).on("shown.bs.tab",function(){""===u("#taskName").val()&&u("#taskName").focus()}),u("#scheduleTabList a[data-target='#salesTab']").one("show.bs.tab",function(){u("#salesBtn").on("touch click",function(e){if(e.preventDefault(),u(this).hasClass("disabled"))alert("입력한 금액을 확인해주세요.");else{var o,i=[];u("#salesTab .scheduleSalesPayments").each(function(e,a){var t={},n=u(a);t.email=NMNS.email,t.id=n.data("id"),t.customerId=n.data("customer-id"),t.managerId=n.data("manager-id"),t.scheduleId=u("#salesForm").data("schedule-id"),t.type=n.data("type"),t.item=n.data("item"),t.price=n.data("is-registered")?n.find(".scheduleSalesPayment:checked").data("price"):n.find(".scheduleSalesPaymentPrice").val(),n.data("is-registered")||""!==t.price?t.price*=1:o=e,Number.isInteger(t.price)||(o=e),i.push(t)}),0<=o?alert(o+1+"번째 매출("+i[o].item+")의 매출액을 입력해주세요."):(NMNS.socket.emit("save sales",i),delete NMNS.salesList)}})}).on("show.bs.tab",function(){return!(!NMNS.scheduleTarget||!NMNS.scheduleTarget.schedule)&&(u("#salesLoading").show(),u("#salesForm").hide().data("schedule-id",NMNS.scheduleTarget.schedule.id),u("#salesBtn").addClass("disabled"),NMNS.socket.emit("get reserv sales",{scheduleId:NMNS.scheduleTarget.schedule.id}),!0)}),u("#addScheduleBtn").on("touch click",function(){NMNS.calendar&&NMNS.info.bizEndTime&&(T(),u("#scheduleTabList a[data-target='#scheduleTab']").text("예약 추가").tab("show"),u("#scheduleTabList a[data-target='#taskTab']").text("일정 추가"),u("#taskBtn").text("일정 추가 완료"),u("#deleteTaskBtn").hide().next().removeClass("ml-1"),u("#scheduleBtn").text("예약 추가 완료"),u("#scheduleModal").removeClass("update").modal("show"))}),u("#userModal").one("show.bs.modal",function(){u("#resetPasswordBtn").on("touch click",function(){0!==u("#currentPassword").val().length?0!==u("#newPassword").val().length?0!==u("#renewPassword").val().length?u("#newPassword").val()===u("#renewPassword").val()?(NMNS.socket.emit("update password",{currentPassword:u("#currentPassword").val(),newPassword:u("#newPassword").val()}),u("#currentPassword").val(""),u("#newPassword").val(""),u("#renewPassword").val(""),u("#userModal").modal("hide")):showSnackBar("새 비밀번호가 일치하지 않습니다."):showSnackBar("새 비밀번호를 한 번 더 입력해주세요."):showSnackBar("새 비밀번호를 입력해주세요."):showSnackBar("현재 비밀번호를 입력해주세요.")}),u("#naverBtn").on("touch click",function(e){if(u(this).hasClass("connected"))return e.stopImmediatePropagation(),!1;e.preventDefault()})}).on("show.bs.modal",function(){if(NMNS.info.kakaotalk&&u("#kakaoBtn").addClass("connected").find("span").text("카카오 계정 연동 완료"),NMNS.info.naver&&u("#naverBtn").addClass("connected").find("span").text("네이버 계정 연동 완료"),!u("#naverBtn").hasClass("connected")&&!document.getElementById("naverScript")){var e=document.createElement("script");e.src="/nmns/js/naver.min.js",e.id="naverScript",document.body.appendChild(e),e.onload=function(){new naver.LoginWithNaverId({clientId:"5dHto9KiEXdHoHJBDcqE",callbackUrl:window.location.origin+"/naver",isPopup:!0,loginButton:{color:"green",type:1,height:20}}).init()}}if(!u("#kakaoBtn").hasClass("connected")&&!document.getElementById("kakaoScript")){var a=document.createElement("script");a.src="/nmns/js/kakao.min.js",a.id="kakaoScript",document.body.appendChild(a),a.onload=function(){Kakao.init("0bc4ec615d313261ebfd5ac0fe9c055f"),u("#kakaoBtn").on("touch click",function(){u(this).hasClass("connected")||Kakao.Auth.login({success:function(e){Kakao.API.request({url:"/v2/user/me",success:function(e){e.kakao_account.email?NMNS.socket.emit("link sns",{snsLinkId:e.id,snsEmail:e.kakao_account.email,snsType:"KAKAO"}):(alert("이메일 주소는 연동 및 로그인에 필수로 필요합니다. 카카오톡>설정>프라이버시>카카오 계정>연결 서비스 관리 메뉴에서 연결을 해제 후 다시 시도해주세요."),Kakao.Auth.logout())},fail:function(e){alert("카카오 서버와 연결하지 못했습니다. 다시 시도해주세요.")}})},fail:function(e){alert("연결이 취소되었습니다."),console.log(JSON.stringify(e))}})})}}}).on("hidden.bs.modal",function(){u("#currentPassword").val(""),u("#newPassword").val(""),u("#renewPassword").val("")}),swipedetect(document.getElementById("mainCalendar"),function(e){"left"===e?u("#renderRange").next().trigger("click"):"right"===e&&u("#renderRange").prev().trigger("click")}),u(".addManager").on("touch click",function(e){if(e.preventDefault(),u("#mainAside").hasClass("sidebar-toggled")&&(u("#mainAside").removeClass("sidebar-toggled"),setTimeout(function(){document.getElementById("sidebarContainer").scrollTop=0,u("#mainAside").addClass("show-collapsed")},300)),u("#lnbManagerForm").data("id")&&u("#lnbManagerList .lnbManagerItem[data-value='"+u("#lnbManagerForm").data("id")+"']").show(),!u("#lnbManagerForm").is(":visible")){var a=u("#lnbManagerColor label:nth-child("+Math.floor(Math.random()*u("#lnbManagerColor label").length)+") input").prop("checked",!0).val();return u("#lnbManagerFormColor").css("border-color",a).css("background-color",a).data("value",a),u("#lnbManagerForm").data("id",null).show(),void u("#lnbManagerFormName").val("").focus()}u("#lnbManagerForm").data("id",null).hide()}).one("touch click",B),u(".mfb-component__button--child").off("touch click").on("touch click",function(e){e.preventDefault(),document.getElementById("floatingButton").setAttribute("data-mfb-state","closed")}),NMNS.socket.emit("get noti"),NMNS.socket.on("get noti",socketResponse("서버 메시지 받기",function(e){e.data.data.forEach(function(e){showNotification(e)})})),u(".customerMenuLink").off("touch click").on("touch click",function(){var e=u(u(".customerSortType.active")[0]).data("action");if(!document.getElementById("customerStyle")){var a=document.createElement("link");a.rel="stylesheet",a.href="/nmns/css/customer.min.css",a.id="customerStyle",document.head.appendChild(a)}if(document.getElementById("customerScript"))NMNS.customerList&&NMNS.customerList!==[]||NMNS.socket.emit("get customer list",{type:"all",target:""===u("#customerSearchTarget").val()?void 0:u("#customerSearchTarget").val(),sort:e});else{var t=document.createElement("script");t.src="/nmns/js/customer.min.js",t.id="customerScript",document.body.appendChild(t),t.onload=function(){NMNS.socket.emit("get customer list",{type:"all",target:""===u("#customerSearchTarget").val()?void 0:u("#customerSearchTarget").val(),sort:e}),u("#customerManagerList").html(y()).off("touch click","button").on("touch click","button",function(){u("#customerManager").data("calendar-id",u(this).data("calendar-id")).data("color",u(this).data("color")).html(u(this).html())})}}u("#customerAddManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(y()).off("touch click","button").on("touch click","button",function(){u("#customerAddManager").data("calendar-id",u(this).data("calendar-id")).data("bgcolor",u(this).data("bgcolor")).html(u(this).html())}),u("#customerAddManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+NMNS.calendar.getCalendars()[0].bgColor+"'></span><span class='tui-full-calendar-content'>"+NMNS.calendar.getCalendars()[0].name+"</span>").data("calendar-id",NMNS.calendar.getCalendars()[0].id).data("bgcolor",NMNS.calendar.getCalendars()[0].bgColor),u("#customerManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(y()).off("touch click","button").on("touch click","button",function(){u("#customerManager").data("calendar-id",u(this).data("calendar-id")).data("bgcolor",u(this).data("bgcolor")).html(u(this).html())})}),u(".menuMenuLink").one("touch click",function(){if(!document.getElementById("menuStyle")){var e=document.createElement("link");e.rel="stylesheet",e.href="/nmns/css/menu.min.css",e.id="menuStyle",document.head.appendChild(e)}if(!document.getElementById("menuScript")){var a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js",a.id="menuScript",document.body.appendChild(a),a.onload=function(){var e=document.createElement("script");e.src="/nmns/js/menu.min.js",document.body.appendChild(e),NMNS.socket.emit("get menu list",null)}}u(this).on("touch click",function(){u("#mainMenuTools .updatingMenu-collapsed").removeClass("d-inline-flex"),u(".updatingMenu-collapsed").hide(),u(".updatingMenu-expanded").show(),u("#updateMenuLink").text("수정"),NMNS.socket.emit("get menu list",null)})}),u(".salesMenuLink").on("touch click",function(){if(!document.getElementById("salesStyle")){var e=document.createElement("link");e.rel="stylesheet",e.href="/nmns/css/sales.min.css",e.id="salesStyle",document.head.appendChild(e)}if(document.getElementById("salesScript"))NMNS.salesList&&NMNS.salesList!==[]?u("#salesSearchName").autocomplete()&&u("#salesSearchName").autocomplete().clearCache():(u("#salesSearchName").autocomplete()&&u("#salesSearchName").autocomplete().clearCache(),NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),name:""===u("#salesSearchName").val()?void 0:u("#salesSearchName").val(),managerId:u("#salesSearchManager").data("calendar-id")||void 0,item:""===u("#salesSearchContents").val()?void 0:u("#salesSearchContents").val()}));else{var a=document.createElement("script");a.src="/nmns/js/sales.min.js",a.id="salesScript",document.body.appendChild(a),a.onload=function(){NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),name:""===u("#salesSearchName").val()?void 0:u("#salesSearchName").val(),managerId:u("#salesSearchManager").data("calendar-id")||void 0,item:""===u("#salesSearchContents").val()?void 0:u("#salesSearchContents").val()})},u("#salesSearchName").autocomplete({serviceUrl:"get customer info",paramName:"name",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e){return(e.value||"(이름없는 고객)")+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){u("#scheduleContact").val(e.data).trigger("blur")}},NMNS.socket),flatpickr("#salesSearchStartDate",{dateFormat:"Y. m. d",defaultDate:moment().startOf("month").toDate(),locale:"ko"}),flatpickr("#salesSearchEndDate",{dateFormat:"Y. m. d",defaultDate:new Date,locale:"ko"});var t=moment();u("#mainSalesSearch .activable").each(function(e,a){a.innerText=t.format("M월"),t.add(-1,"month")}),u("#salesSearchManagerList").html(y(!0)).off("touch click","button").on("touch click","button",function(){u("#salesSearchManager").data("calendar-id",u(this).data("calendar-id")).data("color",u(this).data("color")).html(u(this).html())})}}),function(){if(u(".moveDate").on("touch click",i),u(".calendarType").on("touch click",n),u("#calendarTypeMenu").next().children("a").on("touch click",function(e){e.preventDefault();var a=u(e.target);a.hasClass("dropdown-item")||(a=a.parents(".dropdown-item")),u("#calendarTypeMenu").html(a.html()),u("#calendarTypeMenu").attr("data-action",a.data("action")),u("#calendarTypeMenu").trigger("click")}),u("#lnbManagerList").on("change",d),u(".addNoShowLink").one("touch click",b),window.addEventListener("resize",debounce(function(){NMNS.calendar.render()},200)),flatpickr.localize("ko"),u(".taskMenu").on("touch click",l),u("#sidebarToggler").on("touch click",function(){u("#lnbManagerForm").is(":visible")&&u(".addManager").trigger("click"),u("#mainAside").hasClass("sidebar-toggled")?(u("#mainTask").hasClass("show")&&u("#mainAside").css("minWidth","270px"),setTimeout(function(){u("#mainAside").addClass("show-collapsed")},300)):u("#mainAside").css("minWidth","0px").removeClass("show-collapsed"),u("#mainAside").toggleClass("sidebar-toggled")}),u(".announcementMenuLink").popover({template:'<div id="announcementPopover" class="popover bg-transparent" role="tooltip" style="display:flex;width:831px;padding-right:91px;box-shadow:none"><div class="arrow"></div>              <div class="col px-0 d-none"><div id="announcementArea" class="col px-0 mr-2"></div></div>              <div class="col px-0">                <div id="notificationArea" class="col px-0 ml-2">                  <div class="d-flex align-items-center" style="padding:25px 30px;border-bottom:1px solid rgba(57, 53, 53, 0.2)">                    <span style="font-size:18px;font-weight:bold">알림</span><span class="close-button ml-auto cursor-pointer"><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13"><g id="x" transform="translate(0.5 0.5)"><path id="Path" d="M12,0,0,12" fill="none" stroke="#393535" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" fill-rule="evenodd"/><path id="Path-2" data-name="Path" d="M0,0,12,12" fill="none" stroke="#393535" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" fill-rule="evenodd"/></g></svg></span></div>                  <div id="notificationBody"><div class="flex-column m-auto text-center py-5"><div class="bouncingLoader"><div></div><div></div><div></div></div><span>새로운 알림을 불러오는 중입니다...</span></div></div>                  <div id="notificationEmpty"><div class="text-center">아직 알림 내역이 없어요.<br>예약 등록 내역, 예약 취소 내역이 보여집니다.</div></div>                </div>              </div>            </div>',html:!0,sanitize:!1,placement:"auto"}),u("#mainMenu").popover({template:'<div class="popover" role="tooltip"><div class="arrow"></div><div><ul style="padding: 25px 30px;margin:0"><li class="mainMenuRow"><a class="d-block" data-link="#infoModal" data-toggle="modal" href="#" aria-label="내 매장 정보">내 매장 정보</a></li><li class="mainMenuRow"><a class="d-block" data-link="#alrimModal" data-toggle="modal" href="#" aria-label="알림톡 정보">알림톡 정보</a></li><li class="mainMenuRow"><a class="d-block" data-link="#userModal" data-toggle="modal" href="#" aria-label="내 계정 정보">내 계정 정보</a></li><li class="mainMenuRow"><a id="signoutLink" class="d-block" href="/signout" aria-label="로그아웃">로그아웃</a></li></ul></div></div>',html:!0,sanitize:!1,placement:"bottom"}),u("#searchNoShow").on("keyup",function(e){13!==e.keyCode&&13!==e.which||(11===u(this).val().replace(/-/gi,"").length||10===u(this).val().replace(/-/gi,"").length?(H.apply(this,e),NMNS.socket.emit("get noshow",{contact:u(this).val().replace(/-/gi,""),mine:!1})):showSnackBar("전화번호를 정확히 입력해주세요."))}),u(".calendarMenuLink").off("touch click").on("touch click",m),u("#searchNoShow").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,noCache:!0,transformResult:function(e,a){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,a){return dashContact(e.value)+" ("+(e.data||"(이름없는 고객)")+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&!document.getElementById("datalistPolyfillScript")){var e=document.createElement("script");e.src="/lib/datalist-polyfill/datalist-polyfill.min.js",e.id="datalistPolyfillScript",document.body.appendChild(e)}u(".infoCenterLink").one("touch click",function(){if(0===u("#faq").children().length){u("#submitFeedback").on("touch click",function(){var e=u("#feedbackBody").val();e&&0<e.trim().length?(NMNS.socket.emit("submit feedback",{data:e.trim()}),showSnackBar("제안/문의해주신 내용이 잘 전달되었습니다.<br/> 소중한 의견에 감사드립니다."),u("#feedbackBody").val("")):showSnackBar("제안/문의하실 내용을 입력해주세요.")});var t="";[{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 데스크탑으로 접속하시면 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"모바일에서는 예약 추가가 안되나요?",contents:"모바일 버전에서는 노쇼, 예약, 일정, 고객, 메뉴 추가 기능을 뺀 모든 서비스를 이용할 수 있어요.<br>추가 기능은 PC에서 이용할 수 있답니다!"},{title:"고객을 추가로 등록하고 싶어요.",contents:"고객 추가는 고객관리 메뉴에서 하실 수 있습니다!"},{title:"고객을 엑셀로 등록하고 싶어요.",contents:"엑셀등록 기능을 열심히 만들고 있는 중입니다. 조금만 기다려주세요!"},{title:"노쇼로 등록한 전화번호는 개인정보가 아닌가요?",contents:"노쇼에 등록된 전화번호는 복호화가 불가능한 암호화 형태로 저장되어 관리자도 내용을 확인할 수 없습니다. 안심하세요!"},{title:"예약과 일정은 무엇이 다른가요?",contents:"예약은 예약하는 고객이 있어서 시간표에 직접 등록되고, 일정은 매장의 운영에 필요한 일정을 등록하는데 사용됩니다.<br>예를들어, 매장 대청소 등을 일정으로 관리하면 편리하게 이용하실 수 있겠죠?"}].forEach(function(e,a){t+='<div class="row faqRow col mx-0" title="'+e.title+'"><a href="#faqDetail'+a+'" class="faqDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="faqDetail'+a+'"></a><div class="ellipsis">'+e.title+'</div></div><div class="row faqDetailRow collapse mx-0" id="faqDetail'+a+'"><div class="d-inline-flex pb-3"><span>ㄴ</span></div><span class="col px-2 pb-3">'+e.contents+"</span></div></div>",0<a&&a%50==0&&(u("#faq").append(t),t="")}),u("#faq").append(t)}}),u(".menuLink").on("touch click",H),u("#sidebarContainer").data("scroll",new PerfectScrollbar("#sidebarContainer")),Inputmask("999-999[9]-9999",{showMaskOnFocus:!1,showMaskOnHover:!1,autoUnmask:!0,placeholder:""}).mask(".inputmask-mobile")}(),window.onpopstate=function(e){var a;a=e.state?e.state.link:"calendarMenu";var t=u(".menuLink[data-link='"+a+"']");t.length?H.call(t[0],null,!0):"noShowSearchMenu"===e.state.link&&H.call(document.getElementById("searchNoShow"),null,!0)}}(jQuery);