!function(m){if(document.documentMode){var e,t=navigator.userAgent.toLowerCase();if("Microsoft Internet Explorer"==navigator.appName?e="msie ":-1<t.search("trident")?e="trident/.*rv:":-1<t.search("edge/")&&(e="edge/"),null!==new RegExp(e+"([0-9]{1,})(\\.{0,}[0-9]{0,1})").exec(t)&&parseFloat(RegExp.$1+RegExp.$2)<10&&!confirm("오래된 IE"+parseFloat(RegExp.$1+RegExp.$2)+" 브라우저를 사용하고 계십니다.\n 계속하시면 페이지가 정확히 표시되지 않을 수 있습니다. 그래도 계속하시겠습니까?\n *WA:SHOW는 IE10 이상의 브라우저를 지원하고,\nChrome 브라우저에 최적화되어있습니다."))return location.href="/signout"}function a(e,t){var a="task"===e.category?"일정":"예약",n="";if("week"===NMNS.calendar.getViewName())n+="<div class='tui-full-calendar-schedule-cover font-weight-bold row mx-auto align-items-center'><div class='col-11 px-0'>",t||(n+="<div class='row' style='margin-bottom:10px'><div class='montserrat col' style='font-weight:500'>"+moment(e.start.toDate()).format("HH:mm")+" - "+moment(e.end.toDate()).format("HH:mm")+"</div></div>"),e.title&&(n+="<div class='row'><div class='col' title='"+a+"이름:"+e.title+"'>","task"===e.category?n+="<span>#</span>":t&&(n+="<span class='far fa-clock'></span> "),n+=e.title+"</div></div>"),n+="</div></div>";else if("day"===NMNS.calendar.getViewName()){switch(n+="<div class='tui-full-calendar-schedule-cover flex-column d-flex' style='padding:20px'><div class='row align-items-center' style='margin-bottom:5px'><div class='col d-flex'>",e.raw.contents&&(n+="<div title='"+a+"내용:"+e.raw.contents+" class='tui-full-calendar-time-schedule-title'>"+e.raw.contents+"</div>"),e.raw.status){case"CANCELED":n+="<span title='상태/"+a+"내용'><span class='badge badge-light'>취소</span>";break;case"NOSHOW":n+="<span title='상태/"+a+"내용'><span class='badge badge-danger'>노쇼</span>";break;case"CUSTOMERCANCELED":n+="<span title='상태/"+a+"내용'><span class='badge badge-light'>고객취소</span>"}n+="<div class='montserrat ml-auto' style='font-weight:500'>"+moment(e.start.toDate()).format("HH:mm")+" - "+moment(e.end.toDate()).format("HH:mm")+"</div></div></div><div>"+(e.raw.etc||"")+"</div><div class='mt-auto tui-full-calendar-time-schedule-contact'>"+(e.title?"<span title='이름:"+e.title+"' class='mr-1'>"+e.title+"</span>":"")+(e.raw.contact?"<span title='연락처:"+dashContact(e.raw.contact,".")+"'>"+dashContact(e.raw.contact,".")+"</span>":"")+"</div></div>"}else n+="예약 "+e.count+"건</div>";return n}function n(e){var t=e.target.getAttribute("data-action");t||(t=e.target.parentElement.getAttribute("data-action"));var a="";switch(t){case"toggle-daily":a="day",m("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-weekly":a="week",m("#mainCalendar").css("height",NMNS.calendarHeight+"rem");break;case"toggle-monthly":a="month",m("#mainCalendar").css("height","598px")}NMNS.calendar.changeView(a,!0),u(),h(),f()}function o(e){var t=e.target.getAttribute("data-action");switch(t||(t=e.target.parentElement.getAttribute("data-action")),t){case"prev":NMNS.calendar.prev();break;case"next":NMNS.calendar.next();break;default:return}h(),f()}function i(e){m(window).width()<1600&&(m("#mainTask").hasClass("show")?(m("#mainCalendarArea").css("minWidth",""),m("#mainContents").css("minWidth","100%"),m("#mainAside").css("minWidth","unset")):(m("#mainCalendarArea").css("minWidth",m("#mainCalendarArea").width()),m("#mainContents").css("minWidth",""),m("#mainAside").hasClass("sidebar-toggled")?m("#mainAside").css("minWidth","unset"):m("#mainAside").css("minWidth","270px"))),m("#mainTask").toggleClass("show")}function l(e){e.preventDefault();var t,a,n;m(e.target).closest('a[role="menuitem"]')[0].getAttribute("data-action");t=document.getElementById("calendarName"),a=NMNS.manager,(n=[]).push('<span class="calendar-bar" style="background-color: '+a.bgColor+"; border-color:"+a.borderColor+';"></span>'),n.push('<span class="calendar-name">'+a.name+"</span>"),t.innerHTML=n.join("")}function c(e){e.preventDefault();var t=moment(new Date);t.hour()>=Number(NMNS.info.bizEndTime.substring(0,2))||t.hour()+1==Number(NMNS.info.bizEndTime.substring(0,2))&&t.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?t=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):t.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||t.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&t.minute()<Number(NMNS.info.bizBeginTime.substring(2))?t=moment(NMNS.info.bizBeginTime,"HHmm"):t.minute(10*Math.ceil(t.minute()/10)),NMNS.calendar.openCreationPopup({start:t.toDate(),end:t.add(30,"m").toDate()})}function s(t){return NMNS.calendar.getCalendars().find(function(e){return e.id===t})}function d(e){var t=e.target.checked,a=m(e.target).parents(".lnbManagerItem");if(!a.is(".addManagerItem")){var n=a.data("value");n&&(s(n).checked=t),r()}}function r(){var e=Array.prototype.slice.call(document.querySelectorAll("#lnbManagerList input"));NMNS.calendar.getCalendars().forEach(function(e){NMNS.calendar.toggleSchedules(e.id,!e.checked,!1)}),NMNS.calendar.render(!0),e.forEach(function(e){var t=e.nextElementSibling;t.style.backgroundColor=e.checked?t.getAttribute("data-color"):"transparent",t.style.borderColor=e.checked?t.getAttribute("data-color"):"#7f8fa4"})}function u(){switch(m(".calendarType").removeClass("active"),NMNS.calendar.getViewName()){case"day":m("#calendarTypeMenu").html(m(".calendarType[data-action='toggle-daily']").addClass("active").html());break;case"week":m("#calendarTypeMenu").html(m(".calendarType[data-action='toggle-weekly']").addClass("active").html());break;default:m("#calendarTypeMenu").html(m(".calendarType[data-action='toggle-monthly']").addClass("active").html())}}function h(){var e=document.getElementById("renderRange"),t=NMNS.calendar.getOptions(),a=NMNS.calendar.getViewName(),n="";if("day"===a){var o=moment(NMNS.calendar.getDate().getTime());n+=o.format("YYYY. MM. DD");var i=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===o.format("YYYY-MM-DD")}):void 0;n+="<span class='flex-column base-font ml-3'"+(i?"":" style='opacity:0.5'")+">"+(i?"<div class='render-range-text-holiday'>"+i.title+"</div>":"")+"<span style='font-size:22px;vertical-align:bottom'>"+["일","월","화","수","목","금","토"][moment(NMNS.calendar.getDate().getTime()).day()]+"요일</span></span>"}else"month"===a&&(!t.month.visibleWeeksCount||4<t.month.visibleWeeksCount)?n+=moment(NMNS.calendar.getDate().getTime()).format("YYYY. MM"):(n+=moment(NMNS.calendar.getDateRangeStart().getTime()).format("YYYY. MM. DD"),n+=" - ",n+=moment(NMNS.calendar.getDateRangeEnd().getTime()).format(" MM. DD"));e.innerHTML=n}function f(){var e,t;NMNS.calendar.clear(),e=NMNS.calendar.getDateRangeStart(),t=NMNS.calendar.getDateRangeEnd(),NMNS.socket.emit("get reserv",{start:toYYYYMMDD(e._date)+"0000",end:toYYYYMMDD(t._date)+"2359"})}function p(e){switch(e){case"BEFORE_EMAIL_VERIFICATION":return"<span class='badge badge-danger' title='인증메일 보내기' style='cursor:pointer;'>이메일 미인증</span><span class='btn btn-sm btn-flat btn-secondary ml-2'>인증메일 보내기</span>";case"EMAIL_VERIFICATED":return"<span class='badge badge-primary badge-pill'><span class='fa fa-check mr-1'></span>인증완료</span>"}return m("#infoAccountStatus").removeClass("pl-2"),""}function N(e){var t="";return e.forEach(function(e){t+="<div class='lnbManagerItem row mx-0' data-value='"+e.id+"'><label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'>",t+="<span title='이 담당자의 예약 가리기/보이기' data-color='"+e.color+"'></span><span class='menu-collapsed'>"+e.name+"</span></label><button class='btn btn-flat menu-collapsed lnbManagerAction ml-auto text-white py-0 pr-0' type='button'><i class='fa fa-ellipsis-v menu-collapsed'></i></button></div>"}),t}function g(e){var n="",t=moment().format("YYYYMMDD"),o=moment().add(1,"days").format("YYYYMMDD");return e.forEach(function(a){0<a.task.length&&(n+="<div class='taskDate' style='font-size:12px;opacity:0.5'><hr class='hr-text' data-content='"+(a.date===t?"오늘":a.date===o?"내일":moment(a.date,"YYYYMMDD").format("YYYY. MM. DD"))+"'></div>",a.task.forEach(function(e){var t=s(e.manager)||{};n+="<div class='row'><div class='col col-12 position-relative cursor-pointer'><span class='far fa-square task-checkbox'></span><div class='flex-column d-inline-flex task' style='margin-left:10px;max-width:calc(100% - 35px)'><div style='font-size:14px'>"+e.title+"</div><div class='montserrat' style='font-size:12px;opacity:0.5'>"+moment(e.start,"YYYYMMDDHHmm").format(moment(e.start,"YYYYMMDDHHmm").isSame(moment(a.date,"YYYYMMDD"),"day")?"HH:mm":"MM. DD HH:mm")+(e.end?" - "+moment(e.end,"YYYYMMDDHHmm").format(moment(e.end,"YYYYMMDDHHmm").isSame(moment(a.date,"YYYYMMDD"),"day")?"HH:mm":"MM. DD HH:mm"):"")+"</div></div><span class='tui-full-calendar-weekday-schedule-bullet' style='top:8px;right:15px;left:unset;background:"+t.borderColor+"' title='"+t.name+"'></span></div></div>"}))}),n}function S(e){m("#mainShopName").length?""!==e?m("#mainShopName").text(e):m("#navbarResponsive").prev().children("span").html(NMNS.email):""!==e&&m("#navbarResponsive").prev().children("span").html("<span id='mainShopName'>"+e+"</span><small class='d-none d-md-inline-block'>("+NMNS.email+")</small>")}function M(){if(700<m("#alrimNotice").val().length)return alert("알림 안내문구의 길이가 너무 깁니다. 조금만 줄여주세요 :)"),void m("#alrimNotice").focus();if(m("#alrimUseYn").prop("checked")){if(""===m("#alrimCallbackPhone").val())return alert("알림톡을 사용하시려면 반드시 휴대폰번호를 입력해주세요!"),void m("#alrimCallbackPhone").focus();if(!/^01([016789]?)([0-9]{3,4})([0-9]{4})$/.test(m("#alrimCallbackPhone").val()))return alert("입력하신 휴대폰번호가 정확하지 않은 것 같습니다.\n휴대폰번호를 정확히 입력해주세요!"),void m("#alrimCallbackPhone").focus();if(""===m("#alrimShopName").val())return alert("알림톡을 사용하시려면 고객에게 보여줄 매장 이름을 입력해주세요!"),void m("#alrimShopName").focus()}var e={},t={id:"alrimInfo"},a=!1;m("#alrimShopName").val()!==(NMNS.info.shopName||"")&&(NMNS.history.push({id:"info",shopName:NMNS.info.shopName}),e={shopName:m("#alrimShopName").val()},NMNS.info.shopName=e.shopName,NMNS.socket.emit("update info",e),S(e.shopName),e={},a=!0),(m("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!m("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(t.useYn=NMNS.info.alrimTalkInfo.useYn,e.useYn=m("#alrimUseYn").prop("checked")?"Y":"N",NMNS.info.alrimTalkInfo.useYn=e.useYn),m("#alrimCallbackPhone").val()!==(NMNS.info.alrimTalkInfo.callbackPhone||"")&&(t.callbackPhone=NMNS.info.alrimTalkInfo.callbackPhone,e.callbackPhone=m("#alrimCallbackPhone").val(),NMNS.info.alrimTalkInfo.callbackPhone=e.callbackPhone),m("#alrimCancelDue").val()!==(NMNS.info.alrimTalkInfo.cancelDue||"")&&(t.cancelDue=NMNS.info.alrimTalkInfo.cancelDue,e.cancelDue=m("#alrimCancelDue").val(),NMNS.info.alrimTalkInfo.cancelDue=e.cancelDue),m("#alrimNotice").val()!==(NMNS.info.alrimTalkInfo.notice||"")&&(t.notice=NMNS.info.alrimTalkInfo.notice,e.notice=m("#alrimNotice").val(),NMNS.info.alrimTalkInfo.notice=e.notice),Object.keys(e).length&&(NMNS.history.push(t),NMNS.socket.emit("update alrim",e)),Object.keys(e).length||a?m("#alrimModal").modal("hide"):showSnackBar("<span>변경된 내역이 없습니다.</span>")}function v(){if(m(".infoManagerItem input[type='text']").length){var e=!0;if(m(".infoManagerItem input[type='text']").each(function(){m(this).val().length||(e=!1,m(this).focus())}),e){var t=m("#infoBizBeginTime").val();if(!t)return alert("매장 운영 시작시간이 올바르지 않습니다."),void m("#infoBizBeginTime").focus();var a=m("#infoBizEndTime").val();if(!a)return alert("매장 운영 종료시간이 올바르지 않습니다."),void m("#infoBizEndTime").focus();if(t.isAfter(a,"hour")&&(t=[a,a=t][0]),""===m("#infoShopName").val()&&"Y"===NMNS.info.alrimTalkInfo.useYn)return alert("알림톡을 사용하고 계실 때는 예약고객에게 보여드릴 매장이름이 반드시 있어야 합니다.\n매장이름을 삭제하고 싶으시다면 알림톡 사용을 먼저 해제해주세요."),void m("#infoShopName").val(NMNS.info.shopName);var n={},o={id:"info"};t.format("HHmm")===NMNS.info.bizBeginTime&&a.format("HHmm")===NMNS.info.bizEndTime||(o.hourStart=NMNS.info.bizBeginTime||"0900",o.hourEnd=NMNS.info.bizEndTime||"2300",n.bizBeginTime=t.format("HHmm"),n.bizEndTime=a.format("HHmm"),NMNS.info.bizBeginTime=n.bizBeginTime||"0900",NMNS.info.bizEndTime=n.bizEndTime||"2300",NMNS.calendar.setOptions({week:{hourStart:n.bizBeginTime?parseInt(n.bizBeginTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourStart,hourEnd:n.bizEndTime?parseInt(n.bizEndTime.substring(0,2),10):NMNS.calendar.getOptions().week.hourEnd}})),m("#infoShopName").val()!==(NMNS.info.shopName||"")&&(o.shopName=NMNS.info.shopName,n.shopName=m("#infoShopName").val(),NMNS.info.shopName=n.shopName,S(n.shopName)),m("#infoBizType").val()!==(NMNS.info.bizType||"")&&(o.bizType=NMNS.info.bizType,n.bizType=m("#infoBizType").val(),NMNS.info.bizType=n.bizType),Object.keys(n).length&&(NMNS.history.push(o),NMNS.socket.emit("update info",n));var i=!1;m(".infoManagerItem").each(function(){if(m(this).hasClass("addManagerItem"))i=!0,Y(m(this).find("input[type='text']")[0]);else{var e=m(this).find("input[type='text']"),t=s(e.data("id"));if(m(this).data("delete")&&t)i=!0,NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().remove(t.id,function(e,t){return e.id===t})),NMNS.history.push({id:t.id,bgColor:t.bgColor,borderColor:t.borderColor,color:t.color,name:t.name}),NMNS.socket.emit("delete manager",{id:t.id});else if(t&&(e.data("color")!==t.bgColor||e.val()!==t.name)){i=!0;var a=e.data("color");NMNS.calendar.setCalendar(t.id,{color:a,bgColor:getBackgroundColor(a),borderColor:a,name:e.val()},!0),NMNS.calendar.setCalendarColor(t.id,{color:a,bgColor:getBackgroundColor(a),borderColor:a},!0),NMNS.history.push({id:t.id,color:t.bgColor,name:t.name}),NMNS.socket.emit("update manager",{id:t.id,color:a,name:e.val()})}}}),i&&(m("#lnbManagerList").html(N(NMNS.calendar.getCalendars())),r()),i||Object.keys(n).length?m("#infoModal").modal("hide"):showSnackBar("<span>변경된 내역이 없습니다.</span>")}else alert("담당자의 이름을 입력해주세요.")}else alert("담당자는 최소 1명 이상이 있어야 합니다.")}function k(){NMNS.initedNoShowModal?(m("#noShowAddContact").autocomplete().clearCache(),m("#noShowSearchContact").autocomplete().clearCache(),m("#noShowScheduleName").autocomplete().clearCache(),m("#noShowScheduleContact").autocomplete().clearCache()):(NMNS.initedNoShowModal=!0,m("#noShowScheduleList").hasClass("ps")||m("#noShowScheduleList").data("scroll",new PerfectScrollbar("#noShowScheduleList",{suppressScrollX:!0})),m(".noShowAddCase").off("touch click").on("touch click",function(){m(this).siblings().removeClass("bg-primary"),m(this).toggleClass("bg-primary"),m(this).parent().is(m("#noShowAddContent"))&&0<m("#noShowAddContact").val().trim().length&&(0<m(this).parent().children(".bg-primary").length||0<m(this).siblings("input").val().trim().length)?m(this).parent().next().children("span").css("opacity",1):m(this).parent().is(m("#noShowScheduleContent"))&&0<m("#noShowScheduleList input:checked").length&&(0<m(this).parent().children(".bg-primary").length||0<m(this).siblings("input").val().trim().length)?m(this).parent().next().children("span").css("opacity",1):m(this).parent().next().children("span").css("opacity",.35)}),m("#noShowAddCaseEtc,#noShowScheduleCaseEtc").on("keyup",function(e){m(this).siblings().removeClass("bg-primary"),m(this).parent().is(m("#noShowAddContent"))&&0<m("#noShowAddContact").val().trim().length&&0<m(this).val().trim().length?m(this).parent().next().children("span").css("opacity",1):m(this).parent().is(m("#noShowScheduleContent"))&&0<m("#noShowScheduleList input:checked").length&&0<m(this).val().trim().length?m(this).parent().next().children("span").css("opacity",1):m(this).parent().next().children("span").css("opacity",.35),13===e.which&&m(this).parent().next().trigger("click")}),m("#noShowAddBtn").off("touch click").on("touch click",function(){""!==m("#noShowAddContact").val()?0!==m("#noShowAddContent .noShowAddCase.bg-primary").length||0!==m("#noShowAddCaseEtc").val().trim().length?NMNS.socket.emit("add noshow",{id:NMNS.email+generateRandom(),contact:m("#noShowAddContact").val(),noShowCase:0===m("#noShowAddContent .bg-primary").length?m("#noShowAddCaseEtc").val().trim():m("#noShowAddContent .bg-primary").data("value")}):showSnackBar("<span>노쇼 사유를 선택해주세요.</span>"):showSnackBar("<span>저장할 전화번호를 입력해주세요!</span>")}),m("#noShowScheduleBtn").off("touch click").on("touch click",function(){if(0!==m("#noShowScheduleList input:checked").length)if(0!==m("#noShowScheduleContent .noShowAddCase.bg-primary").length||0!==m("#noShowScheduleCaseEtc").val().trim().length){var e=m("#noShowScheduleList input:checked").parent().parent();NMNS.history.push({id:e.data("id"),status:e.data("status"),manager:e.data("manager"),contents:e.data("contents")}),NMNS.socket.emit("update reserv",{id:e.data("id"),status:"NOSHOW",noShowCase:0<m("#noShowScheduleContent .noShowAddCase.bg-primary").length?m("#noShowScheduleContent .noShowAddCase.bg-primary").data("value"):m("#noShowScheduleCaseEtc").val().trim()})}else showSnackBar("<span>노쇼 사유를 선택해주세요.</span>");else showSnackBar("<span>노쇼로 등록할 예약을 선택해주세요.</span>")}),m("#noShowScheduleSearch").off("touch click").on("touch click",function(){var e={};""!==m("#noShowScheduleTarget").val()&&(e.target=m("#noShowScheduleTarget").val()),m("#noShowScheduleList .row").remove(),NMNS.socket.emit("get summary",e)}),setNumericInput(m("#noShowAddContact").on("keyup",function(e){13===e.which&&m("#noShowAddBtn").trigger("click")})[0]),m("#noShowTabList a[href='#noShowSchedule']").on("show.bs.tab",function(){m("#noShowScheduleSearch").trigger("click")}),m("#noShowAddContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,t){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,t){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),m("#noShowScheduleTarget").on("keyup",function(e){13===e.which&&m("#noShowScheduleSearch").trigger("click")}).autocomplete({serviceUrl:"get customer info",paramName:"target",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,t){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,t){return e.value+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){m("#noShowScheduleContact").val(e.data)}},NMNS.socket))}function b(){var t="";return NMNS.calendar.getCalendars().forEach(function(e){t+="<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='"+e.id+"' data-color='"+e.color+"'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+e.color+"'></span><span class='tui-full-calendar-content'>"+e.name+"</span></button>"}),t}function w(e){var t="";return"string"==typeof e&&(e=[e]),e.forEach(function(e){t+='<input type="text" class="form-control form-control-sm han" name="scheduleContents" aria-label="예약 내용" placeholder="예약 내용을 직접 입력하거나 메뉴에서 선택하세요." list="scheduleTabContentList" value="'+e+'">'}),t}function y(e){if(!m("#scheduleStartDate")[0]._flatpickr){var t,a={dateFormat:"Y. m. d",enableTime:!1,defaultDate:new Date,locale:"ko"};function n(){clearTimeout(t),(9<m("#scheduleContact").val().length||""!==m("#scheduleName").val())&&NMNS.socket.emit("get customer",{name:m("#scheduleName").val(),contact:m("#scheduleContact").val()})}flatpickr("#scheduleStartDate",a),flatpickr("#scheduleEndDate",a),m("#scheduleAddContents").on("touch click",function(){m("#scheduleTabContents").append('<input type="text" class="form-control form-control-sm han" name="scheduleContents" aria-label="예약 내용" placeholder="예약 내용을 직접 입력하거나 메뉴에서 선택하세요." list="scheduleTabContentList">')}),m("#scheduleName").autocomplete({serviceUrl:"get customer info",paramName:"name",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e){return e.forEach(function(e){e.data=e.contact,e.value=e.name,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e){return e.value+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){m("#scheduleContact").val(e.data).trigger("blur"),m("#scheduleEtc").prop("readonly",!0),m(".scheduleEtcNotice").show()}},NMNS.socket).on("blur",function(){clearTimeout(t),t=setTimeout(function(){n()},300)}).on("input",function(){m("#scheduleEtc").prop("readonly",!1),m(".scheduleEtcNotice").hide()}),setNumericInput(m("#scheduleContact").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e){return e.value+" ("+dashContact(e.data)+")"},onSearchError:function(){},onSelect:function(e){m("#scheduleName").val(e.data),n(),m("#scheduleEtc").prop("readonly",!0),m(".scheduleEtcNotice").show()}},NMNS.socket).on("blur",function(){filterNonNumericCharacter(m("#scheduleContact")),clearTimeout(t),t=setTimeout(function(){n()},300)}).on("input",function(){m("#scheduleEtc").prop("readonly",!1),m(".scheduleEtcNotice").hide()})[0]),m("#scheduleBtn").on("touch click",function(){var e,t,a,n,o,i,l,c,s,d,r;try{if(a=m("#scheduleStartDate")[0]._flatpickr.selectedDates[0],n=m("#scheduleEndDate")[0]._flatpickr.selectedDates[0],!moment(a).isValid())return void showSnackBar("시작 일자를 확인해주세요.");if(!moment(n).isValid())return void showSnackBar("종료 일자를 확인해주세요.")}catch(e){if(!a||!n)return void showSnackBar("시간을 입력해주세요!")}o=parseTime(m("#scheduleStartTime").val()),i=parseTime(m("#scheduleEndTime").val()),o?i?(a.setHours(1*o.substring(0,2)),a.setMinutes(1*o.substring(2)),n.setHours(1*i.substring(0,2)),n.setMinutes(1*i.substring(2)),d=m("#scheduleManager").data("calendar-id"),(r=NMNS.calendar.getCalendars().find(function(e){return e.id===d}))?(a.getTime()<n.getTime()&&(a=[n,n=a][0]),e=m("#scheduleName").val(),l=JSON.stringify(m("#scheduleTabContents input").filter(function(){return""!==this.value}).map(function(){return{menuId:this.getAttribute("data-menuId"),value:this.value}}).toArray()),c=m("#scheduleContact").val(),s=m("#scheduleEtc").val(),t=m("#scheduleAllDay").prop("checked"),("Y"!==NMNS.info.alrimTalkInfo.useYn||/^01([016789]?)([0-9]{3,4})([0-9]{4})$/.test(c)||confirm("입력하신 전화번호는 알림톡을 보낼 수 있는 전화번호가 아닙니다. 그래도 등록하시겠어요?"))&&(NMNS.scheduleTarget&&NMNS.scheduleTarget.schedule?NMNS.calendar.fire("beforeUpdateSchedule",{schedule:{id:NMNS.scheduleTarget.schedule.id,calendarId:d,title:e,raw:{contents:l,contact:c,etc:s,status:NMNS.scheduleTarget.schedule.raw.status},start:a,end:n,isAllDay:t,category:t?"allday":"time",manager:d,name:e,contents:l,contact:c,etc:s,status:NMNS.scheduleTarget.schedule.raw.status,color:r.color,bgColor:r.bgColor,borderColor:r.borderColor,dragBgColor:r.bgColor,triggerEventName:"click"},history:NMNS.scheduleTarget.schedule,start:a,end:n,calendar:r,triggerEventName:"click"}):NMNS.calendar.fire("beforeCreateSchedule",{calendarId:d,title:e,name:e,raw:{class:"public",location:"",contents:l,contact:c,etc:s,status:"RESERVED"},start:a,end:n,isAllDay:t,state:"Busy",category:t?"allday":"time",dueDateClass:"",attendees:[],recurrenceRule:!1,isPending:!1,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:r?r.bgColor:"#99a0a8",borderColor:r?r.borderColor:"#334150",color:r?r.borderColor:"#334150",dragBgColor:r?r.bgColor:"#99a0a8",manager:d,contents:l,contact:c,etc:s,status:"RESERVED"}),m("#scheduleModal").modal("hide"))):showSnackBar("담당자를 지정해주세요.")):showSnackBar("종료 시간을 확인해주세요."):showSnackBar("시작 시간을 확인해주세요.")})}!function(t){var e;if(NMNS.refreshScheduleManager&&(NMNS.refreshScheduleManager=!1,m("#scheduleManager").next().html(b()).off("touch click","button").on("touch click","button",function(){m("#scheduleManager").data("calendar-id",m(this).data("calendar-id")).data("color",m(this).data("color")).html(m(this).html())})),m("#scheduleBtn span").text(t&&t.schedule?"예약 변경 완료":"예약 추가 완료"),m("#scheduleTab").data("contact",t&&t.schedule?t.schedule.raw.contact:null).data("name",t.schedule?t.schedule.title:""),"object"==typeof t)document.getElementById("scheduleStartDate")._flatpickr.setDate(t.schedule?t.schedule.start.toDate():t.start.toDate()),document.getElementById("scheduleEndDate")._flatpickr.setDate(t.schedule?t.schedule.end.toDate():t.end.toDate()),m("#scheduleStartTime").val(getTimeFormat(moment(t.schedule?t.schedule.start.toDate():t.start.toDate()))),m("#scheduleEndTime").val(getTimeFormat(moment(t.schedule?t.schedule.end.toDate():t.end.toDate()))),m("#scheduleName").val(t.schedule?t.schedule.title:""),m("#scheduleTabContents").html(w(t.schedule&&t.schedule.raw?t.schedule.raw.contents:"")),m("#scheduleContact").val(t.schedule?t.schedule.raw?t.schedule.raw.contact:t.schedule.contact:""),m("#scheduleEtc").val(t.schedule?t.schedule.raw?t.schedule.raw.etc:t.schedule.etc:"").prop("readonly",!!t.schedule),m("#scheduleAllDay").attr("checked",t.schedule?t.schedule.isAllDay:t.isAllDay),e=t.schedule?t.schedule.calendarId:NMNS.calendar.getCalendars()[0].id,(e=t.schedule?NMNS.calendar.getCalendars().find(function(e){return e.id===t.schedule.calendarId}):NMNS.calendar.getCalendars()[0])?(e=m("#taskManager").next().find("button[data-calendar-id='"+e+"']"),m("#scheduleManager").html(e.html()).data("calendarid",e.data("calendarId")).data("color",e.data("color"))):m("#scheduleManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+t.schedule.color+"'></span><span class='tui-full-calendar-content'>(삭제된 담당자)</span>").data("calendarid",t.schedule.calendarId).data("color",t.schedule.color);else if("string"==typeof t)document.getElementById("scheduleStartDate")._flatpickr.setDate(document.getElementById("taskStartDate")._flatpickr.selectedDates[0]),m("#scheduleStartTime").val(m("#taskStartTime").val()),document.getElementById("scheduleEndDate")._flatpickr.setDate(document.getElementById("taskEndDate")._flatpickr.selectedDates[0]),m("#scheduleEndTime").val(m("#taskEndTime").val()),m("#scheduleAllDay").prop("checked",m("#taskAllDay").prop("checked")),e=m("#taskManager"),m("#scheduleManager").data("calendar-id",e.data("calendar-id")).data("color",e.data("color")).html(e.html());else{var a=moment();a.hour()>Number(NMNS.info.bizEndTime.substring(0,2))||a.hour()==Number(NMNS.info.bizEndTime.substring(0,2))&&a.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?a=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):a.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||a.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&a.minute()<Number(NMNS.info.bizBeginTime.substring(2))?a=moment(NMNS.info.bizBeginTime,"HHmm"):a.minute(10*Math.ceil(a.minute()/10)),document.getElementById("scheduleStartDate")._flatpickr.setDate(a.toDate()),m("#scheduleStartTime").val(getTimeFormat(a)),document.getElementById("scheduleEndDate")._flatpickr.setDate(a.add(30,"m").toDate()),m("#scheduleEndTime").val(getTimeFormat(a)),m("#scheduleName").val(""),m("#scheduleTabContents").html(w("")),m("#scheduleContact").val(""),m("#scheduleEtc").val("").prop("readonly",!1),m("#scheduleAllDay").attr("checked",!1),e=NMNS.calendar.getCalendars()[0].id,m("#scheduleManager").html(m("#scheduleManager").next().find("button[data-calendar-id='"+e+"']").html()).data("calendarid",e)}}(e)}function D(e){if(!m("#taskStartDate")[0]._flatpickr){var t={dateFormat:"Y. m. d",enableTime:!1,defaultDate:new Date,locale:"ko"};flatpickr("#taskStartDate",t),flatpickr("#taskEndDate",t),m("#taskBtn").on("touch click",function(){if(""===m("#taskName").val())return alert("일정 이름을 입력해주세요!"),void m("#taskName").focus();var e,t=m("#taskStartDate")[0]._flatpickr.selectedDates[0],a=m("#taskEndDate")[0]._flatpickr.selectedDates[0];if(t.getTime()>a.getTime()&&(t=[a,a=t][0]),m("#taskTab").data("edit")){var n=m("#taskTab").data("task");n.manager=n.calendarId,NMNS.history.push(n),n.calendarId!==m("#taskManager").data("calendar-id")?(n.newCalendarId=m("#taskManager").data("calendar-id"),NMNS.calendar.deleteSchedule(n.id,n.manager,!0),NMNS.calendar.createSchedules([{id:n.id,calendarId:m("#taskManager").data("calendar-id"),title:m("#taskName").val(),start:t,end:a,isAllDay:m("#taskAllDay").prop("checked"),category:"task",dueDateClass:"",color:m("#taskManager").data("bgcolor"),bgColor:getBackgroundColor(m("#taskManager").data("bgcolor")),borderColor:m("#taskManager").data("bgcolor"),raw:{status:"RESERVED"}}])):NMNS.calendar.updateSchedule(n.id,n.calendarId,{title:m("#taskName").val(),start:t,end:a,isAllDay:m("#taskAllDay").prop("checked")}),NMNS.socket.emit("update reserv",{id:n.id,manager:m("#taskManager").data("calendar-id"),name:m("#taskName").val(),start:moment(t).format("YYYYMMDDHHmm"),end:moment(a).format("YYYYMMDDHHmm"),isAllDay:m("#taskAllDay").prop("checked")})}else"function"==typeof NMNS.scheduleTarget.clearGuideElement&&NMNS.scheduleTarget.clearGuideElement(),e=NMNS.email+generateRandom(),NMNS.calendar.createSchedules([{id:e,calendarId:m("#taskManager").data("calendar-id"),title:m("#taskName").val(),start:t,end:a,isAllDay:m("#taskAllDay").prop("checked"),category:"task",dueDateClass:"",color:m("#taskManager").data("bgcolor"),bgColor:getBackgroundColor(m("#taskManager").data("bgcolor")),borderColor:m("#taskManager").data("bgcolor"),raw:{status:"RESERVED"}}]),NMNS.history.push({id:e,manager:m("#taskManager").data("calendar-id")}),NMNS.socket.emit("add reserv",{id:e,manager:m("#taskManager").data("calendar-id"),name:m("#taskName").val(),start:moment(t).format("YYYYMMDDHHmm"),end:moment(a).format("YYYYMMDDHHmm"),isAllDay:m("#taskAllDay").prop("checked"),type:"T",status:"RESERVED"});m("#scheduleModal").modal("hide")})}!function(t){var e;if(NMNS.refreshTaskManager&&(NMNS.refreshTaskManager=!1,m("#taskManager").next().html(b()).off("touch click","button").on("touch click","button",function(){m("#taskManager").data("calendar-id",m(this).data("calendar-id")).data("color",m(this).data("color")).html(m(this).html())})),m("#taskBtn span").text(t&&t.id?"일정 변경 완료":"일정 추가 완료"),"object"==typeof t)m("#taskTab").data("edit",!!t.id).data("task",t),document.getElementById("taskStartDate")._flatpickr.setDate(t.start.toDate()),document.getElementById("taskEndDate")._flatpickr.setDate(t.end.toDate()),m("#taskStartTime").val(getTimeFormat(moment(t.start.toDate()))),m("#taskEndTime").val(getTimeFormat(moment(t.end.toDate()))),m("#taskName").val(t.title||""),m("#taskContents").val(t.raw&&t.raw.contents||""),(e=t.calendarId?NMNS.calendar.getCalendars().find(function(e){return e.id===t.calendarId}):NMNS.calendar.getCalendars()[0])?(e=m("#taskManager").next().find("button[data-calendar-id='"+e+"']"),m("#taskManager").html(e.html()).data("calendarid",e.data("calendarId")).data("color",e.data("color"))):m("#taskManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+t.color+"'></span><span class='tui-full-calendar-content'>(삭제된 담당자)</span>").data("calendarid",t.calendarId).data("color",t.color);else if("string"==typeof t)document.getElementById("taskStartDate")._flatpickr.setDate(document.getElementById("scheduleStartDate")._flatpickr.selectedDates[0]),m("#taskStartTime").val(m("#scheduleStartTime").val()),document.getElementById("scheduleEndDate")._flatpickr.setDate(document.getElementById("taskEndDate")._flatpickr.selectedDates[0]),m("#taskEndTime").val(m("#scheduleEndTime").val()),m("#taskAllDay").prop("checked",m("#scheduleAllDay").prop("checked")),e=m("#scheduleManager"),m("#taskManager").data("calendar-id",e.data("calendar-id")).data("color",e.data("color")).html(e.html());else{m("#taskTab").data("edit",!1).removeData("task");var a=moment();a.hour()>Number(NMNS.info.bizEndTime.substring(0,2))||a.hour()==Number(NMNS.info.bizEndTime.substring(0,2))&&a.minute()+30>Number(NMNS.info.bizEndTime.substring(2))?a=moment(NMNS.info.bizEndTime,"HHmm").subtract(30,"m"):a.hour()<Number(NMNS.info.bizBeginTime.substring(0,2))||a.hour()==Number(NMNS.info.bizBeginTime.substring(0,2))&&a.minute()<Number(NMNS.info.bizBeginTime.substring(2))?a=moment(NMNS.info.bizBeginTime,"HHmm"):a.minute(10*Math.ceil(a.minute()/10)),document.getElementById("taskStartDate")._flatpickr.setDate(a.toDate()),m("#taskStartTime").val(getTimeFormat(a)),document.getElementById("taskEndDate")._flatpickr.setDate(a.add(30,"m").toDate()),m("#taskEndTime").val(getTimeFormat(a)),m("#taskName").val(""),m("#taskContents").val(""),e=NMNS.calendar.getCalendars()[0].id,e=m("#taskManager").next().find("button[data-calendar-id='"+e+"']"),m("#taskManager").html(e.html()).data("calendarid",e.data("calendarId")).data("color",e.data("color"))}}(e)}function C(e){NMNS.calendar.createSchedules(e.map(function(e){if(e.raw)return"string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),e;var t=s(e.manager||e.calendarId)||{};return{id:e.id,calendarId:t.id||"A1",title:e.name||e.title,start:"string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,end:"string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,isAllDay:e.isAllDay,category:"T"===e.type?"task":e.isAllday?"allday":"time",dueDateClass:"T"===e.type?"dueDateClass":"",attendees:[],recurrenceRule:!1,isPending:e.isCanceled,isFocused:!1,isVisible:!0,isReadOnly:!1,isPrivate:!1,customStyle:"",location:"",bgColor:getBackgroundColor(t.color||"#334150"),borderColor:t.borderColor||"#334150",color:t.color||"#334150",dragBgColor:t.bgColor||"#334150",raw:{contact:e.contact,contents:e.contents,etc:e.etc,status:e.status}}}),!0)}function T(e){var t=e.parentsUntil("#noShowSearchList",".row");NMNS.history.push({id:t.data("id"),contact:t.data("contact")+"",date:t.data("date")+"",noShowCase:t.data("noshowcase")}),NMNS.socket.emit("delete noshow",{id:t.data("id")}),t.remove()}function Y(e){var t=m(e).parents(".addManagerItem"),a=t.find("input[type='text']");if(!a.val()||a.val().length<1)alert("담당자 이름을 입력해주세요.");else{var n=a.data("id"),o=t.find(".addManagerColor").data("color");t.removeClass("addManagerItem"),t.html("<label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'><span style='background-color:"+a.data("color")+"; border-color:"+a.data("color")+"' title='이 담당자의 예약 가리기/보이기' data-color='"+a.data("color")+"'></span><span class='menu-collapsed'>"+a.val()+"</span></label><button class='btn btn-flat menu-collapsed lnbManagerAction ml-auto text-white py-0 pr-0' type='button'><i class='fa fa-ellipsis-v'></i></button>");var i=NMNS.calendar.getCalendars();i.push({id:n,name:a.val(),checked:!0,bgColor:getBackgroundColor(o),borderColor:o,color:o}),NMNS.calendar.setCalendars(i),NMNS.socket.emit("add manager",{id:n,name:a.val(),color:o})}}function E(e){m(e).parents(".addManagerItem").remove()}m(".js-scroll-trigger").click(function(){m(".navbar-collapse").collapse("hide")}),NMNS.calendar=new tui.Calendar("#mainCalendar",{taskView:[],defaultView:550<m(window).width()?"week":"day",scheduleView:["time"],useCreationPopup:!1,useDetailPopup:!0,disableDblClick:!0,template:{allday:function(e){return a(e,e.isAllDay)},time:function(e){return a(e,e.isAllDay)},task:function(e){return a(e,e.isAllDay)},alldayTitle:function(){return"<span class='tui-full-calendar-left-content'>하루종일</span>"},taskTitle:function(){return"<span class='tui-full-calendar-left-content'>일정</span>"},timegridDisplayPrimayTime:function(e){return e.hour+":00"},popupIsAllDay:function(){return"하루종일"},startDatePlaceholder:function(){return"시작시간"},endDatePlaceholder:function(){return"종료시간"},popupDetailDate:function(e,t,a){var n=moment(t instanceof Date?t:t.toDate()),o=moment(a instanceof Date?a:a.toDate()),i=n.isSame(o,"day"),l=(i?"":"YYYY.MM.DD ")+"a h:mm";return e?n.format("YYYY.MM.DD")+(i?"":" - "+o.format("YYYY.MM.DD")):n.format("YYYY.MM.DD a h:mm")+" - "+o.format(l)},popupEdit:function(){return"수정"},popupDelete:function(){return"삭제"},weekDayname:function(t){var e="tui-full-calendar-dayname-date",a="tui-full-calendar-dayname-name"+(NMNS.calendar&&"week"===NMNS.calendar.getViewName()?" weekViewDayName":""),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===t.renderDate}):void 0;return n&&(a+=" tui-full-calendar-holiday",e+=" tui-full-calendar-holiday"),'<span class="'+e+'">'+t.date+'</span>&nbsp;&nbsp;<span class="'+a+'">'+t.dayName+(n?"["+n.title+"]":"")+"</span>"},monthGridHeader:function(t){var e=parseInt(t.date.split("-")[2],10),a=["tui-full-calendar-weekday-grid-date"],n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===t.date}):void 0;return n&&a.push("tui-full-calendar-holiday"),'<span class="'+a.join(" ")+'">'+e+(n?"<small class='d-none d-sm-inline'>["+n.title+"]</small>":"")+"</span>"},monthGridHeaderExceed:function(){return""},monthGridFooterExceed:function(e){return'<span class="tui-full-calendar-weekday-grid-more-schedules" title="전체 예약">전체 예약 <i class="fa fa-chevron-right"></i></span>'},monthMoreTitleDate:function(e,t){var a=e.split(".").join("-"),n=NMNS.holiday?NMNS.holiday.find(function(e){return e.date===a}):void 0;return'<span class="'+("tui-full-calendar-month-more-title-day"+("일"===t?" tui-full-calendar-holiday-sun":"")+(n?" tui-full-calendar-holiday":"")+("토"===t?" tui-full-calendar-holiday-sat":""))+'">'+parseInt(a.substring(8),10)+'</span> <span class="tui-full-calendar-month-more-title-day-label">'+t+(n?"<small class='d-none d-sm-inline'>["+n.title+"]</small>":"")+"</span>"}},month:{daynames:["일","월","화","수","목","금","토"],scheduleFilter:function(){return!0},grid:{header:{height:26}}},week:{daynames:["일","월","화","수","목","금","토"],hourStart:NMNS.info.bizBeginTime?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info.bizEndTime?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23},theme:{"week.currentTime.color":"#fd5b77","week.currentTimeLinePast.border":"1px solid #fd5b77","week.currentTimeLineBullet.backgroundColor":"transparent","week.currentTimeLineToday.border":"1px solid #fd5b77","week.currentTimeLineFuture.border":"1px solid #fd5b77","common.border":".07rem solid rgba(57, 53, 53, 0.35)","common.saturday.color":"#1736ff","common.dayname.color":"#393535","common.holiday.color":"#fd5b77","week.timegridOneHour.height":"68px","week.timegridHalfHour.height":"34px","week.vpanelSplitter.height":"5px","week.pastDay.color":"#393535","week.futureDay.color":"#393535","week.pastTime.color":"#393535","week.futureTime.color":"#393535","month.schedule.marginLeft":"0px","month.schedule.marginRight":"1px","month.schedule.marginTop":"5px","month.schedule.height":"12px","month.dayname.height":"52px","month.dayname.borderLeft":"none","month.dayname.borderTop":"none","month.dayname.textAlign":"center","month.dayname.fontWeight":"normal","month.holidayExceptThisMonth.color":"rgba(253, 91, 119, 0.35)","month.saturdayExceptThisMonth.color":"rgba(23, 54, 255, 0.35)","month.dayExceptThisMonth.color":"rgba(57, 53, 53, 0.35)","month.day.fontSize":"13px","common.creationGuide.backgroundColor":"#ffdbdb","common.creationGuide.border":"1px solid #ffdbdb","week.creationGuide.color":"#fd5b77","week.timegrid.paddingRight":"1px","week.dayGridSchedule.marginRight":"1px","week.dayname.borderTop":"none","week.dayname.borderBottom":"none","week.dayname.borderLeft":"none","week.dayname.textAlign":"center","week.dayname.height":"51px","week.dayGridSchedule.borderLeft":"2px solid","week.timegridLeft.borderRight":"none","week.daygridLeft.width":"54px","week.timegridLeft.width":"54px"}}),NMNS.calendar.on({beforeCreateSchedule:function(e){NMNS.scheduleTarget=e,console.log(e),y(e),m("#scheduleTabList a[data-target='#scheduleTab']").tab("show"),m("#scheduleModal").modal("show")},beforeUpdateSchedule:function(e){NMNS.scheduleTarget=e,console.log("update",e),y(e),m("#scheduleTabList a[data-target='#scheduleTab']").tab("show"),m("#scheduleModal").modal("show")},beforeDeleteSchedule:function(e){NMNS.history.push(e.schedule),NMNS.calendar.deleteSchedule(e.schedule.id,e.schedule.calendarId),NMNS.socket.emit("update reserv",{id:e.schedule.id,status:"DELETED"})},afterRenderSchedule:function(e){NMNS.calendar.getViewName()}}),NMNS.socket=io(),NMNS.socket.emit("get info"),NMNS.socket.emit("get manager"),NMNS.socket.emit("get task",{start:moment().format("YYYYMMDD"),end:moment().add(7,"days").format("YYYYMMDD")}),NMNS.socket.on("get reserv",socketResponse("예약 정보 받아오기",function(e){C(e.data),NMNS.holiday=NMNS.holiday.concat(e.holiday.filter(function(t){return!NMNS.holiday.some(function(e){return e.date===t.date})})),r()})),NMNS.socket.on("get info",socketResponse("매장 정보 받아오기",function(e){if(NMNS.info=e.data,NMNS.calendar&&NMNS.calendar.setOptions({week:{hourStart:NMNS.info.bizBeginTime?parseInt(NMNS.info.bizBeginTime.substring(0,2),10):9,hourEnd:NMNS.info.bizEndTime?parseInt(NMNS.info.bizEndTime.substring(0,2),10)+("00"===NMNS.info.bizEndTime.substring(2)?0:1):23}}),NMNS.email=e.data.email||NMNS.email,NMNS.calendarHeight=4.26*(NMNS.calendar.getOptions().week.hourEnd-NMNS.calendar.getOptions().week.hourStart)+7.25,m("#mainCalendar").css("height",NMNS.calendarHeight+"rem"),"BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus&&moment(NMNS.info.signUpDate,"YYYYMMDD").add(30,"d").isSameOrAfter(moment(),"day")&&showNotification({title:"이메일을 인증해주세요!",body:"인증메일은 내 매장 정보 화면에서 다시 보내실 ����������� 있습니다. 이메일을 인증해주세요!"}),NMNS.info.isFirstVisit){if(!document.getElementById("tutorialScript")){var t=document.createElement("script");t.src="/nmns/js/tutorial.min.js",t.id="tutorialScript",document.body.appendChild(t),t.onload=function(){m("#tutorialModal").modal()}}}else("true"===getCookie("showTips")||void 0===getCookie("showTips"))&&Math.random()<.5&&m("#tipsModal").modal("show");NMNS.info.newAnnouncement&&m(".announcementCount").html(99<NMNS.info.newAnnouncement?"99+":NMNS.info.newAnnouncement)})),NMNS.socket.on("get manager",socketResponse("매니저 정보 받아오기",function(e){e.data.forEach(function(e){e.checked=!0,e.bgColor=getBackgroundColor(e.color),e.borderColor=e.color,e.color=e.color}),m("#lnbManagerList").html(N(e.data)),NMNS.calendar.setCalendars(e.data),NMNS.needInit&&(delete NMNS.needInit,f()),m("#mainTaskContents").html(g([{date:"20190320",task:[{title:"aaa",manager:"happy@store.com20180907050532384",contents:"aaa",start:"201903200101",end:"201903202359"}]},{date:"20190321",task:[{title:"abbbaa",manager:"happy@store.com20180907050532384",contents:"aabbba",start:"201903210102",end:"201903232350"}]},{date:"20190322",task:[]}])),r()})),NMNS.initAlrimModal=function(){NMNS.initedAlrimModal||(NMNS.initedAlrimModal=!0,m("#labelAlrimUseYn").on("touch click",function(){m(this).next().children("label").trigger("click")}),m("#alrimNotice").off("keyup keydown paste cut change").on("keyup keydown paste cut change",function(){m("#noticeByteCount").text(m(this).val().length)}).on("blur",function(){m(this).val(removeNonCharacter(m(this).val()))}),m("#alrimUseYn").off("change").on("change",function(){m(this).prop("checked")?m("#alrimScreen").hide():m("#alrimScreen").show()}),setNumericInput(m("#alrimCallbackPhone")[0]),m("#alrimInfoBtn").off("touch click").on("touch click",M),m("#alrimHistorySearch").off("touch click").on("touch click",function(){var e={};""!==m("#alrimHistoryTarget").val()&&(e.target=m("#alrimHistoryTarget").val()),m("#alrimHistoryList .row").remove(),NMNS.socket.emit("get alrim history",e)}),m("#alrimHistoryTarget").off("keyup").on("keyup",function(e){13===e.which&&m("#alrimHistorySearch").trigger("click")})),"Y"===NMNS.info.alrimTalkInfo.useYn?(m("#alrimUseYn").prop("checked",!0),m("#alrimScreen").hide()):(m("#alrimUseYn").prop("checked",!1),m("#alrimScreen").show()),m("#alrimCallbackPhone").val(NMNS.info.alrimTalkInfo.callbackPhone||""),m("#alrimShopName").val(NMNS.info.shopName||""),m("#alrimCancelDue").val(NMNS.info.alrimTalkInfo.cancelDue||""),m("#alrimNotice").val(NMNS.info.alrimTalkInfo.notice||""),m("#noticeByteCount").text(m("#alrimNotice").val().length)},NMNS.initInfoModal=function(){NMNS.initedInfoModal||(NMNS.initedInfoModal=!0,m("#infoBtn").off("touch click").on("touch click",v)),m("#infoEmail").text(NMNS.email),m("#infoAuthStatus").html("BEFORE_EMAIL_VERIFICATION"===NMNS.info.authStatus?m(p(NMNS.info.authStatus)).on("touch click",function(){NMNS.socket.emit("send verification",{}),showSnackBar("<span>인증메일을 보냈습니다. 도착한 이메일을 확인해주세요!</span>")}):p(NMNS.info.authStatus)),m("#infoShopName").val(NMNS.info.shopName),m("#infoBizType").val(NMNS.info.bizType),m("#infoBizBeginTime").val(NMNS.info.bizBeginTime),m("#infoBizEndTime").val(NMNS.info.bizEndTime)};var x,I,A,H,B,L;function z(e){e&&e.preventDefault&&e.preventDefault(),m(this).hasClass("menuLinkActive")||(m(".switchingMenu:not(."+m(this).data("link")+")").hide(),m("."+m(this).data("link")).show(),m(".menuLinkActive").removeClass("menuLinkActive"),m(this).addClass("menuLinkActive"),m("#mainCalendarArea").css("minWidth",""),m("#mainContents").css("minWidth","100%"),m("#mainAside").css("minWidth","unset"),m("#mainTask").removeClass("show"))}m("#nextTips").one("touch click",function(){NMNS.socket.emit("get tips"),m("#waitTips").parent().addClass("wait"),NMNS.tips=[{title:m("#tipsTitle").html(),body:m("#tipsBody").html()}],m(this).on("touch click",function(){if(!m(this).hasClass("disabled")&&!m("#waitTips").is(":visible")){var e=m("#tipsModal").data("index")+1;NMNS.tips&&e<NMNS.tips.length&&(m("#tipsModal").data("index",e),e===NMNS.tips.length-1&&m("#nextTips").addClass("disabled"),m("#tipsTitle").html(NMNS.tips[e].title),m("#tipsBody").html(NMNS.tips[e].body),m("#prevTips").removeClass("disabled"))}}),m("#prevTips").on("touch click",function(){if(!m(this).hasClass("disabled")){var e=m("#tipsModal").data("index")-1;m("#waitTips").is(":visible")||0<=e&&NMNS.tips&&(m("#tipsModal").data("index",e),0===e&&m("#prevTips").addClass("disabled"),m("#tipsTitle").html(NMNS.tips[e].title),m("#tipsBody").html(NMNS.tips[e].body),m("#nextTips").removeClass("disabled"))}})}),m("#submitFeedback").off("touch click").on("touch click",function(){var e=m("#feedbackBody").val();e&&0<e.trim().length?(NMNS.socket.emit("submit feedback",{data:e.trim()}),showSnackBar("제안/문의해주신 내용이 잘 전달되었습니다.<br/> 소중한 의견에 감사드립니다."),m("#feedbackBody").val("")):showSnackBar("제안/문의하실 내용을 입력해주세요.")}),u(),h(),function(){if(m(".moveDate").on("touch click",o),m(".calendarType").on("touch click",n),m("#calendarTypeMenu").next().children("a").on("touch click",function(e){e.preventDefault();var t=m(e.target);t.hasClass("dropdown-item")||(t=t.parents(".dropdown-item")),m("#calendarTypeMenu").html(t.html()),m("#calendarTypeMenu").attr("data-action",t.data("action")),m("#calendarTypeMenu").trigger("click")}),m("#managerElements").on("change",d),m("#dropdownMenu-calendars-list").on("touch click",l),m(".addReservLink").on("touch click",c),m(".addNoShowLink").one("touch click",k),window.addEventListener("resize",debounce(function(){NMNS.calendar.render()},200)),flatpickr.localize("ko"),m(".taskMenu").on("touch click",i),m("#sidebarToggler").on("touch click",function(){m("#mainAside").hasClass("sidebar-toggled")?m("#mainTask").hasClass("show")&&m("#mainAside").css("minWidth","270px"):m("#mainAside").css("minWidth","unset"),m("#mainAside").toggleClass("sidebar-toggled"),m("#mainAside .menu-collapsed").toggle()}),m(".announcementMenuLink").popover({template:'<div class="popover" role="tooltip" style="width:375px"><div class="arrow"></div><div class="d-flex align-items-center" style="padding:25px 30px;border-bottom:1px solid rgba(58, 54, 54, 0.35)"><span style="font-size:18px;font-weight:bold">알림</span><span class="close-button ml-auto cursor-pointer">&times;</span></div><div id="announcementBody">알림을 불러오는 중입니다...</div></div>',html:!0,sanitize:!1,placement:"auto"}),m("#mainMenu").popover({template:'<div class="popover" role="tooltip"><div class="arrow"></div><div><ul style="padding: 25px 30px;margin:0"><li class="mainMenuRow"><a class="d-block" data-link="#infoModal" data-toggle="modal" href="#" aria-label="내 매장 정보">내 매장 정보</a></li><li class="mainMenuRow"><a class="d-block" data-link="#alrimModal" data-toggle="modal" href="#" aria-label="알림톡 정보">알림톡 정보</a></li><li class="mainMenuRow"><a class="d-block" data-link="#userModal" data-toggle="modal" href="#" aria-label="내 계정 정보">내 계정 정보</a></li><li class="mainMenuRow"><a id="signoutLink" class="d-block" href="/signout" aria-label="로그아웃">로그아웃</a></li></ul></div></div>',html:!0,sanitize:!1,placement:"bottom"}),setNumericInput(m("#searchNoShow").on("keyup",function(e){13!==e.keyCode&&13!==e.which||(11===m(this).val().length||10===m(this).val().length?(z.apply(this,e),NMNS.socket.emit("get noshow",{contact:m(this).val(),mine:!1})):showSnackBar("전화번호를 정확히 입력해주세요."))})[0]),m("#searchNoShow").autocomplete({serviceUrl:"get customer info",paramName:"contact",zIndex:1060,maxHeight:150,triggerSelectOnValidInput:!1,transformResult:function(e,t){return e.forEach(function(e){e.data=e.name,e.value=e.contact,delete e.contact,delete e.name}),{suggestions:e}},onSearchComplete:function(){},formatResult:function(e,t){return dashContact(e.value)+" ("+e.data+")"},onSearchError:function(){},onSelect:function(e){}},NMNS.socket),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&!document.getElementById("datalistPolyfillScript")){var e=document.createElement("script");e.src="/lib/datalist-polyfill/datalist-polyfill.min.js",e.id="datalistPolyfillScript",document.body.appendChild(e)}}(),NMNS.socket.on("get tips",socketResponse("팁 정보 가져오기",function(e){e.data&&0<e.data.length?(NMNS.tips=NMNS.tips.concat(e.data),m("#tipsModal").data("index",1),m("#tipsModal #tipsTitle").html(NMNS.tips[1].title),m("#tipsModal #tipsBody").html(NMNS.tips[1].body),m("#prevTips").removeClass("disabled"),2===NMNS.tips.length&&m("#nextTips").addClass("disabled")):m("#nextTips").add("disabled"),m("#waitTips").parent().removeClass("wait")})).on("get summary",socketResponse("예약정보 가져오기",function(e){var t="";0===e.data.length?t="<div class='row col-12 px-0 mt-1 empty'><span class='col-12 text-center'>검색된 내용이 없습니다. 검색조건을 바꿔서 검색해보세요 :)</span></div>":e.data.forEach(function(e){t+="<div class='row col-12 mx-0' style='padding: 10px 0;font-size:12px' data-id='"+(e.id||"")+"' data-manager='"+(e.manager||"")+"' data-status='"+(e.status||"")+"'"+(e.contents?" title='"+e.contents+"'":"")+"><div class='col-1 pl-0'><input type='checkbox' class='noShowScheduleCheck' id='noShowSchedule"+e.id+"'></input><label for='noShowSchedule"+e.id+"'></label></div><div class='col-2 montserrat px-0'>"+(e.start?moment(e.start,"YYYYMMDDHHmm").format("YYYY. MM. DD"):"")+"</div><div class='col-2 pr-0'>"+(e.name||"")+"</div><div class='col-3 pr-0 montserrat'>"+dashContact(e.contact)+"</div><div class='col-4 pr-0'>"+(e.contents||"")+"</div></div>"}),m("#noShowScheduleList").html(t),m("#noShowScheduleList input[type=checkbox]").on("change",function(e){m("#noShowScheduleList input[type=checkbox]").not(this).prop("checked",!1),m(this).prop("checked")&&(0<m("#noShowScheduleContent .bg-primary").length||0<m("#noShowScheduleCaseEtc").val().trim().length)?m("#noShowScheduleBtn span").css("opacity",1):m("#noShowScheduleBtn span").css("opacity",.35)}),m("#noShowScheduleList").hasClass("ps")&&m("#noShowScheduleList").data("scroll").update()})),NMNS.socket.on("add reserv",socketResponse("예약/일정 추가하기",function(e){NMNS.history.remove(e.data.id,function(e,t){return e.id===t})},function(t){var e=NMNS.history.find(function(e){return e.id===t.data.id});NMNS.history.remove(t.data.id,function(e,t){return e.id===t}),delete e.id,NMNS.calendar.deleteSchedule(t.data.id,e.manager)})),NMNS.socket.on("update reserv",socketResponse("예약/일정 정보 변경하기",function(e){NMNS.history.remove(e.data.id,function(e,t){return e.id===t}),m("#noShowScheduleList").is(":visible")&&m("#noShowScheduleList .row[data-id='"+e.data.id+"']").length&&(showSnackBar("<span>노쇼로 등록하였습니다.</span>"),m("#noShowScheduleList .row[data-id='"+e.data.id+"']").remove(),m("#noShowScheduleBtn span").css("opacity",.35))},function(t){var e=NMNS.history.find(function(e){return e.id===t.data.id});NMNS.history.remove(t.data.id,function(e,t){return e.id===t}),"DELETED"===(e.status||e.raw.status)?(C([e]),r()):e.newCalendarId&&!NMNS.calendar.getSchedule(t.data.id,e.selectedCal?e.selectedCal.id:e.calendarId)?(NMNS.calendar.deleteSchedule(t.data.id,e.newCalendarId,!0),e.category="task"===e.category?"task":e.isAllDay?"allday":"time",e.dueDateClass="",e.calendarId=e.selectedCal?e.selectedCal.id:e.calendarId,e.start="string"==typeof e.start?moment(e.start,"YYYYMMDDHHmm").toDate():e.start,e.end="string"==typeof e.end?moment(e.end,"YYYYMMDDHHmm").toDate():e.end,e.color=e.color||e.selectedCal.color,e.bgColor=e.bgColor||e.selectedCal.bgColor,e.borderColor=e.borderColor||e.selectedCal.borderColor,NMNS.calendar.createSchedules([e])):("string"==typeof e.start&&(e.start=moment(e.start,"YYYYMMDDHHmm").toDate()),"string"==typeof e.end&&(e.end=moment(e.end,"YYYYMMDDHHmm").toDate()),NMNS.calendar.updateSchedule(t.data.id,e.selectedCal?e.selectedCal.id:e.calendarId,e))})),NMNS.socket.on("get task",socketResponse("일정 가져오기",function(e){e.data.some(function(e){return e.date===moment().format("YYYYMMDD")})&&m("#todayTask").text(e.data.find(function(e){return e.date===moment().format("YYYYMMDD")}).task.length),m("#mainTaskContents").html(g(e.data))})),NMNS.socket.on("add manager",socketResponse("담당자 추가하기",void 0,function(t){NMNS.calendar.setCalendars(NMNS.calendar.getCalendars().filter(function(e){return e.id!==t.data.id})),m(".lnbManagerItem[data-value='"+t.data.id+"']").remove()})),NMNS.socket.on("delete manager",socketResponse("담당자 삭제하기",function(e){NMNS.history.remove(e.data.id,findById)},function(t){var e=NMNS.history.find(function(e){return e.id===t.data.id});if(e){var a=NMNS.calendar.getCalendars();a.push(e),NMNS.calendar.setCalendars(NMNS.calendar.getCalendars()),m("#lnbManagerList").html(N(a)),r(),NMNS.history.remove(t.data.id,findById)}})),NMNS.socket.on("update manager",socketResponse("담당자 변경하기",function(e){NMNS.history.remove(e.data.id,findById)},function(t){var e=NMNS.history.find(function(e){return e.id===t.data.id});e&&(NMNS.calendar.setCalendar(t.data.id,e),m("#lnbManagerList").html(N(NMNS.calendar.getCalendars())),r(),NMNS.history.remove(t.data.id,findById))})),NMNS.socket.on("update info",socketResponse("매장 정보 변경하기",function(){showSnackBar("<span>정상적으로 매장 정보를 변경하였습니다.</span>"),NMNS.history.remove("info",findById)},function(e){var t=NMNS.history.find(function(e){return"info"===e.id});(t.bizBeginTime||t.bizEndTime)&&NMNS.calendar.setOptions({week:{hourStart:t.bizBeginTime?t.bizBeginTime.substring(0,2):NMNS.info.bizBeginTime.substring(0,2),hourEnd:t.bizEndTime?t.bizEndTime.substring(0,2):NMNS.info.bizEndTime.substring(0,2)}}),t.shopName&&S(t.shopName),NMNS.info.shopName=t.shopName||NMNS.info.shopName,NMNS.info.bizType=t.bizType,NMNS.history.remove("info",findById),NMNS.initedInfoModal=!1})),NMNS.socket.on("update alrim",socketResponse("알림톡 정보 변경하기",function(){showSnackBar("<span>정상적으로 알림톡 정보를 변경하였습니다.</span>"),NMNS.history.remove("alrimInfo",findById)},function(){var t=NMNS.history.find(function(e){return"alrimInfo"===e.id});Object.keys(t).forEach(function(e){NMNS.info.alrimTalkInfo[e]=t[e]}),NMNS.history.remove("alrimInfo",findById),NMNS.initedAlrimModal=!1})),NMNS.socket.on("get noshow",socketResponse("노쇼 정보 가져오기",function(t){if(0<t.data.summary.noShowCount){if(t.data.detail.push({id:1111,date:"20190101",noShowCase:"직전취소"}),m("#noShowClean").removeClass("d-flex").addClass("d-none"),m("#noShowDirtyImage").attr("src")||m("#noShowDirtyImage").attr("src","/nmns/img/sub_img.svg"),m("#myNoShowCount").text(t.data.detail.length),m("#otherNoShowCount").text(t.data.summary.noShowCount-t.data.detail.length),t.data.summary.lastNoShowDate&&m("#noShowSearchSummary").text("마지막 노쇼는 "+moment(t.data.summary.lastNoShowDate,"YYYYMMDD").format("YYYY년 M월 D일입니다.")),0<t.data.detail.length){var a="<div class='row col-12 mx-0'><div class='col col-3'>전화번호</div><div class='col col-3'>노쇼 날짜</div><div class='col col-4'>노쇼 사유</div></div>";t.data.detail.forEach(function(e){a+="<div class='row col-12 noShowRow' data-id='"+e.id+"' data-contact='"+(t.data.summary.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"+(e.noShowCase||"")+"'><div class='col col-3'>"+(t.data.summary.contact?dashContact(t.data.summary.contact):"")+"</div><div class='col col-3'>"+(e.date?e.date.substring(0,4)+". "+e.date.substring(4,6)+". "+e.date.substring(6):"")+"</div><div class='col col-4 base-font' style='font-size:10px'>"+e.noShowCase+"</div><div class='col-2 pr-0 text-right'><span class='noShowSearchDelete' title='삭제'>&times;</span></div></div>"}),m("#noShowSearchList").html(a),m("#noShowSearchList .noShowSearchDelete").on("touch click",function(){T(m(this))})}m("#noShowDirty").removeClass("d-none").addClass("d-flex")}else m("#noShowDirty").removeClass("d-flex").addClass("d-none"),m("#noShowClean").removeClass("d-none").addClass("d-flex"),m("#noShowImage").attr("src")||m("#noShowImage").attr("src","/nmns/img/sub_img.svg"),m("#noShowSentense").text(["안심하세요. 노쇼를 하신 적이 없어요!","이분 최소 배우신분!! 노쇼 이력이 없어요.","노쇼를 하신 적이 없어요! 격하게 환영해주세요~~"][Math.floor(3*Math.random())])})),NMNS.socket.on("add noshow",socketResponse("노쇼 추가하기",function(e){var t;if(m("#noShowSearch").is(":visible")){e.data.noShowCase?"<span class='badge badge-light'>"+e.data.noShowCase+"</span>":"",(t=m("<div class='row col-12 noShowRow' data-id='"+e.data.id+"' data-contact='"+e.data.contact+"' data-date='"+e.data.date+"' data-noshowcase='"+e.data.noShowCase+"'><div class='col-3'>"+(e.data.contact||dashContact(m("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"'] input[name='noShowSearchAddContact']").val()))+"</div><div class='col-3'>"+(e.data.date?e.data.date.substring(0,4)+". "+e.data.date.substring(4,6)+". "+e.data.date.substring(6):"")+"</div><div class='col col-4 base-font' style='font-size:10px'>"+e.data.noShowCase+"</div><div class='col-2 pr-0 text-right'><span class='noShowSearchDelete' title='삭제'>&times;</span></div></div>")).insertBefore(m("#noShowSearchList").children(".noShowSearchAdd:eq(0)")),t.find(".noShowSearchDelete").on("touch click",function(){T(m(this))});var a=m("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"']");a.data("datetimepicker").destroy(),a.remove()}showSnackBar("<span>추가되었습니다! 다른 분들에게 많은 도움이 될거에요 :)</span>")},function(e){m("#noShowSearchList div.noShowSearchAdd[data-id='"+e.data.id+"'] .noShowSearchAddSubmit").off("touch click").on("touch click",function(){!function(e){var t=e.parentsUntil("#noShowSearchList",".row");if(""===t.find("input[name='noShowSearchAddContact']").val())return alert("전화번호를 입력해주세요!"),t.find("input[name='noShowSearchAddContact']").focus();if(!moment(t.find("input[name='noShowSearchAddDate']").val(),"YYYY-MM-DD").isValid())return alert("노쇼 날짜를 알맞게 입력해주세요!"),t.find("input[name='noShowSearchAddDate']").focus();var a={id:t.data("id"),contact:t.find("input[name='noShowSearchAddContact']").val(),date:moment(t.find("input[name='noShowSearchAddDate']").val(),"YYYY-MM-DD").format("YYYYMMDD"),noShowCase:t.find("select").val()};NMNS.socket.emit("add noshow",a),e.off("touch click").on("touch click",function(){alert("저장 요청중입니다..!")})}(m(this))})})),NMNS.socket.on("delete noshow",socketResponse("노쇼 삭제하기",function(e){NMNS.history.remove(e.data.id,findById)},function(t){if(t&&t.data){var e=NMNS.history.find(function(e){return e.id===t.data.id});if(e){var a=m("<div class='row col-12 noShowRow' data-id='"+e.id+"' data-contact='"+(e.contact||"")+"' data-date='"+(e.date||"")+"' data-noshowcase='"+(e.noShowCase||"")+"'><div class='col col-3'>"+(e.contact?dashContact(e.contact):"")+"</div><div class='col col-3'>"+(e.date?e.date.substring(0,4)+". "+e.date.substring(4,6)+". "+e.date.substring(6):"")+"</div><div class='col col-4 base-font' style='font-size:10px'>"+e.noShowCase+"</div><div class='col-2 pr-0 text-right'><span class='noShowSearchDelete' title='삭제'>&times;</span></div></div>");a.find(".noShowSearchDelete").off("touch click").on("touch click",function(){T(m(this))}),m("#noShowSearchList .empty").length?m("#noShowSearchList").html(a):m("#noShowSearchList .noShowSearchAdd").length?a.insertBefore("#noShowSearchList .noShowSearchAdd:first-child"):m("#noShowSearchList").append(a)}}})),NMNS.socket.on("update password",socketResponse("비밀번호 변경하기")),NMNS.socket.on("get customer info",socketResponse("자동완성 자료 가져오기",function(e){if(e.data.id){var t=m("#"+e.data.id);t.autocomplete().onSuccess.call(t.autocomplete(),e.data.query,e.data.result)}},function(e){if(e.data.id){var t=m("#"+e.data.id);t.autocomplete().onFail.call(t.autocomplete(),e.data)}},!0)),NMNS.socket.on("get customer",socketResponse("고객 정보 가져오기",function(e){var t=m("#scheduleTab");if(t.is(":visible")){if(e.data.contact===t.find("#scheduleContact").val()&&t.data("contact")!==e.data.contact||e.data.name===t.find("#scheduleName").val()&&t.data("name")!==e.data.name){if(e.data.etc&&t.find("#scheduleEtc").val(e.data.etc),e.data.manager){var a=s(e.data.manager);a&&t.find("#scheduleManager").html(t.find("#scheduleManager").next().find("button[data-calendar-id='"+a.id+"']").html()).data("calendarid",a.id)}e.data.contents&&0===t.find("#scheduleTabContents input[value='']").val(e.data.contents).length&&t.find("#scheduleTabContents").append('<input type="text" class="form-control form-control-sm han" name="scheduleContents" aria-label="예약 내용" placeholder="예약 내용을 직접 입력하거나 메뉴에서 선택하세요." list="scheduleTabContentList" value="'+e.data.contents+'">'),void 0!==e.data.isAllDay&&t.find("#scheduleAllDay").attr("checked",e.data.isAllDay),e.data.name&&""===t.find("#scheduleName").val()&&t.find("#scheduleName").val(e.data.name),e.data.contact&&""===t.find("#scheduleContact").val()&&t.find("#scheduleContact").val(e.data.contact),t.find("#scheduleEtc").prop("readonly",!0),t.find(".scheduleEtcNotice").show()}void 0!==e.data.totalNoShow&&0<e.data.totalNoShow&&t.find("#scheduleContact").is(":visible")&&(t.find("#scheduleContact").tooltip({title:"이 번호에는 총 "+e.data.totalNoShow+"건의 노쇼가 등록되어 있습니다."+(e.data.myNoShow&&0<e.data.myNoShow?"<br/>우리 매장에서는 "+e.data.myNoShow+"건 등록되었습니다.":""),placement:"bottom",trigger:"click hover focus",delay:{hide:1e3},html:!0}).tooltip("show"),setTimeout(function(){t.find("#scheduleContact").tooltip("hide")},3e3),t.find("#scheduleContact").one("keyup change",function(){m(this).tooltip("dispose")}))}},void 0,!0)),NMNS.socket.on("message",socketResponse("서버 메시지 받기",function(e){"push"===e.type?e.data.forEach(function(e){showNotification(e)}):"alert"===e.type&&showSnackBar(e.data.body)},void 0,!0)),NMNS.socket.on("get alrim history",socketResponse("알림톡 내역 조회",function(e){!function(e){var t=m("#alrimHistoryList");if(t.hasClass("ps")||t.data("scroll",new PerfectScrollbar("#alrimHistoryList")),e&&0<e.length){var a="",n=m("#alrimHistoryList .alrimRow").length;e.forEach(function(e,t){a+='<div class="row alrimRow col mx-0 px-0" title="눌러서 전송된 알림톡 내용 보기"><a href="#alrimDetail'+(t+n)+'" class="alrimDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="alrimDetail'+(t+n)+'"></a><div class="col-2 pr-0 text-left montserrat">'+moment(e.date,"YYYYMMDDHHmm").format("YYYY. MM. DD")+'</div><div class="col-3 offset-2 ellipsis">'+e.name+'</div><div class="col-4 px-0 montserrat">'+dashContact(e.contact)+'</div><div class="col-1"></div></div><div class="row alrimDetailRow collapse mx-0 col-12" id="alrimDetail'+(t+n)+'">'+(e.contents?e.contents.replace(/\n/g,"<br>"):"")+"</div>",0<t&&t%50==0&&(m("#alrimHistoryList").append(a),a="")}),t.append(a),m("#alrimHistoryList .alrimDetailLink").off("touch click").on("touch click",function(){m(this).parent().toggleClass("show")})}else t.append("<div class='row alrimRow'><span class='col-12 text-center'>검색된 결과가 없습니다.</span></div>");t.data("scroll").update()}(e.data)},void 0,!0)),NMNS.socket.on("resend alrimtalk",socketResponse("알림톡 다시 보내기",function(e){showSnackBar("<span>고객에게 알림톡을 다시 보냈습니다!</span>")},function(e){m("#detailPopupResendAlrim").addClass("d-none"),showSnackBar("<span>"+e.message||"알림톡을 다시 보내지 못했습니다.</span>")})),NMNS.socket.on("get announcement",socketResponse("공지사항 조회",function(e){var t,a;0===m("#announcementBody").children().length&&m("#announcementBody").html(""),e.data.push({type:"SCHEDULE_ADDED",title:"홍길동",registeredDate:moment().format("YYYYMMDDHHmm"),contents:"매니큐어 바르기",start:moment().format("YYYYMMDDHHmm"),contact:"01011234444"}),e.data.push({type:"SCHEDULE_CANCELED",title:"홍길동",registeredDate:moment().format("YYYYMMDDHHmm"),contents:"매니큐어 바르기",start:moment().format("YYYYMMDDHHmm"),contact:"01011234444",id:"aaa"}),m("#announcementBody").append((t=e.data,a="",t.forEach(function(e){switch(a+='<div class="announcement">',e.type){case"SCHEDULE_ADDED":a+='<div class="d-flex align-items-center"><span>'+(e.title?"고객명 : "+e.title:"고객번호 : "+e.contact)+'</span><span class="d-flex ml-auto montserrat announcementTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+(e.title?"고객번호 : "+dashContact(e.contact):"")+"<br>예약날짜 : "+moment(e.start,"YYYYMMDDHHmm").format("YYYY. MM. DD")+"<br>예약시간 : "+moment(e.start,"YYYYMMDDHHmm").format("HH시 mm분")+(e.contents?"<br>예약내용 : "+e.contents:"")+'</p></div><div><span class="text-accent font-weight-bold" style="font-size:14px">예약 등록</span></div>';break;case"SCHEDULE_CANCELED":a+='<div class="d-flex align-items-center"><span>'+(e.title?"고객명 : "+e.title:"고객번호 : "+e.contact)+'</span><span class="d-flex ml-auto montserrat announcementTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+(e.title?"고객번호 : "+dashContact(e.contact):"")+"<br>예약날짜 : "+moment(e.start,"YYYYMMDDHHmm").format("YYYY. MM. DD")+"<br>예약시간 : "+moment(e.start,"YYYYMMDDHHmm").format("HH시 mm분")+'</p></div><div class="d-flex align-items-center"><span class="text-accent font-weight-bold" style="font-size:14px">예약 취소</span><span class="d-flex ml-auto addAnnouncementNoShow cursor-pointer" style="font-size:10px" data-schedule-id="'+e.id+'">직전취소로 노쇼등록 &gt;</span></div>';break;case"ANNOUNCEMENT":default:a+='<div class="d-flex align-items-center" style="margin-bottom:15px"><span class="announcementTitle">'+e.title+'</span><span class="d-flex ml-auto montserrat announcementTime">'+(e.registeredDate?moment(e.registeredDate,"YYYYMMDDHHmm").isSame(moment(),"day")?moment(e.registeredDate,"YYYYMMDDHHmm").format("HH:mm"):moment(e.registeredDate,"YYYYMMDDHHmm").format("MM. DD"):"")+"</span></div><div><p>"+e.contents+'</p></div><div><span class="text-accent font-weight-bold" style="font-size:14px">공지사항</span></div>'}a+="</div>"}),a));var n=NMNS.info.newAnnouncement;if(n&&0<n){var o=0;e.data.forEach(function(e){e.isRead||o++}),o<n?(m(".announcementCount").text(99<n-o?"99+":n-o),NMNS.info.newAnnouncement=n-o):n===o&&(m(".announcementCount").text(""),NMNS.info.newAnnouncement=0)}m("#announcementBody").parent().removeClass("wait"),5===e.data.length?NMNS.expectMoreAnnouncement=!0:NMNS.expectMoreAnnouncement=!1},function(e){m("#announcementBody").parent().removeClass("wait")})),m(".modal").on("shown.bs.modal",function(){m(".modal-backdrop").on("touch click",function(e){m(".modal.show").modal("hide")})}),m("#infoModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;var e=!1;return m("#infoBizBeginTime").val()!==NMNS.info.bizBeginTime&&(e=!0),e||m("#infoBizEndTime").val()===NMNS.info.bizEndTime||(e=!0),e||m("#infoShopName").val()===(NMNS.info.shopName||"")||(e=!0),e||m("#infoBizType").val()===(NMNS.info.bizType||"")||(e=!0),!(e&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))&&void 0}).on("touch click",function(e){}).on("show.bs.modal",NMNS.initInfoModal),m("#alrimModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1;if(m("#alrimShopName").is(":visible")){var e=!1;if((m("#alrimUseYn").prop("checked")&&"Y"!==NMNS.info.alrimTalkInfo.useYn||!m("#alrimUseYn").prop("checked")&&"N"!==NMNS.info.alrimTalkInfo.useYn)&&(e=!0),e||m("#alrimShopName").val()===(NMNS.info.shopName||"")||(e=!0),e||m("#alrimCallbackPhone").val()===(NMNS.info.alrimTalkInfo.callbackPhone||"")||(e=!0),e||m("#alrimCancelDue").val()===(NMNS.info.alrimTalkInfo.cancelDue||"")||(e=!0),e||m("#alrimNotice").val()===(NMNS.info.alrimTalkInfo.notice||"")||(e=!0),e&&!confirm("저장되지 않은 변경내역이 있습니다. 창을 닫으시겠어요?"))return!1}}).on("shown.bs.modal",function(){m("body .popover").length&&m("body .popover").popover("update")}).on("show.bs.modal",function(){NMNS.initAlrimModal(),m("#alrimTabList a[data-target='#alrimTab']").tab("show")}),m("#noShowModal").on("hide.bs.modal",function(){if("INPUT"===document.activeElement.tagName)return!1}).on("show.bs.modal",function(e){m(e.relatedTarget).hasClass("getNoShowLink")?m("#noShowTabList .nav-link[href='#noShowSearch']").tab("show"):m(e.relatedTarget).hasClass("addNoShowLink")&&m("#noShowTabList .nav-link[href='#noShowAdd']").tab("show")}),m("#scheduleModal").on("hide.bs.modal",function(e){NMNS.scheduleTarget&&NMNS.scheduleTarget.guide&&NMNS.scheduleTarget.guide.clearGuideElement(),delete NMNS.scheduleTarget,m("#scheduleName").val(""),m("#scheduleTabContents").html(w("")),m("#scheduleContact").val(""),m("#scheduleEtc").val("").prop("readonly",!1)}),m("#noMoreTips").on("touch click",function(){document.cookie="showTips=false"}),m("#showTips").on("touch click",function(e){e.preventDefault(),m("#noMoreTips").remove(),m("#tipsModal").modal("show")}),m("#lnbLastMenu a").on("touch click",function(e){e.preventDefault()}),m("#showTutorial").on("touch click",function(){if(document.getElementById("tutorialScript"))m("#tutorialModal").modal();else{var e=document.createElement("script");e.src="/nmns/js/tutorial.min.js",e.id="tutorialScript",document.body.appendChild(e),e.onload=function(){m("#tutorialModal").modal()}}}),m(".announcementMenuLink").on("show.bs.popover",function(){0===m("#annoumcementBody").children().length&&(NMNS.announcementPage=1,m("#announcementBody").parent().addClass("wait"),NMNS.socket.emit("get announcement",{page:1}))}).on("shown.bs.popover",function(){m("#announcementBody").parents(".popover").find(".close-button").on("touch click",function(){m(this).parents(".popover").popover("hide")})}),m("#mainMenu").on("shown.bs.popover",function(){m(".mainMenuRow a[data-link]").off("touch click").on("touch click",function(e){m("#mainMenu").popover("hide"),m(m(this).data("link")).modal("show")}),m("#signoutLink").on("touch click",function(){NMNS.socket.close()})}),m("html").on("click",function(e){0<m("body").children(".popover.show").length&&void 0===m(e.target).data("original-title")&&!m(e.target).parents().is(".popover.show")&&0===m(e.target).parents('[data-toggle="popover"]').length&&m("body").children(".popover.show").popover("hide")}),m("#alrimTabList a[data-target='#alrimTab']").on("show.bs.tab",NMNS.initAlrimModal),m("#alrimTabList a[data-target='#alrimHistoryTab']").on("show.bs.tab",function(){m("#alrimHistorySearch").trigger("click")}),m("#scheduleTabList a[data-target='#scheduleTab']").on("touch click",function(){m(this).hasClass("active")||y("switch")}),m("#scheduleTabList a[data-target='#taskTab']").on("touch click",function(){m(this).hasClass("active")||D("switch")}),m("#userModal").one("show.bs.modal",function(){m("#resetPasswordBtn").on("touch click",function(){0!==m("#currentPassword").val().length?0!==m("#newPassword").val().length?0!==m("#renewPassword").val().length?m("#newPassword").val()===m("#renewPassword").val()?(NMNS.socket.emit("update password",{currentPassword:m("#currentPassword").val(),newPassword:m("#newPassword").val()}),m("#newPassword").val(""),m("#renewPassword").val(""),m("#infoModal").modal("hide")):showSnackBar("새 비밀번호가 일치하지 않습니다."):showSnackBar("새 비밀번호를 한 번 더 입력해주세요."):showSnackBar("새 비밀번호를 입력해주세요."):showSnackBar("현재 비밀번호를 입력해주세요.")})}),x=document.getElementById("mainRow"),L=function(e){"left"===e?m("#renderRange").next().trigger("click"):"right"===e&&m("#renderRange").prev().trigger("click")}||function(e){},(B=x).addEventListener("touchstart",function(e){var t=e.changedTouches[0];I=t.pageX,H=(new Date).getTime()},!1),B.addEventListener("touchend",function(e){var t=e.changedTouches[0];A=t.pageX-I,(new Date).getTime()-H<=300&&100<=Math.abs(A)&&L(A<0?"left":"right")},!1),m(".addManager").on("touch click",function(){var e=NMNS.colorTemplate[Math.floor(Math.random()*NMNS.colorTemplate.length)],t=m(this).prev(),a="lnbManagerList"===t.attr("id")?"lnbManagerItem":"infoManagerItem",n=m("<div class='"+a+" addManagerItem row mx-0'><label><input class='tui-full-calendar-checkbox-round' checked='checked' type='checkbox'/><span class='addManagerColor' style='background-color:"+e+"; border-color:"+e+";' data-color='"+e+"'></span><input type='text' name='name' class='align-middle form-control form-control-sm rounded-0' data-color='"+e+"' data-id='"+NMNS.email+generateRandom()+"' placeholder='담당자 이름'/></label>"+("lnbManagerItem"===a?"<i class='fas fa-check submitAddManager pl-1' title='추가'></i><span class='cancelAddManager pl-1' title='취소'>&times;</span>":"<i class='fas fa-trash cancelAddManager pl-2 title='삭제'></i>")+"</div>");t.append(n),"lnbManagerItem"===a?(n.find(".submitAddManager").off("touch click").on("touch click",function(){Y(this)}),n.find("input[type='text']").off("keyup").on("keyup",function(e){27===e.which?(E(this),t.find("div:last-child input[type='text']").focus()):13===e.which&&Y(this)}),n.find(".cancelAddManager").off("touch click").on("touch click",function(){E(this),t.find("div:last-child input[type='text']").focus()}),n.find(".addManagerColor").attr("title","담당자 색상은 저장 후 내 매장 정보 메뉴에서 바꾸실 수 있습니다.")):(n.find("input[type='text']").off("keyup").on("keyup",function(e){if(27===e.which){if(1==t.children(".infoManagerItem:visible").length)return;E(this),t.find("div:last-child input[type='text']").focus(),t.data("scroll").update()}}),n.find(".addManagerColor").off("touch click").on("touch click",function(){showColorPickerPopup(m(this))}),n.find(".cancelAddManager").off("touch click").on("touch click",function(){1!=t.children(".infoManagerItem:visible").length?(E(this),t.find("div:last-child input[type='text']").focus(),t.data("scroll").update()):alert("담당자는 반드시 1명 이상 있어야합니다!")})),t.find("div:last-child input[type='text']").focus()}),m("#copyEmail").on("touch click",function(e){e.preventDefault();var t=document.createRange();t.selectNodeContents(m(this)[0]);var a=window.getSelection?window.getSelection():document.selection;a.removeAllRanges(),a.addRange(t);var n="";return n=document.execCommand("copy")?"메일주소가 복사되었습니다.":"메일주소를 복사하지 못했습니다. 직접 선택하여 복사해주세요.",m(this).attr("title",n).tooltip({trigger:"manual",delay:{hide:1e3}}),m(this).tooltip("show"),setTimeout(function(){m("#copyEmail").attr("title","메일주소 복사").tooltip("dispose")},1500),a.empty?a.empty():a.removeAllRanges&&a.removeAllRanges(),!1}),m(".openAppLink").off("touch click").on("touch click",function(e){var t=navigator.userAgent.toLocaleLowerCase();-1<t.indexOf("android")||(-1<t.indexOf("ipod")||-1<t.indexOf("iphone")||-1<t.indexOf("ipad"))&&window.open(m(this).data("ios"),"_system")}),m(".mfb-component__button--child").off("touch click").on("touch click",function(e){e.preventDefault(),document.getElementById("floatingButton").setAttribute("data-mfb-state","closed")}),m("#announcementBody").on("scroll",debounce(function(){var e=Math.max(0,m(this)[0].scrollHeight-m(this).scrollTop()-m(this).innerHeight());!m("#waitAnnouncement").is(":visible")&&NMNS.expectMoreAnnouncement&&e<Math.max(100,.2*m(this).innerHeight())&&(m("#waitAnnouncement").parent().addClass("wait"),NMNS.socket.emit("get announcement",{page:++NMNS.announcementPage}))},100)),NMNS.socket.emit("get noti"),NMNS.socket.on("get noti",socketResponse("서버 메시지 받기",function(e){e.data.data.forEach(function(e){showNotification(e)})})),m(".customerMenuLink").off("touch click").on("touch click",function(){var e=m(m(".customerSortType.active")[0]).data("action");if(document.getElementById("customerScript"))NMNS.socket.emit("get customer list",{type:"all",target:""===m("#customerSearchTarget").val()?void 0:m("#customerSearchTarget").val(),sort:e});else{var t=document.createElement("script");t.src="/nmns/js/customer.min.js",t.id="customerScript",document.body.appendChild(t),t.onload=function(){NMNS.socket.emit("get customer list",{type:"all",target:""===m("#customerSearchTarget").val()?void 0:m("#customerSearchTarget").val(),sort:e})}}m("#customerAddManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(b()).off("touch click","button").on("touch click","button",function(){m("#customerAddManager").data("calendar-id",m(this).data("calendar-id")).data("bgcolor",m(this).data("bgcolor")).html(m(this).html())}),m("#customerAddManager").html("<span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color: "+NMNS.calendar.getCalendars()[0].bgColor+"'></span><span class='tui-full-calendar-content'>"+NMNS.calendar.getCalendars()[0].name+"</span>").data("calendar-id",NMNS.calendar.getCalendars()[0].id).data("bgcolor",NMNS.calendar.getCalendars()[0].bgColor),m("#customerManager").next().html("<button type='button' class='dropdown-item tui-full-calendar-dropdown-item' data-calendar-id='' data-bgcolor='#b2dfdb'><span class='tui-full-calendar-icon tui-full-calendar-calendar-dot' style='background-color:#b2dfdb'></span><span class='tui-full-calendar-content'>(담당자 없음)</span></button>").append(b()).off("touch click","button").on("touch click","button",function(){m("#customerManager").data("calendar-id",m(this).data("calendar-id")).data("bgcolor",m(this).data("bgcolor")).html(m(this).html())})}),m(".calendarMenuLink").off("touch click").on("touch click",function(){f()}),m(".infoCenterLink").off("touch click").on("touch click",function(){if(0===m("#faq").children().length){var a="";[{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"},{title:"일정 추가는 어디서 하나요?",contents:"일정 추가는 예약/일정 관리 화면에서 하실 수 있습니다!"}].forEach(function(e,t){a+='<div class="row faqRow col mx-0" title="'+e.title+'"><a href="#faqDetail'+t+'" class="faqDetailLink collapsed" data-toggle="collapse" role="button" aria-expanded="false" aria-controls="faqDetail'+t+'"></a><div class="ellipsis">'+e.title+'</div></div><div class="row faqDetailRow collapse mx-0" id="faqDetail'+t+'"><div class="d-inline-flex"><span>ㄴ</span></div><span class="col px-2">'+e.contents+"</span></div></div>",0<t&&t%50==0&&(m("#faq").append(a),a="")}),m("#faq").append(a)}}),m(".menuLink").on("touch click",z)}(jQuery);