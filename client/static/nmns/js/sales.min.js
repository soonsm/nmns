!function(){function n(e,a){for(var t,s,n=NMNS.calendar.getCalendars(),r="",i=e;i<a;i++)s=NMNS.salesList[i],(t=n.find(function(e){return e.id===s.managerId}))||(t={color:"#334150",name:"(삭제된 담당자)"}),r+='<div class="col-12 px-0 salesRow" data-index="'+i+'"><div class="col-2 px-0 montserrat">'+moment(s.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><div class="col-2 px-0 salesName ellipsis">'+s.customerName+'</div><div class="col-2 px-0"><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+t.color+'" title="'+t.name+'"></span></div><div class="col-2 px-0 ellipsis">'+s.item+'</div><div class="col-2 px-0 montserrat">'+(s.price+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div><div class="col-2 px-0">'+("CARD"===s.type?"카드":"CASH"===s.type?"현금":"멤버십")+"</div></div>";return r}function r(e){var a,t=$("#mainSalesList"),s="";NMNS.salesList&&e?(t.children(":not(.ps)").remove(),NMNS.salesList&&0<NMNS.salesList.length?s+=n(0,a=Math.min(0===i?i+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length):i,NMNS.salesList.length)):s+="<p>저장된 매출 내역이 없습니다.</p>"):NMNS.salesList&&(a=Math.min(i+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length),NMNS.salesList.length),s+=n(i,a)),i=a,t.append(s)}NMNS.socket.on("get sales list",socketResponse("매출 내역 조회",function(e){NMNS.salesList=e.data.sales,NMNS.salesList=[{id:"123",customerName:"기기기",date:"20190101",item:"입장료",price:3e3,type:"CARD"}];for(var a=0;a<100;a++)NMNS.salesList.push({id:"123"+a,customerName:"미미미"+a*Math.random(),date:moment().add(a,"day").format("YYYYMMDD"),item:"입장료"+a*Math.random(),type:"CARD",price:Math.floor(3e4*Math.random())});r(!0),$("#salesSummaryTotalCount").text((e.data.totalSalesCount||NMNS.salesList.length+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCard").text((e.data.totalSalesCard||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCash").text((e.data.totalSalesCash||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalMembership").text((e.data.totalSalesMembership||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalAmount").text((e.data.totalSalesAmount||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesToolsSticky").show()})),$("#salesSearchButton").on("touch click",function(){NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),name:""===$("#salesSearchName").val()?void 0:$("#salesSearchName").val(),managerId:$("#salesSearchManager").data("calendar-id")||void 0,item:""===$("#salesSearchContents").val()?void 0:$("#salesSearchContents").val()})}).removeClass("disabled");var i=0;$(".salesSortType").off("touch click").on("touch click",function(e){if($(this).hasClass("active"))NMNS.salesList.reverse();else{var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action")),NMNS.salesList.sort(function s(e){switch(e){case"sort-date":return function(e,a){return e.date?a.date?e.date<a.date?-1:e.date>a.date?1:s("sort-name")(e,a):-1:a.date?1:s("sort-name")(e,a)};case"sort-manager":var n=NMNS.calendar.getCalendars();return function(a,t){return a.managerId?t.managerId?(a.manager||(a.manager=n.find(function(e){return e.id===a.managerId}),a.manager||(a.manager={color:"#334150",name:"(삭제된 담당자)"})),t.manager||(t.manager=n.find(function(e){return e.id===t.managerId}),t.manager||(t.manager={color:"#334150",name:"(삭제된 담당자)"})),a.manager.name<t.manager.name?-1:a.manager.name>t.manager.name?1:s("sort-name")(a,t)):-1:t.managerId?1:s("sort-name")(a,t)};case"sort-item":return function(e,a){return e.item?a.item?e.item<a.item?-1:e.item>a.item?1:s("sort-name")(e,a):-1:a.item?1:s("sort-name")(e,a)};case"sort-sales":return function(e,a){return e.price?a.price?1*e.price<1*a.price?-1:1*e.price>1*a.price?1:s("sort-name")(e,a):-1:a.price?1:s("sort-name")(e,a)};case"sort-name":default:return function(e,a){return e.customerName?a.customerName?e.customerName<a.customerName?-1:e.customerName>a.customerName?1:0:-1:a.customerName?1:0}}}(a)),t=a,$(".salesSortType").removeClass("active"),$(".salesSortType[data-action='"+t+"']").addClass("active")}var t;r(!(i=0))});var l=!1;$(document).on("scroll",debounce(function(){var e,a,t,s=(e=window.pageYOffset,a=window.innerHeight,t=document.body.offsetHeight,Math.max(t-(e+a),0));$("#mainSalesList").is(":visible")&&!l&&NMNS.salesList&&i<NMNS.salesList.length&&s<Math.max(100,.2*window.innerHeight)&&(l=!0,$("#mainSalesLoading").show(),r(),$("#mainSalesLoading").hide(),l=!1)},100))}();