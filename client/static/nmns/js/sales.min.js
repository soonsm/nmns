!function(){function n(e,a){for(var t,s,n=NMNS.calendar.getCalendars(),r="",o=e;o<a;o++)s=NMNS.salesList[o],(t=n.find(function(e){return e.id===s.managerId}))||(t={color:"#334150",name:"(삭제된 담당자)"}),r+='<div class="col-12 px-0 salesRow" data-index="'+o+'"><div class="col-2 px-0 montserrat">'+moment(s.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><div class="col-2 px-0 salesName ellipsis">'+s.customerName+'</div><div class="col-2 px-0"><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+t.color+'" title="'+t.name+'"></span></div><div class="col-2 px-0 ellipsis">'+s.item+'</div><div class="col-2 px-0 montserrat">'+(s.price+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div><div class="col-2 px-0">'+("CARD"===s.type?"카드":"CASH"===s.type?"현금":"멤버십")+"</div></div>";return r}function r(e){var a,t=$("#mainSalesList"),s="";NMNS.salesList&&e?(t.children(":not(.ps)").remove(),NMNS.salesList&&0<NMNS.salesList.length?s+=n(0,a=Math.min(0===o?o+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length):o,NMNS.salesList.length)):s+="<p>저장된 매출 내역이 없습니다.</p>"):NMNS.salesList&&(a=Math.min(o+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length),NMNS.salesList.length),s+=n(o,a)),o=a,t.append(s)}NMNS.socket.on("get sales list",socketResponse("매출 내역 조회",function(e){NMNS.salesList=e.data.sales,NMNS.salesList=[{id:"123",customerName:"기기기",date:"20190101",item:"입장료",price:3e3,type:"CARD"}];for(var a=0;a<100;a++)NMNS.salesList.push({id:"123"+a,customerName:"미미미"+a*Math.random(),date:moment().add(a,"day").format("YYYYMMDD"),item:"입장료"+a*Math.random(),type:"CARD",price:Math.floor(3e4*Math.random())});r(!0),$("#salesSummaryTotalCount").text((e.data.totalSalesCount||NMNS.salesList.length+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCard").text((e.data.totalSalesCard||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCash").text((e.data.totalSalesCash||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalMembership").text((e.data.totalSalesMembership||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalAmount").text((e.data.totalSalesAmount||"0").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesToolsSticky").show(),$("#salesSearchButton").removeClass("disabled")})),$(".salesSearchPeriodButton").on("touch click",function(){var e,a;switch($(".salesSearchPeriodButton").removeClass("active"),$(this).data("action")){case"week":a=moment(),e=moment().add(-7,"day");break;case"month":a=moment(),e=moment().add(-1,"month");break;case"halfYear":a=moment(),e=moment().add(-6,"month");break;case"year":a=moment(),e=moment().add(-1,"year");break;case"currentMonth":$(this).addClass("active"),a=moment().endOf("month"),e=moment().startOf("month");break;case"previousMonth":$(this).addClass("active"),a=moment().add(-1,"month").endOf("month"),e=moment().add(-1,"month").startOf("month");break;case"previous2Month":$(this).addClass("active"),a=moment().add(-2,"month").endOf("month"),e=moment().add(-2,"month").startOf("month")}e&&a&&(document.getElementById("salesSearchStartDate")._flatpickr.setDate(e.toDate()),document.getElementById("salesSearchEndDate")._flatpickr.setDate(a.toDate()))}),$("#salesSearchButton").on("touch click",function(){$(this).hasClass("disabled")||($(this).addClass("disabled"),NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),name:""===$("#salesSearchName").val()?void 0:$("#salesSearchName").val(),managerId:$("#salesSearchManager").data("calendar-id")||void 0,item:""===$("#salesSearchContents").val()?void 0:$("#salesSearchContents").val()}))});var o=0;$(".salesSortType").off("touch click").on("touch click",function(e){if($(this).hasClass("active"))NMNS.salesList.reverse();else{var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action")),NMNS.salesList.sort(function s(e){switch(e){case"sort-date":return function(e,a){return e.date?a.date?e.date<a.date?-1:e.date>a.date?1:s("sort-name")(e,a):-1:a.date?1:s("sort-name")(e,a)};case"sort-manager":var n=NMNS.calendar.getCalendars();return function(a,t){return a.managerId?t.managerId?(a.manager||(a.manager=n.find(function(e){return e.id===a.managerId}),a.manager||(a.manager={color:"#334150",name:"(삭제된 담당자)"})),t.manager||(t.manager=n.find(function(e){return e.id===t.managerId}),t.manager||(t.manager={color:"#334150",name:"(삭제된 담당자)"})),a.manager.name<t.manager.name?-1:a.manager.name>t.manager.name?1:s("sort-name")(a,t)):-1:t.managerId?1:s("sort-name")(a,t)};case"sort-item":return function(e,a){return e.item?a.item?e.item<a.item?-1:e.item>a.item?1:s("sort-name")(e,a):-1:a.item?1:s("sort-name")(e,a)};case"sort-sales":return function(e,a){return e.price?a.price?1*e.price<1*a.price?-1:1*e.price>1*a.price?1:s("sort-name")(e,a):-1:a.price?1:s("sort-name")(e,a)};case"sort-name":default:return function(e,a){return e.customerName?a.customerName?e.customerName<a.customerName?-1:e.customerName>a.customerName?1:0:-1:a.customerName?1:0}}}(a)),t=a,$(".salesSortType").removeClass("active"),$(".salesSortType[data-action='"+t+"']").addClass("active")}var t;r(!(o=0))});var m=!1;$(document).on("scroll",debounce(function(){if($("#mainSalesList").is(":visible")){console.log(document.scrollingElement.scrollTop);var e=(a=window.pageYOffset,t=window.innerHeight,s=document.body.offsetHeight,Math.max(s-(a+t),0));!m&&NMNS.salesList&&o<NMNS.salesList.length&&e<Math.max(100,.2*window.innerHeight)&&(m=!0,$("#mainSalesLoading").show(),r(),$("#mainSalesLoading").hide(),m=!1)}var a,t,s},100))}();