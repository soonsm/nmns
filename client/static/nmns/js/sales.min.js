!function(){function n(e,a){for(var t,s,n=NMNS.calendar.getCalendars(),l="",o=e;o<a;o++)s=NMNS.salesList[o],(t=n.find(function(e){return e.id===s.managerId}))||(t={color:"#334150",name:"(삭제된 담당자)"}),l+='<div class="col-12 px-0 salesRow" data-index="'+o+'"><div class="col-2 px-0 montserrat">'+moment(s.date,"YYYYMMDD").format("YYYY. MM. DD")+'</div><div class="col-2 px-0 salesName ellipsis">'+s.customerName+'</div><div class="col-2 px-0"><span class="tui-full-calendar-weekday-schedule-bullet" style="background:'+t.color+'" title="'+t.name+'"></span></div><div class="col-2 px-0 ellipsis">'+s.item+'</div><div class="col-2 px-0 montserrat">'+(s.price+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")+'</div><div class="col-2 px-0">'+("CARD"===s.type?"카드":"CASH"===s.type?"현금":"멤버십")+"</div></div>";return l}function t(e){var a,t=$("#mainSalesList"),s="";!e&&l||(l=0),NMNS.salesList&&e?(t.children(":not(.ps)").remove(),NMNS.salesList&&0<NMNS.salesList.length?s+=n(0,a=Math.min(0===l?l+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length):l,NMNS.salesList.length)):s+="<p class='m-auto'>저장된 매출 내역이 없습니다.</p>"):NMNS.salesList&&(a=Math.min(l+Math.max(20,5+Math.ceil($("#mainSalesList").height()/48)-$("#mainSalesList .salesRow").length),NMNS.salesList.length),s+=n(l,a)),l=a,t.append(s)}NMNS.socket.on("get sales list",socketResponse("매출 내역 조회",function(e){NMNS.salesList=e.data.sales,t(!0),$("#salesSummaryTotalCount").text(((e.data.totalSalesCount||NMNS.salesList.length)+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCard").text(((e.data.totalSalesCard||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalCash").text(((e.data.totalSalesCash||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalMembership").text(((e.data.totalSalesMembership||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesSummaryTotalAmount").text(((e.data.totalSalesAmount||"0")+"").replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")),$("#salesToolsSticky").show(),$("#mainSalesTools").data("initialHeight")||$("#mainSalesTools").data("initialHeight",document.getElementById("mainSalesTools").offsetHeight),$("#salesSearchButton").removeClass("disabled"),$("#salesSearchPeriod").text(moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYY. MM. DD - ")+moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYY. MM. DD"))})),$(".salesSearchPeriodButton").on("touch click",function(){var e,a;switch($(".salesSearchPeriodButton").removeClass("active"),$(this).data("action")){case"week":a=moment(),e=moment().add(-7,"day");break;case"month":a=moment(),e=moment().add(-1,"month");break;case"halfYear":a=moment(),e=moment().add(-6,"month");break;case"year":a=moment(),e=moment().add(-1,"year");break;case"currentMonth":$(this).addClass("active"),a=moment().endOf("month"),e=moment().startOf("month");break;case"previousMonth":$(this).addClass("active"),a=moment().add(-1,"month").endOf("month"),e=moment().add(-1,"month").startOf("month");break;case"previous2Month":$(this).addClass("active"),a=moment().add(-2,"month").endOf("month"),e=moment().add(-2,"month").startOf("month")}e&&a&&(document.getElementById("salesSearchStartDate")._flatpickr.setDate(e.toDate()),document.getElementById("salesSearchEndDate")._flatpickr.setDate(a.toDate()))}),$("#salesSearchButton").on("touch click",function(){$(this).hasClass("disabled")||($(this).addClass("disabled"),NMNS.socket.emit("get sales list",{start:moment(document.getElementById("salesSearchStartDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),end:moment(document.getElementById("salesSearchEndDate")._flatpickr.selectedDates[0]).format("YYYYMMDD"),name:""===$("#salesSearchName").val()?void 0:$("#salesSearchName").val(),managerId:$("#salesSearchManager").data("calendar-id")||void 0,item:""===$("#salesSearchContents").val()?void 0:$("#salesSearchContents").val()}))});var l=0;$(".salesSortType").off("touch click").on("touch click",function(e){if($(this).hasClass("active"))NMNS.salesList.reverse();else{var a=e.target.getAttribute("data-action");a||(a=e.target.parentElement.getAttribute("data-action")),NMNS.salesList.sort(function s(e){switch(e){case"sort-date":return function(e,a){return e.date?a.date?e.date<a.date?-1:e.date>a.date?1:s("sort-name")(e,a):-1:a.date?1:s("sort-name")(e,a)};case"sort-manager":var n=NMNS.calendar.getCalendars();return function(a,t){return a.managerId?t.managerId?(a.manager||(a.manager=n.find(function(e){return e.id===a.managerId}),a.manager||(a.manager={color:"#334150",name:"(삭제된 담당자)"})),t.manager||(t.manager=n.find(function(e){return e.id===t.managerId}),t.manager||(t.manager={color:"#334150",name:"(삭제된 담당자)"})),a.manager.name<t.manager.name?-1:a.manager.name>t.manager.name?1:s("sort-name")(a,t)):-1:t.managerId?1:s("sort-name")(a,t)};case"sort-item":return function(e,a){return e.item?a.item?e.item<a.item?-1:e.item>a.item?1:s("sort-name")(e,a):-1:a.item?1:s("sort-name")(e,a)};case"sort-sales":return function(e,a){return e.price?a.price?1*e.price<1*a.price?-1:1*e.price>1*a.price?1:s("sort-name")(e,a):-1:a.price?1:s("sort-name")(e,a)};case"sort-name":default:return function(e,a){return e.customerName?a.customerName?e.customerName<a.customerName?-1:e.customerName>a.customerName?1:0:-1:a.customerName?1:0}}}(a)),function(e){$(".salesSortType").removeClass("active"),$(".salesSortType[data-action='"+e+"']").addClass("active")}(a)}t(!(l=0))});var e=!1,a=document.scrollingElement||document.documentElement;$(document).on("scroll",debounce(function(){$("#mainSalesList").is(":visible")&&!e&&NMNS.salesList&&l<NMNS.salesList.length&&Math.max(document.body.scrollHeight-window.innerHeight-window.scrollY,0)<Math.max(100,.2*window.innerHeight)&&(e=!0,$("#mainSalesLoading").show(),t(),$("#mainSalesLoading").hide(),e=!1)},100)).on("scroll",function(){$("#mainSalesList").is(":visible")&&(0<a.scrollTop?($(".salesMenu .menuTitle").addClass("fixedScroll"),$("#menuTitleSticky").removeClass("d-none"),a.scrollTop>$("#mainSalesTools").data("initialHeight")-document.getElementById("salesToolsSticky").offsetHeight?$("#mainSalesTools").addClass("fixedScroll"):$("#mainSalesTools").removeClass("fixedScroll")):($(".salesMenu .menuTitle").removeClass("fixedScroll"),$("#menuTitleSticky").addClass("d-none")))})}();